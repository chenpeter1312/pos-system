<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CDN æµ‹è¯•</title>
    <style>
        body {
            font-family: monospace;
            padding: 40px;
            background: #1e1e1e;
            color: #00ff00;
        }
        .result {
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
            background: #2d2d2d;
        }
        .success { color: #4ade80; }
        .error { color: #f87171; }
    </style>
</head>
<body>
    <h1>ğŸ” Supabase CDN åŠ è½½æµ‹è¯•</h1>
    <div id="results"></div>

    <!-- æµ‹è¯•ä¸åŒçš„ CDN æº -->
    <script>
        var results = document.getElementById('results');

        function addResult(message, isSuccess) {
            var div = document.createElement('div');
            div.className = 'result ' + (isSuccess ? 'success' : 'error');
            div.textContent = message;
            results.appendChild(div);
            console.log(message);
        }

        // æµ‹è¯• 1ï¼šæ£€æŸ¥è„šæœ¬åŠ è½½
        addResult('æµ‹è¯• 1ï¼šæ£€æŸ¥é¡µé¢åŸºæœ¬ JavaScript...', true);
        addResult('âœ… JavaScript å¯ä»¥è¿è¡Œ', true);

        // æµ‹è¯• 2ï¼šå°è¯•åŠ è½½ jsdelivr CDN
        addResult('\næµ‹è¯• 2ï¼šå°è¯•åŠ è½½ jsdelivr CDN...', true);

        var script1 = document.createElement('script');
        script1.src = 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.js';
        script1.onload = function() {
            addResult('âœ… jsdelivr CDN åŠ è½½æˆåŠŸ', true);
            checkSupabase();
        };
        script1.onerror = function() {
            addResult('âŒ jsdelivr CDN åŠ è½½å¤±è´¥', false);
            tryUnpkg();
        };
        document.head.appendChild(script1);

        function checkSupabase() {
            setTimeout(function() {
                if (window.supabase) {
                    addResult('âœ… window.supabase å­˜åœ¨', true);
                    addResult('âœ… ç±»å‹: ' + typeof window.supabase.createClient, true);

                    // å°è¯•åˆ›å»ºå®¢æˆ·ç«¯
                    try {
                        var client = window.supabase.createClient(
                            'https://test.supabase.co',
                            'test-key'
                        );
                        addResult('âœ… å¯ä»¥åˆ›å»º Supabase å®¢æˆ·ç«¯', true);
                        addResult('\nğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼CDN å·¥ä½œæ­£å¸¸', true);
                    } catch (e) {
                        addResult('âŒ åˆ›å»ºå®¢æˆ·ç«¯å¤±è´¥: ' + e.message, false);
                    }
                } else {
                    addResult('âŒ window.supabase ä¸å­˜åœ¨', false);
                    addResult('å¯ç”¨çš„å…¨å±€å¯¹è±¡: ' + Object.keys(window).filter(function(k) {
                        return k.toLowerCase().includes('supabase');
                    }).join(', '), false);
                }
            }, 500);
        }

        function tryUnpkg() {
            addResult('\næµ‹è¯• 3ï¼šå°è¯• unpkg CDN ä½œä¸ºå¤‡ç”¨...', true);

            var script2 = document.createElement('script');
            script2.src = 'https://unpkg.com/@supabase/supabase-js@2.39.3/dist/umd/supabase.js';
            script2.onload = function() {
                addResult('âœ… unpkg CDN åŠ è½½æˆåŠŸ', true);
                checkSupabase();
            };
            script2.onerror = function() {
                addResult('âŒ unpkg CDN ä¹ŸåŠ è½½å¤±è´¥', false);
                addResult('\nå»ºè®®æ£€æŸ¥ï¼š', false);
                addResult('1. ç½‘ç»œè¿æ¥', false);
                addResult('2. Safari å†…å®¹é˜»æ­¢å™¨', false);
                addResult('3. é˜²ç«å¢™è®¾ç½®', false);
            };
            document.head.appendChild(script2);
        }

        // 5ç§’è¶…æ—¶æ£€æµ‹
        setTimeout(function() {
            if (!window.supabase) {
                addResult('\nâ±ï¸ 5ç§’è¶…æ—¶ - CDN æœªèƒ½åŠ è½½', false);
            }
        }, 5000);
    </script>
</body>
</html>
