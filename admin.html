<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂæåÂè∞ÁÆ°ÁêÜÁ≥ªÁµ± - Lee's Taiwanese Comfort Food</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600;700&family=Noto+Serif+TC:wght@400;500;600;700;900&display=swap" rel="stylesheet">

    <style>
        /* Êó•ÂºèÂÆöÈ£üÂ∫óÈ¢®Ê†ºÈÖçËâ≤ - Ê∑°ÈõÖÊ∏ÖÊñ∞ */
        :root {
            --wood-dark: #6B4423;
            --wood-medium: #8B6F47;
            --wood-light: #D4A574;
            --wood-pale: #E8DCC8;
            --cream: #FFFBF5;
            --cream-dark: #F9F5EF;
            --taiwan-red: #C1272D;
            --taiwan-green: #2F5233;
            --warm-white: #FFFFFF;
            --text-dark: #3E2723;
            --text-medium: #5D4037;
            --shadow-soft: rgba(107, 68, 35, 0.08);
            --shadow-medium: rgba(107, 68, 35, 0.12);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Lora', 'Noto Serif TC', serif;
            background: linear-gradient(135deg, var(--wood-pale) 0%, var(--cream-dark) 100%);
            min-height: 100vh;
            position: relative;
        }

        /* Ê∑°ÈõÖÊú®Ë≥™Á¥ãÁêÜËÉåÊôØ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                repeating-linear-gradient(90deg, transparent, transparent 3px, rgba(107, 68, 35, 0.015) 3px, rgba(107, 68, 35, 0.015) 6px),
                repeating-linear-gradient(0deg, transparent, transparent 3px, rgba(107, 68, 35, 0.01) 3px, rgba(107, 68, 35, 0.01) 6px);
            pointer-events: none;
            z-index: 0;
        }

        .admin-container {
            position: relative;
            z-index: 1;
            min-height: 100vh;
        }

        /* ÁôªÂÖ•ÁïåÈù¢ */
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .login-title {
            text-align: center;
            color: var(--wood-dark);
            margin-bottom: 30px;
            font-size: 28px;
        }

        /* ÂæåÂè∞‰ΩàÂ±Ä */
        .admin-layout {
            display: flex;
            height: 100vh;
        }

        /* ÂÅ¥ÈÇäÊ¨Ñ */
        .sidebar {
            width: 260px;
            background: linear-gradient(180deg, var(--wood-dark) 0%, var(--wood-medium) 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 2px 0 8px rgba(0,0,0,0.1);
        }

        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 20px;
        }

        .sidebar-header h1 {
            font-size: 20px;
            margin-bottom: 5px;
        }

        .sidebar-header p {
            font-size: 13px;
            opacity: 0.8;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin: 5px 10px;
        }

        .sidebar-menu button {
            width: 100%;
            padding: 12px 20px;
            background: transparent;
            border: none;
            color: white;
            text-align: left;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-menu button:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .sidebar-menu button.active {
            background: rgba(255, 255, 255, 0.2);
            font-weight: 600;
        }

        .sidebar-footer {
            position: absolute;
            bottom: 20px;
            left: 10px;
            right: 10px;
        }

        .sidebar-footer button {
            width: 100%;
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 17px;
            font-weight: 600;
            white-space: nowrap;
            overflow: visible;
            text-overflow: clip;
        }

        .sidebar-footer button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* ‰∏ªÂÖßÂÆπÂçÄ */
        .main-content {
            flex: 1;
            overflow-y: auto;
            background: var(--cream);
        }

        .content-header {
            background: white;
            padding: 20px 30px;
            border-bottom: 1px solid #e5e7eb;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .content-header h2 {
            color: var(--wood-dark);
            font-size: 24px;
            margin-bottom: 5px;
        }

        .content-header p {
            color: var(--text-medium);
            font-size: 14px;
        }

        .content-body {
            padding: 30px;
        }

        /* Áµ±Ë®àÂç°Áâá */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #8B6F47 0%, #6B4423 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(107, 68, 35, 0.25);
            border: 2px solid rgba(212, 165, 116, 0.3);
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
        }

        /* Ë®ÇÂñÆÂç°Áâá */
        .order-card {
            border: 1px solid rgba(212, 165, 116, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
            background: var(--warm-white);
            box-shadow: 0 2px 6px var(--shadow-soft);
        }

        .order-card:hover {
            border-color: var(--wood-light);
            box-shadow: 0 4px 12px var(--shadow-medium);
            transform: translateY(-2px);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .order-number {
            font-size: 20px;
            font-weight: bold;
            color: var(--wood-dark);
        }

        .order-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }

        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .status-accepted {
            background: #dbeafe;
            color: #1e40af;
        }

        .status-completed {
            background: #d1fae5;
            color: #065f46;
        }

        .status-cancelled {
            background: #fee2e2;
            color: #991b1b;
        }

        .order-items {
            margin: 15px 0;
            padding: 15px;
            background: #f9fafb;
            border-radius: 8px;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .admin-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        /* ÊåâÈàïÊ®£Âºè */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            font-family: 'Lora', 'Noto Serif TC', serif;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--wood-medium) 0%, var(--wood-dark) 100%);
            color: var(--warm-white);
            box-shadow: 0 2px 8px rgba(107, 68, 35, 0.2);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--wood-dark) 0%, var(--wood-medium) 100%);
            box-shadow: 0 4px 12px rgba(107, 68, 35, 0.3);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--cream);
            color: var(--wood-dark);
            border: 2px solid var(--wood-light);
        }

        .btn-secondary:hover {
            background: var(--cream-dark);
            border-color: var(--wood-medium);
            transform: translateY(-2px);
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--taiwan-red) 0%, #A01F23 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(193, 39, 45, 0.2);
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #A01F23 0%, var(--taiwan-red) 100%);
            box-shadow: 0 4px 12px rgba(193, 39, 45, 0.3);
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #f59e0b;
            color: white;
        }

        .btn-warning:hover {
            background: #d97706;
            transform: translateY(-2px);
        }

        /* Ë°®Ê†º */
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 6px var(--shadow-soft);
        }

        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }

        .table th {
            background: #f9fafb;
            font-weight: bold;
            color: var(--wood-dark);
        }

        .table tr:hover {
            background: #f9fafb;
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: var(--warm-white);
            padding: 30px;
            border-radius: 12px;
            max-width: 800px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            border: 1px solid rgba(212, 165, 116, 0.2);
            box-shadow: 0 4px 20px var(--shadow-medium);
        }

        .modal-header {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            color: var(--wood-dark);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            font-family: 'Lora', 'Noto Serif TC', serif;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        /* Toggle ÈñãÈóú */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.3s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: #059669;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        .form-group-inline {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .availability-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: bold;
        }

        .badge-available {
            background: #d1fae5;
            color: #059669;
        }

        .badge-unavailable {
            background: #fee2e2;
            color: #dc2626;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #9ca3af;
        }

        .empty-state-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }

        .search-bar {
            margin-bottom: 20px;
        }

        .search-bar input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
        }

        .search-bar input:focus {
            outline: none;
            border-color: var(--wood-medium);
        }

        /* ÈÅ∏È†ÖÂç°ÁâáÊ®£Âºè */
        .option-card {
            background: var(--warm-white);
            border: 1px solid rgba(212, 165, 116, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
            box-shadow: 0 2px 6px var(--shadow-soft);
        }

        .option-card:hover {
            border-color: var(--wood-light);
            box-shadow: 0 4px 12px var(--shadow-medium);
            transform: translateY(-2px);
        }

        .option-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .option-name {
            font-size: 20px;
            font-weight: bold;
            color: var(--wood-dark);
        }

        .option-type-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: bold;
        }

        .badge-radio {
            background: #dbeafe;
            color: #1e40af;
        }

        .badge-checkbox {
            background: #fef3c7;
            color: #92400e;
        }

        .option-values-list {
            background: #f9fafb;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .option-value-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .option-value-item:last-child {
            border-bottom: none;
        }

        .option-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .option-value-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .option-value-input-group input {
            flex: 1;
        }

        .option-value-input-group button {
            padding: 8px 12px;
            font-size: 14px;
        }

        .add-value-btn {
            width: 100%;
            padding: 10px;
            background: var(--cream);
            border: 2px dashed var(--wood-light);
            color: var(--wood-dark);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Lora', 'Noto Serif TC', serif;
            font-size: 14px;
        }

        .add-value-btn:hover {
            background: var(--cream-dark);
            border-color: var(--wood-medium);
        }

        /* ÈüøÊáâÂºèË®≠Ë®à */
        @media (max-width: 768px) {
            .admin-layout {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
            }

            .sidebar-footer {
                position: static;
                margin-top: 20px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ========================================
           üé® Toast POS Style - Inventory Management
           ======================================== */

        /* Êï¥‰ΩìÂ∏ÉÂ±Ä */
        .inventory-container {
            background: #F8F9FA;
            min-height: 100vh;
            padding: 30px;
        }

        /* üé® Toast POS Style - KPI Âç°ÁâáÔºà1Â§ß+2Â∞èÂ†ÜÂè†Ôºâ */
        .kpi-cards-modern {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        /* ‰∏ªË¶ÅÂç°ÁâáÔºàÂ∫ìÂ≠òÊÄª‰ª∑ÂÄºÔºâ */
        .kpi-card-modern.primary {
            background: white;
            padding: 32px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border: 1px solid #e5e7eb;
            transition: all 0.2s;
        }

        .kpi-card-modern.primary:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
            transform: translateY(-2px);
        }

        /* Ê¨°Ë¶ÅÂç°ÁâáÔºàË≠¶Âëä‰ø°ÊÅØÔºâ */
        .kpi-card-modern.secondary {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            border: 1px solid #e5e7eb;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .kpi-card-modern.secondary:hover {
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        .kpi-value-large {
            font-size: 48px;
            font-weight: 700;
            color: #111827;
            margin-bottom: 12px;
            line-height: 1;
            letter-spacing: -0.02em;
        }

        .kpi-label-small {
            font-size: 15px;
            color: #6b7280;
            font-weight: 500;
        }

        .kpi-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 56px;
            height: 56px;
            font-size: 28px;
            font-weight: 700;
            border-radius: 12px;
            flex-shrink: 0;
        }

        .kpi-badge.warning {
            background: #fef3c7;
            color: #92400e;
        }

        .kpi-badge.danger {
            background: #fee2e2;
            color: #991b1b;
        }

        .kpi-secondary-content {
            flex: 1;
        }

        .kpi-secondary-label {
            font-size: 13px;
            color: #9ca3af;
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .kpi-secondary-value {
            font-size: 18px;
            font-weight: 600;
            color: #374151;
        }

        /* üé® Toast Style - ÊêúÁ¥¢ÂíåÁ≠õÈÄâÂå∫Ôºà‰ºòÂåñÁâàÔºâ */
        .search-filter-bar {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08), 0 1px 3px rgba(0, 0, 0, 0.06);
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .search-box-modern {
            flex: 1;
            min-width: 320px;
            max-width: 500px;
            position: relative;
        }

        .search-box-modern input {
            width: 100%;
            padding: 14px 18px 14px 44px;
            font-size: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            transition: all 0.2s;
            background: #fafafa;
        }

        .search-box-modern input:focus {
            outline: none;
            border-color: #6B4423;
            box-shadow: 0 0 0 4px rgba(107, 68, 35, 0.08);
            background: white;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
            font-size: 18px;
        }

        .filter-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .filter-select {
            padding: 10px 16px;
            font-size: 14px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-select:hover {
            border-color: #6B4423;
        }

        .btn-primary-modern {
            padding: 10px 20px;
            background: #6B4423;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary-modern:hover {
            background: #5a3a1f;
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(107, 68, 35, 0.2);
        }

        /* üé® Toast Style - Ë°®Ê†ºÔºà‰ºòÂåñË°åË∑ùÂíå‰∫§‰∫íÔºâ */
        .table-modern {
            width: 100%;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .table-modern thead {
            background: #f9fafb;
            border-bottom: 2px solid #e5e7eb;
        }

        .table-modern th {
            padding: 18px 20px;
            text-align: left;
            font-size: 12px;
            font-weight: 700;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .table-modern tbody tr {
            border-bottom: 1px solid #f3f4f6;
            transition: all 0.15s ease;
            cursor: pointer;
        }

        .table-modern tbody tr:hover {
            background: #fafbfc;
            box-shadow: inset 0 0 0 1px #e5e7eb;
        }

        .table-modern tbody tr:active {
            background: #f3f4f6;
        }

        .table-modern td {
            padding: 22px 20px;
            font-size: 15px;
            color: #111827;
            min-height: 64px;
            vertical-align: middle;
        }

        /* Â∫ìÂ≠òÊï∞Â≠óÊ†∑Âºè */
        .inventory-qty {
            font-size: 24px;
            font-weight: 700;
            line-height: 1;
        }

        .inventory-unit {
            font-size: 13px;
            color: #9ca3af;
            font-weight: 500;
            margin-left: 6px;
        }

        /* Áä∂ÊÄÅ Badge */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 600;
        }

        .status-badge.ok {
            background: #d1fae5;
            color: #065f46;
        }

        .status-badge.low {
            background: #fef3c7;
            color: #92400e;
        }

        .status-badge.out {
            background: #fee2e2;
            color: #991b1b;
        }

        /* üé® Toast Style - Êìç‰ΩúÊåâÈíÆÔºàÊô∫ËÉΩÂåñÔºâ */
        .action-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        /* Âü∫Á°ÄËøõË¥ßÊåâÈíÆ */
        .btn-action-primary {
            padding: 10px 18px;
            background: #6B4423;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 1px 3px rgba(107, 68, 35, 0.2);
        }

        .btn-action-primary:hover {
            background: #5a3a1f;
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(107, 68, 35, 0.3);
        }

        /* Ê≠£Â∏∏Â∫ìÂ≠ò - Ê∑°Ëâ≤ÊåâÈíÆ */
        .btn-action-primary.normal {
            background: #9ca3af;
            color: white;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .btn-action-primary.normal:hover {
            background: #6b7280;
        }

        /* ‰ΩéÂ∫ìÂ≠ò - Ë≠¶ÂëäËâ≤ */
        .btn-action-primary.low {
            background: #f59e0b;
            color: white;
        }

        .btn-action-primary.low:hover {
            background: #d97706;
        }

        /* Áº∫Ë¥ß - È´ò‰∫ÆËâ≤ */
        .btn-action-primary.urgent {
            background: #ef4444;
            color: white;
            animation: pulse 2s infinite;
        }

        .btn-action-primary.urgent:hover {
            background: #dc2626;
            animation: none;
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 1px 3px rgba(239, 68, 68, 0.3);
            }
            50% {
                box-shadow: 0 4px 12px rgba(239, 68, 68, 0.5);
            }
        }

        .btn-more {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            color: #6b7280;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.2s;
            position: relative;
        }

        .btn-more:hover {
            background: #f3f4f6;
            border-color: #9ca3af;
        }

        /* ‰∏ãÊãâËèúÂçï */
        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 4px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            min-width: 160px;
            z-index: 1000;
            overflow: hidden;
        }

        .dropdown-item {
            padding: 10px 16px;
            font-size: 14px;
            color: #374151;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
        }

        .dropdown-item:hover {
            background: #f3f4f6;
        }

        .dropdown-divider {
            height: 1px;
            background: #e5e7eb;
            margin: 4px 0;
        }

        /* Â±ïÂºÄËØ¶ÊÉÖÂå∫ */
        .expanded-details {
            background: #f9fafb;
            border-top: 1px solid #e5e7eb;
            padding: 20px;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
            }
            to {
                opacity: 1;
                max-height: 500px;
            }
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .detail-label {
            font-size: 12px;
            color: #6b7280;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .detail-value {
            font-size: 16px;
            color: #111827;
            font-weight: 600;
        }

        .recent-transactions {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #e5e7eb;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            font-size: 13px;
            color: #6b7280;
        }

        /* ÂìçÂ∫îÂºè */
        @media (max-width: 768px) {
            .kpi-cards-modern {
                grid-template-columns: 1fr;
            }

            .search-filter-bar {
                flex-direction: column;
                align-items: stretch;
            }

            .search-box-modern {
                max-width: 100%;
            }

            .filter-group {
                flex-direction: column;
                align-items: stretch;
            }

            .table-modern {
                font-size: 13px;
            }

            .table-modern td {
                padding: 12px 8px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Supabase ÂàùÂßãÂåñ -->
    <script>
        // Supabase ÈÖçÁΩÆ
        var SUPABASE_URL = 'https://tskelejztsdeewtpjcoq.supabase.co';
        var SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRza2VsZWp6dHNkZWV3dHBqY29xIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExOTUxNjUsImV4cCI6MjA4Njc3MTE2NX0.WFGyeBVRIXfrA9h2BVwQ9zpbmcHDXmI0xsFfdDVdGos';

        window.supabaseClient = null;
        window.supabaseReady = false;

        // Âä®ÊÄÅÂä†ËΩΩ Supabase CDN
        (function() {
            var script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.js';

            script.onload = function() {
                console.log('‚úÖ [Admin] Supabase CDN loaded');
                if (window.supabase && window.supabase.createClient) {
                    try {
                        window.supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                        window.supabaseReady = true;
                        console.log('‚úÖ [Admin] Supabase client initialized');
                    } catch (e) {
                        console.error('‚ùå [Admin] Supabase initialization failed:', e);
                    }
                }
            };

            script.onerror = function() {
                console.error('‚ùå [Admin] Supabase CDN loading failed');
            };

            document.head.appendChild(script);
        })();
    </script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ‰∏äÂÇ≥ÂúñÁâáÂà∞ Supabase Storage
        const uploadImageToSupabase = async (file) => {
            try {
                if (!window.supabaseClient) {
                    throw new Error('Supabase client not initialized');
                }

                // ÁîüÊàêÂîØ‰∏ÄÊñá‰ª∂Âêç
                const fileExt = file.name.split('.').pop();
                const fileName = `${Date.now()}-${Math.random().toString(36).substring(7)}.${fileExt}`;
                const filePath = `menu/${fileName}`;

                console.log('üì§ Uploading image:', filePath);

                // ‰∏äÂÇ≥Êñá‰ª∂Âà∞ Storage
                const { data, error } = await window.supabaseClient.storage
                    .from('menu-images')
                    .upload(filePath, file, {
                        cacheControl: '3600',
                        upsert: false
                    });

                if (error) {
                    console.error('‚ùå Upload error:', error);
                    throw error;
                }

                // Áç≤ÂèñÂÖ¨Èñã URL
                const { data: urlData } = window.supabaseClient.storage
                    .from('menu-images')
                    .getPublicUrl(filePath);

                console.log('‚úÖ Image uploaded:', urlData.publicUrl);
                return urlData.publicUrl;
            } catch (error) {
                console.error('‚ùå Error uploading image:', error);
                throw error;
            }
        };

        // Âæû Supabase Âä†ËºâÊï∏Êìö
        const loadFromSupabase = async (table) => {
            try {
                if (!window.supabaseReady || !window.supabaseClient) {
                    console.warn(`‚ö†Ô∏è Supabase not ready, using localStorage for ${table}`);
                    return null;
                }

                console.log(`üì° Loading ${table} from Supabase...`);
                const { data, error } = await window.supabaseClient
                    .from(table)
                    .select('*')
                    .order('id');

                if (error) {
                    console.error(`‚ùå Error loading ${table}:`, error);
                    return null;
                }

                console.log(`‚úÖ Loaded ${data.length} items from ${table}`);
                return data;
            } catch (error) {
                console.error(`‚ùå Error loading from Supabase ${table}:`, error);
                return null;
            }
        };

        // ‰øùÂ≠òËèúÂñÆÂà∞ Supabase
        const saveMenuToSupabase = async (menuData) => {
            try {
                if (!window.supabaseReady || !window.supabaseClient) {
                    console.warn('‚ö†Ô∏è Supabase not ready, using localStorage');
                    localStorage.setItem('menu', JSON.stringify(menuData));
                    return false;
                }

                console.log('üíæ Saving menu to Supabase...');

                // ËΩâÊèõÂâçÁ´ØÊ†ºÂºèÂà∞Êï∏ÊìöÂ∫´Ê†ºÂºè
                const dbFormat = menuData.map(item => ({
                    id: item.id,
                    name: item.name,
                    english_name: item.englishName || null,
                    price: parseFloat(item.price),
                    category: item.category,
                    emoji: item.emoji || null,
                    image: item.image || null,
                    description: item.description || null,
                    available: item.isAvailable !== false,
                    applied_option_ids: item.appliedOptionIds || []
                }));

                const { error } = await window.supabaseClient
                    .from('menu')
                    .upsert(dbFormat, { onConflict: 'id' });

                if (error) {
                    console.error('‚ùå Error saving menu:', error);
                    // ÂÇôÁî®Ôºö‰øùÂ≠òÂà∞ localStorage
                    localStorage.setItem('menu', JSON.stringify(menuData));
                    return false;
                }

                console.log('‚úÖ Menu saved to Supabase');
                return true;
            } catch (error) {
                console.error('‚ùå Error:', error);
                localStorage.setItem('menu', JSON.stringify(menuData));
                return false;
            }
        };

        // ‰øùÂ≠òÈÅ∏È†ÖÂ∫´Âà∞ Supabase
        const saveOptionsToSupabase = async (optionsData) => {
            try {
                if (!window.supabaseReady || !window.supabaseClient) {
                    console.warn('‚ö†Ô∏è Supabase not ready, using localStorage');
                    localStorage.setItem('optionsLibrary', JSON.stringify(optionsData));
                    return false;
                }

                console.log('üíæ Saving options to Supabase...');

                // ËΩâÊèõÂâçÁ´ØÊ†ºÂºèÂà∞Êï∏ÊìöÂ∫´Ê†ºÂºè
                const dbFormat = optionsData.map(item => ({
                    id: item.id,
                    name: item.name,
                    type: item.type,
                    required: item.required || false,
                    is_enabled: item.isEnabled !== false,
                    categories: item.categories || [],
                    choices: item.choices
                }));

                const { error } = await window.supabaseClient
                    .from('options_library')
                    .upsert(dbFormat, { onConflict: 'id' });

                if (error) {
                    console.error('‚ùå Error saving options:', error);
                    localStorage.setItem('optionsLibrary', JSON.stringify(optionsData));
                    return false;
                }

                console.log('‚úÖ Options saved to Supabase');
                return true;
            } catch (error) {
                console.error('‚ùå Error:', error);
                localStorage.setItem('optionsLibrary', JSON.stringify(optionsData));
                return false;
            }
        };

        // Êõ¥Êñ∞Ë®ÇÂñÆÁãÄÊÖãÂà∞ Supabase
        const updateOrderInSupabase = async (orderId, updates) => {
            try {
                if (!window.supabaseReady || !window.supabaseClient) {
                    console.warn('‚ö†Ô∏è Supabase not ready, using localStorage');
                    return false;
                }

                console.log(`üíæ Updating order ${orderId} in Supabase...`);

                const { error } = await window.supabaseClient
                    .from('orders')
                    .update({
                        status: updates.status,
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', orderId);

                if (error) {
                    console.error('‚ùå Error updating order:', error);
                    return false;
                }

                console.log('‚úÖ Order updated in Supabase');
                return true;
            } catch (error) {
                console.error('‚ùå Error:', error);
                return false;
            }
        };

        // Âæû localStorage ËÆÄÂèñÊï∏ÊìöÔºàÂÇôÁî®Ôºâ
        const loadFromLocalStorage = (key, defaultValue) => {
            try {
                const item = localStorage.getItem(key);
                return item ? JSON.parse(item) : defaultValue;
            } catch (error) {
                console.error('Error loading from localStorage:', error);
                return defaultValue;
            }
        };

        // ÂÑ≤Â≠òÂà∞ localStorageÔºàÂÇôÁî®Ôºâ
        const saveToLocalStorage = (key, value) => {
            try {
                localStorage.setItem(key, JSON.stringify(value));
            } catch (error) {
                console.error('Error saving to localStorage:', error);
            }
        };

        // ÁôªÂÖ•ÁµÑ‰ª∂ - ‰ΩøÁî® Supabase Auth
        function AdminLogin({ onLogin }) {
            const [email, setEmail] = React.useState('');
            const [password, setPassword] = React.useState('');
            const [error, setError] = React.useState('');
            const [loading, setLoading] = React.useState(false);

            const handleLogin = async (e) => {
                e.preventDefault();
                setError('');
                setLoading(true);

                try {
                    // Á≠âÂæÖ Supabase ÂàùÂßãÂåñ
                    let attempts = 0;
                    while (!window.supabaseReady && attempts < 50) {
                        await new Promise(resolve => setTimeout(resolve, 100));
                        attempts++;
                    }

                    if (!window.supabaseReady || !window.supabaseClient) {
                        throw new Error('Supabase Êú™ÂàùÂßãÂåñÔºåË´ãÂà∑Êñ∞È†ÅÈù¢ÈáçË©¶');
                    }

                    console.log('üîê Attempting login with email:', email);

                    // ‰ΩøÁî® Supabase Auth ÁôªÂÖ•
                    const { data, error: authError } = await window.supabaseClient.auth.signInWithPassword({
                        email: email,
                        password: password
                    });

                    if (authError) {
                        console.error('‚ùå Login error:', authError);
                        throw authError;
                    }

                    if (data && data.user) {
                        console.log('‚úÖ Login successful:', data.user.email);
                        onLogin(data.session);
                    } else {
                        throw new Error('ÁôªÂÖ•Â§±ÊïóÔºöÁÑ°Ê≥ïÁç≤ÂèñÁî®Êà∂‰ø°ÊÅØ');
                    }
                } catch (err) {
                    console.error('‚ùå Login failed:', err);
                    if (err.message.includes('Invalid login credentials')) {
                        setError('ÁôªÂÖ•Â§±ÊïóÔºöÈÉµÁÆ±ÊàñÂØÜÁ¢ºÈåØË™§');
                    } else if (err.message.includes('Email not confirmed')) {
                        setError('Ë´ãÂÖàÁ¢∫Ë™çÊÇ®ÁöÑÈÉµÁÆ±Âú∞ÂùÄ');
                    } else {
                        setError(err.message || 'ÁôªÂÖ•Â§±ÊïóÔºåË´ãÈáçË©¶');
                    }
                } finally {
                    setLoading(false);
                }
            };

            return React.createElement('div', { className: 'login-container' },
                React.createElement('h2', { className: 'login-title' }, 'üîê ÁÆ°ÁêÜÂæåÂè∞ÁôªÂÖ•'),
                React.createElement('form', { onSubmit: handleLogin },
                    React.createElement('div', { className: 'form-group' },
                        React.createElement('label', null, 'ÁÆ°ÁêÜÂì°ÈÉµÁÆ±'),
                        React.createElement('input', {
                            type: 'email',
                            value: email,
                            onChange: (e) => setEmail(e.target.value),
                            placeholder: 'Ë´ãËº∏ÂÖ•ÁÆ°ÁêÜÂì°ÈÉµÁÆ±',
                            required: true,
                            disabled: loading
                        })
                    ),
                    React.createElement('div', { className: 'form-group', style: { marginTop: '15px' } },
                        React.createElement('label', null, 'ÂØÜÁ¢º'),
                        React.createElement('input', {
                            type: 'password',
                            value: password,
                            onChange: (e) => setPassword(e.target.value),
                            placeholder: 'Ë´ãËº∏ÂÖ•ÂØÜÁ¢º',
                            required: true,
                            disabled: loading
                        })
                    ),
                    error && React.createElement('p', {
                        style: { color: 'red', marginBottom: '15px' }
                    }, error),
                    React.createElement('button', {
                        type: 'submit',
                        className: 'btn btn-primary',
                        style: { width: '100%' },
                        disabled: loading
                    }, loading ? 'ÁôªÂÖ•‰∏≠...' : 'ÁôªÂÖ•')
                ),
                React.createElement('p', {
                    style: { marginTop: '20px', textAlign: 'center', color: '#666', fontSize: '14px' }
                }, '‰ΩøÁî® Supabase Auth ÁÆ°ÁêÜÂì°Â∏≥ËôüÁôªÂÖ•')
            );
        }

        // ÂÑÄË°®ÊùøÁµÑ‰ª∂
        function Dashboard({ orders, menu }) {
            const today = new Date().toDateString();

            const todayOrders = orders.filter(order =>
                new Date(order.timestamp).toDateString() === today
            );

            const stats = {
                orderCount: todayOrders.length,
                revenue: todayOrders.reduce((sum, order) => sum + order.total, 0),
                itemCount: todayOrders.reduce((sum, order) =>
                    sum + order.items.reduce((itemSum, item) => itemSum + item.quantity, 0), 0
                ),
                pendingCount: todayOrders.filter(o => o.status === 'pending').length
            };

            const pendingOrders = orders.filter(o => o.status === 'pending');

            return (
                <div>
                    <div className="stats-grid">
                        <div className="stat-card">
                            <div className="stat-label">‰ªäÊó•Ë®ÇÂñÆÊï∏</div>
                            <div className="stat-value">{stats.orderCount}</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">‰ªäÊó•ÁáüÊ•≠È°ç</div>
                            <div className="stat-value">${stats.revenue.toFixed(2)}</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">‰ªäÊó•Èä∑ÂîÆÊï∏Èáè</div>
                            <div className="stat-value">{stats.itemCount}</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">ÂæÖËôïÁêÜË®ÇÂñÆ</div>
                            <div className="stat-value">{stats.pendingCount}</div>
                        </div>
                    </div>

                    <h3 style={{ marginTop: '30px', marginBottom: '15px', color: '#6B4423' }}>
                        üîî ÂæÖËôïÁêÜË®ÇÂñÆ ({pendingOrders.length})
                    </h3>

                    {pendingOrders.length === 0 ? (
                        <div className="empty-state">
                            <div className="empty-state-icon">‚úÖ</div>
                            <p>ÁõÆÂâçÊ≤íÊúâÂæÖËôïÁêÜÁöÑË®ÇÂñÆ</p>
                        </div>
                    ) : (
                        pendingOrders.map(order => (
                            <OrderCard key={order.id} order={order} />
                        ))
                    )}
                </div>
            );
        }

        // Ë®ÇÂñÆÁÆ°ÁêÜÁµÑ‰ª∂
        function OrderManagement({ orders, onUpdateOrder }) {
            const [filter, setFilter] = useState('all');
            const [searchTerm, setSearchTerm] = useState('');

            const filteredOrders = orders.filter(order => {
                const matchesFilter = filter === 'all' || order.status === filter;
                const matchesSearch = order.id.toString().includes(searchTerm) ||
                                    order.customerName?.toLowerCase().includes(searchTerm.toLowerCase());
                return matchesFilter && matchesSearch;
            });

            return (
                <div>
                    <div style={{ display: 'flex', gap: '10px', marginBottom: '20px' }}>
                        <button
                            className={`btn ${filter === 'all' ? 'btn-primary' : 'btn-secondary'}`}
                            onClick={() => setFilter('all')}
                        >
                            ÂÖ®ÈÉ® ({orders.length})
                        </button>
                        <button
                            className={`btn ${filter === 'pending' ? 'btn-primary' : 'btn-secondary'}`}
                            onClick={() => setFilter('pending')}
                        >
                            ÂæÖËôïÁêÜ ({orders.filter(o => o.status === 'pending').length})
                        </button>
                        <button
                            className={`btn ${filter === 'accepted' ? 'btn-primary' : 'btn-secondary'}`}
                            onClick={() => setFilter('accepted')}
                        >
                            ÈÄ≤Ë°å‰∏≠ ({orders.filter(o => o.status === 'accepted').length})
                        </button>
                        <button
                            className={`btn ${filter === 'completed' ? 'btn-primary' : 'btn-secondary'}`}
                            onClick={() => setFilter('completed')}
                        >
                            Â∑≤ÂÆåÊàê ({orders.filter(o => o.status === 'completed').length})
                        </button>
                    </div>

                    <div className="search-bar">
                        <input
                            type="text"
                            placeholder="ÊêúÂ∞ãË®ÇÂñÆÁ∑®ËôüÊàñÈ°ßÂÆ¢ÂßìÂêç..."
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                        />
                    </div>

                    {filteredOrders.length === 0 ? (
                        <div className="empty-state">
                            <div className="empty-state-icon">üì¶</div>
                            <p>Ê≤íÊúâÊâæÂà∞Ë®ÇÂñÆ</p>
                        </div>
                    ) : (
                        filteredOrders.map(order => (
                            <OrderCard
                                key={order.id}
                                order={order}
                                onUpdateOrder={onUpdateOrder}
                            />
                        ))
                    )}
                </div>
            );
        }

        // Ë®ÇÂñÆÂç°ÁâáÁµÑ‰ª∂
        function OrderCard({ order, onUpdateOrder }) {
            const statusMap = {
                pending: { text: 'ÂæÖËôïÁêÜ', class: 'status-pending' },
                accepted: { text: 'ÈÄ≤Ë°å‰∏≠', class: 'status-accepted' },
                completed: { text: 'Â∑≤ÂÆåÊàê', class: 'status-completed' },
                cancelled: { text: 'Â∑≤ÂèñÊ∂à', class: 'status-cancelled' }
            };

            const handleStatusChange = (newStatus) => {
                if (onUpdateOrder) {
                    onUpdateOrder(order.id, { ...order, status: newStatus });
                }
            };

            return (
                <div className="order-card">
                    <div className="order-header">
                        <div>
                            <div className="order-number">Ë®ÇÂñÆ #{order.id}</div>
                            <div style={{ fontSize: '14px', color: '#666', marginTop: '5px' }}>
                                {new Date(order.timestamp).toLocaleString('zh-TW')}
                            </div>
                        </div>
                        <span className={`order-status ${statusMap[order.status].class}`}>
                            {statusMap[order.status].text}
                        </span>
                    </div>

                    {order.customerName && (
                        <div style={{ marginBottom: '10px', fontSize: '15px' }}>
                            <strong>È°ßÂÆ¢:</strong> {order.customerName}
                            {order.phone && ` ‚Ä¢ ${order.phone}`}
                        </div>
                    )}

                    {order.serviceMode && (
                        <div style={{ marginBottom: '10px', fontSize: '15px' }}>
                            <strong>Áî®È§êÊñπÂºè:</strong> {order.serviceMode === 'dine-in' || order.serviceMode === 'dine_in' ? 'ÂÖßÁî®' : order.serviceMode === 'takeout' ? 'Â§ñÂ∏∂' : order.serviceMode === 'scheduled' ? 'È†êÁ¥Ñ' : order.serviceMode}
                        </div>
                    )}

                    {order.orderSource && (
                        <div style={{ marginBottom: '10px', fontSize: '15px' }}>
                            <strong>Ë®ÇÂñÆ‰æÜÊ∫ê:</strong>
                            <span style={{
                                marginLeft: '8px',
                                padding: '2px 8px',
                                background: order.orderSource === 'staff_pos' ? '#dbeafe' : '#fef3c7',
                                color: order.orderSource === 'staff_pos' ? '#1e40af' : '#92400e',
                                borderRadius: '4px',
                                fontSize: '13px'
                            }}>
                                {order.orderSource === 'staff_pos' ? 'üë§ Âì°Â∑• POS' : 'üåê ÂâçÂè∞È°ßÂÆ¢'}
                            </span>
                        </div>
                    )}

                    {order.paymentMethod && (
                        <div style={{ marginBottom: '10px', fontSize: '15px' }}>
                            <strong>‰ªòÊ¨æÊñπÂºè:</strong>
                            {order.paymentMethod === 'cash' ? ' üíµ ÁèæÈáë' :
                             order.paymentMethod === 'card' ? ' üí≥ Âà∑Âç°' :
                             order.paymentMethod === 'qr_code' ? ' üì± ÊéÉÁ¢º' : ` ${order.paymentMethod}`}
                            {order.paymentStatus && (
                                <span style={{
                                    marginLeft: '8px',
                                    padding: '2px 8px',
                                    background: order.paymentStatus === 'paid' ? '#d1fae5' : order.paymentStatus === 'unpaid' ? '#fee2e2' : '#f3f4f6',
                                    color: order.paymentStatus === 'paid' ? '#065f46' : order.paymentStatus === 'unpaid' ? '#991b1b' : '#374151',
                                    borderRadius: '4px',
                                    fontSize: '13px'
                                }}>
                                    {order.paymentStatus === 'paid' ? '‚úÖ Â∑≤‰ªòÊ¨æ' :
                                     order.paymentStatus === 'unpaid' ? '‚è≥ Êú™‰ªòÊ¨æ' :
                                     order.paymentStatus === 'refunded' ? 'üîô Â∑≤ÈÄÄÊ¨æ' : order.paymentStatus}
                                </span>
                            )}
                        </div>
                    )}

                    {order.staffName && (
                        <div style={{ marginBottom: '10px', fontSize: '15px' }}>
                            <strong>Êìç‰ΩúÂì°Â∑•:</strong> {order.staffName}
                        </div>
                    )}

                    {order.hasCustomItems && (
                        <div style={{ marginBottom: '10px', fontSize: '13px', color: '#6b7280' }}>
                            ‚ö†Ô∏è Ê≠§Ë®ÇÂñÆÂåÖÂê´Ëá™ÂÆöÁæ©È†ÖÁõÆ
                        </div>
                    )}

                    <div className="order-items">
                        {order.items.map((item, index) => (
                            <div key={index} className="order-item">
                                <span>{item.name} x {item.quantity}</span>
                                <span>${(item.price * item.quantity).toFixed(2)}</span>
                            </div>
                        ))}
                        <div style={{ marginTop: '10px', paddingTop: '10px', borderTop: '1px solid #e5e7eb', fontWeight: 'bold' }}>
                            <div className="order-item">
                                <span>Á∏ΩË®à</span>
                                <span style={{ color: '#6B4423', fontSize: '18px' }}>${order.total.toFixed(2)}</span>
                            </div>
                        </div>
                    </div>

                    {order.notes && (
                        <div style={{ marginTop: '10px', padding: '10px', background: '#fef3c7', borderRadius: '5px', fontSize: '14px' }}>
                            <strong>ÂÇôË®ª:</strong> {order.notes}
                        </div>
                    )}

                    {onUpdateOrder && order.status !== 'completed' && order.status !== 'cancelled' && (
                        <div className="admin-actions">
                            {order.status === 'pending' && (
                                <>
                                    <button
                                        className="btn btn-success"
                                        onClick={() => handleStatusChange('accepted')}
                                    >
                                        Êé•ÂèóË®ÇÂñÆ
                                    </button>
                                    <button
                                        className="btn btn-danger"
                                        onClick={() => handleStatusChange('cancelled')}
                                    >
                                        ÊãíÁµïË®ÇÂñÆ
                                    </button>
                                </>
                            )}
                            {order.status === 'accepted' && (
                                <button
                                    className="btn btn-success"
                                    onClick={() => handleStatusChange('completed')}
                                >
                                    ÂÆåÊàêË®ÇÂñÆ
                                </button>
                            )}
                        </div>
                    )}
                </div>
            );
        }

        // ËèúÂñÆÁÆ°ÁêÜÁµÑ‰ª∂
        function MenuManagement({ menu, onUpdateMenu, optionsLibrary = [] }) {
            const [editingItem, setEditingItem] = useState(null);
            const [showModal, setShowModal] = useState(false);
            const [filter, setFilter] = useState('all');
            const [searchTerm, setSearchTerm] = useState('');

            const categories = {
                all: 'ÂÖ®ÈÉ®',
                highlight: 'Â∞èÂ∫óÁ≤æÈÅ∏',
                fried: 'ÂêÑÂºèÁÇ∏Áâ©',
                bento: '‰æøÁï∂/ËìãÈ£Ø',
                drinks: 'È£≤Êñô'
            };

            // ÂàÜÈ°ûÈ°èËâ≤ÈÖçÁΩÆ
            const categoryColors = {
                highlight: { bg: '#FFF3E0', color: '#E65100', icon: '‚≠ê' },
                fried: { bg: '#FFF9C4', color: '#F57F17', icon: 'üçó' },
                bento: { bg: '#E8F5E9', color: '#2E7D32', icon: 'üç±' },
                drinks: { bg: '#E3F2FD', color: '#1565C0', icon: 'ü•§' }
            };

            // ÈÅéÊøæÈÇèËºØÔºöÂàÜÈ°û + ÊêúÂ∞ã
            const filteredMenu = menu.filter(item => {
                // ÂàÜÈ°ûÈÅéÊøæ
                const matchCategory = filter === 'all' || item.category === filter;

                // ÊêúÂ∞ãÈÅéÊøæÔºàÊîØÊè¥‰∏≠Ëã±Êñá„ÄÅÂÉπÊ†ºÔºâ
                const searchLower = searchTerm.toLowerCase();
                const matchSearch = !searchTerm ||
                    item.name.toLowerCase().includes(searchLower) ||
                    (item.englishName && item.englishName.toLowerCase().includes(searchLower)) ||
                    item.price.toString().includes(searchLower);

                return matchCategory && matchSearch;
            });

            const handleSaveItem = (item) => {
                const updatedMenu = editingItem.id
                    ? menu.map(m => m.id === item.id ? item : m)
                    : [...menu, { ...item, id: Date.now() }];

                onUpdateMenu(updatedMenu);
                setShowModal(false);
                setEditingItem(null);
            };

            const handleDeleteItem = (id) => {
                if (confirm('Á¢∫ÂÆöË¶ÅÂà™Èô§ÈÄôÂÄãËèúÂñÆÈ†ÖÁõÆÂóéÔºü')) {
                    onUpdateMenu(menu.filter(item => item.id !== id));
                }
            };

            const handleToggleAvailability = (id) => {
                const updatedMenu = menu.map(item =>
                    item.id === id ? { ...item, available: !item.available } : item
                );
                onUpdateMenu(updatedMenu);
            };

            return (
                <div>
                    {/* ÊêúÂ∞ãÊ¨Ñ */}
                    <div style={{
                        marginBottom: '20px',
                        padding: '15px 20px',
                        background: 'white',
                        borderRadius: '12px',
                        boxShadow: '0 2px 4px rgba(0,0,0,0.05)'
                    }}>
                        <div style={{ position: 'relative' }}>
                            <span style={{
                                position: 'absolute',
                                left: '15px',
                                top: '50%',
                                transform: 'translateY(-50%)',
                                fontSize: '18px',
                                color: '#999'
                            }}>üîç</span>
                            <input
                                type="text"
                                placeholder="ÊêúÂ∞ãËèúÂñÆÂêçÁ®±„ÄÅËã±ÊñáÂêçÊàñÂÉπÊ†º..."
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                                style={{
                                    width: '100%',
                                    padding: '12px 15px 12px 45px',
                                    border: '2px solid #E8DCC8',
                                    borderRadius: '8px',
                                    fontSize: '15px',
                                    outline: 'none',
                                    transition: 'border-color 0.3s'
                                }}
                                onFocus={(e) => e.target.style.borderColor = '#8B6F47'}
                                onBlur={(e) => e.target.style.borderColor = '#E8DCC8'}
                            />
                            {searchTerm && (
                                <button
                                    onClick={() => setSearchTerm('')}
                                    style={{
                                        position: 'absolute',
                                        right: '15px',
                                        top: '50%',
                                        transform: 'translateY(-50%)',
                                        background: 'none',
                                        border: 'none',
                                        fontSize: '18px',
                                        cursor: 'pointer',
                                        color: '#999'
                                    }}
                                >‚úï</button>
                            )}
                        </div>
                        <div style={{
                            marginTop: '10px',
                            fontSize: '13px',
                            color: '#666'
                        }}>
                            ÊâæÂà∞ {filteredMenu.length} ÂÄãËèúÂñÆÈ†ÖÁõÆ
                        </div>
                    </div>

                    {/* ÂàÜÈ°ûËàáÊñ∞Â¢ûÊåâÈàï */}
                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '20px' }}>
                        <div style={{ display: 'flex', gap: '10px' }}>
                            {Object.entries(categories).map(([key, label]) => (
                                <button
                                    key={key}
                                    className={`btn ${filter === key ? 'btn-primary' : 'btn-secondary'}`}
                                    onClick={() => setFilter(key)}
                                >
                                    {label}
                                </button>
                            ))}
                        </div>
                        <button
                            className="btn btn-success"
                            onClick={() => {
                                setEditingItem({
                                    name: '',
                                    englishName: '',
                                    price: 0,
                                    category: 'highlight',
                                    emoji: 'üç±',
                                    image: '',
                                    description: '',
                                    available: true,
                                    options: []
                                });
                                setShowModal(true);
                            }}
                        >
                            ‚ûï Êñ∞Â¢ûËèúÂñÆ
                        </button>
                    </div>

                    <table className="table">
                        <thead>
                            <tr>
                                <th>ÂêçÁ®±</th>
                                <th>ÂàÜÈ°û</th>
                                <th>ÂÉπÊ†º</th>
                                <th>ÁãÄÊÖã</th>
                                <th>Êìç‰Ωú</th>
                            </tr>
                        </thead>
                        <tbody>
                            {filteredMenu.map(item => (
                                <tr key={item.id}>
                                    <td>
                                        <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>
                                            <span style={{ fontSize: '24px' }}>{item.emoji}</span>
                                            <div>
                                                <div style={{ fontWeight: 'bold' }}>{item.name}</div>
                                                <div style={{ fontSize: '12px', color: '#666' }}>
                                                    {item.englishName}
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <span style={{
                                            display: 'inline-flex',
                                            alignItems: 'center',
                                            gap: '5px',
                                            padding: '6px 12px',
                                            borderRadius: '6px',
                                            fontSize: '13px',
                                            fontWeight: '500',
                                            backgroundColor: categoryColors[item.category]?.bg || '#f5f5f5',
                                            color: categoryColors[item.category]?.color || '#666'
                                        }}>
                                            {categoryColors[item.category]?.icon} {categories[item.category]}
                                        </span>
                                    </td>
                                    <td style={{ fontWeight: 'bold', color: '#6B4423' }}>
                                        ${item.price.toFixed(2)}
                                    </td>
                                    <td>
                                        <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>
                                            <label className="toggle-switch">
                                                <input
                                                    type="checkbox"
                                                    checked={item.available !== false}
                                                    onChange={() => handleToggleAvailability(item.id)}
                                                />
                                                <span className="toggle-slider"></span>
                                            </label>
                                            <span style={{
                                                fontSize: '13px',
                                                fontWeight: '500',
                                                color: item.available !== false ? '#2E7D32' : '#757575'
                                            }}>
                                                {item.available !== false ? '‚úì ‰æõÊáâ‰∏≠' : '‚úï Â∑≤ÂÅúÂîÆ'}
                                            </span>
                                        </div>
                                    </td>
                                    <td>
                                        <div style={{ display: 'flex', gap: '5px' }}>
                                            <button
                                                className="btn btn-secondary"
                                                style={{ padding: '5px 10px', fontSize: '14px' }}
                                                onClick={() => {
                                                    setEditingItem(item);
                                                    setShowModal(true);
                                                }}
                                            >
                                                Á∑®ËºØ
                                            </button>
                                            <button
                                                className="btn btn-danger"
                                                style={{ padding: '5px 10px', fontSize: '14px' }}
                                                onClick={() => handleDeleteItem(item.id)}
                                            >
                                                Âà™Èô§
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>

                    {showModal && (
                        <MenuItemModal
                            item={editingItem}
                            onSave={handleSaveItem}
                            onClose={() => {
                                setShowModal(false);
                                setEditingItem(null);
                            }}
                            optionsLibrary={optionsLibrary}
                        />
                    )}
                </div>
            );
        }

        // ËèúÂñÆÈ†ÖÁõÆÁ∑®ËºØ Modal
        function MenuItemModal({ item, onSave, onClose, optionsLibrary = [] }) {
            const [formData, setFormData] = useState(item);

            const handleChange = (field, value) => {
                setFormData({ ...formData, [field]: value });
            };

            const handleToggleOption = (optionId) => {
                const currentIds = formData.appliedOptionIds || [];
                const newIds = currentIds.includes(optionId)
                    ? currentIds.filter(id => id !== optionId)
                    : [...currentIds, optionId];
                setFormData({ ...formData, appliedOptionIds: newIds });
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave(formData);
            };

            return (
                <div className="modal" onClick={onClose}>
                    <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                        <div className="modal-header">
                            {item.id ? 'Á∑®ËºØËèúÂñÆÈ†ÖÁõÆ' : 'Êñ∞Â¢ûËèúÂñÆÈ†ÖÁõÆ'}
                        </div>
                        <form onSubmit={handleSubmit}>
                            <div className="form-group">
                                <label>‰∏≠ÊñáÂêçÁ®± *</label>
                                <input
                                    type="text"
                                    value={formData.name}
                                    onChange={(e) => handleChange('name', e.target.value)}
                                    required
                                />
                            </div>
                            <div className="form-group">
                                <label>Ëã±ÊñáÂêçÁ®±</label>
                                <input
                                    type="text"
                                    value={formData.englishName}
                                    onChange={(e) => handleChange('englishName', e.target.value)}
                                />
                            </div>
                            <div className="form-group">
                                <label>ÂÉπÊ†º *</label>
                                <input
                                    type="number"
                                    step="0.01"
                                    value={formData.price}
                                    onChange={(e) => handleChange('price', parseFloat(e.target.value))}
                                    required
                                />
                            </div>
                            <div className="form-group">
                                <label>ÂàÜÈ°û *</label>
                                <select
                                    value={formData.category}
                                    onChange={(e) => handleChange('category', e.target.value)}
                                    required
                                >
                                    <option value="highlight">Â∞èÂ∫óÁ≤æÈÅ∏</option>
                                    <option value="fried">ÂêÑÂºèÁÇ∏Áâ©</option>
                                    <option value="bento">‰æøÁï∂/ËìãÈ£Ø</option>
                                    <option value="drinks">È£≤Êñô</option>
                                </select>
                            </div>
                            <div className="form-group">
                                <label>ÂúñÁ§∫ Emoji</label>
                                <input
                                    type="text"
                                    value={formData.emoji}
                                    onChange={(e) => handleChange('emoji', e.target.value)}
                                    placeholder="üç±"
                                />
                            </div>
                            <div className="form-group">
                                <label>ÂúñÁâá</label>

                                {/* ÂõæÁâáÈ¢ÑËßà */}
                                {formData.image && (
                                    <div style={{
                                        marginBottom: '10px',
                                        border: '2px solid #e0e0e0',
                                        borderRadius: '8px',
                                        padding: '10px',
                                        background: '#f9f9f9'
                                    }}>
                                        <img
                                            src={formData.image}
                                            alt="ÂïÜÂìÅÂúñÁâá"
                                            style={{
                                                maxWidth: '200px',
                                                maxHeight: '200px',
                                                borderRadius: '6px',
                                                display: 'block',
                                                marginBottom: '8px'
                                            }}
                                        />
                                        <button
                                            type="button"
                                            className="btn btn-secondary"
                                            style={{ fontSize: '12px', padding: '4px 8px' }}
                                            onClick={() => handleChange('image', '')}
                                        >
                                            üóëÔ∏è ÁßªÈô§ÂúñÁâá
                                        </button>
                                    </div>
                                )}

                                {/* Êñá‰ª∂‰∏ä‰º† */}
                                <div style={{ marginBottom: '10px' }}>
                                    <input
                                        type="file"
                                        accept="image/*"
                                        id="imageUpload"
                                        style={{ display: 'none' }}
                                        onChange={async (e) => {
                                            const file = e.target.files[0];
                                            if (!file) return;

                                            // Ê™¢Êü•Êñá‰ª∂Â§ßÂ∞èÔºàÊúÄÂ§ß 2MBÔºâ
                                            if (file.size > 2 * 1024 * 1024) {
                                                alert('ÂúñÁâáÊ™îÊ°àÂ§™Â§ßÔºÅË´ãÈÅ∏ÊìáÂ∞èÊñº 2MB ÁöÑÂúñÁâá„ÄÇ');
                                                return;
                                            }

                                            try {
                                                const uploadBtn = document.querySelector('.upload-status');
                                                if (uploadBtn) uploadBtn.textContent = '‚è≥ ‰∏äÂÇ≥‰∏≠...';

                                                const imageUrl = await uploadImageToSupabase(file);
                                                handleChange('image', imageUrl);

                                                if (uploadBtn) uploadBtn.textContent = '‚úÖ ‰∏äÂÇ≥ÊàêÂäüÔºÅ';
                                                setTimeout(() => {
                                                    if (uploadBtn) uploadBtn.textContent = '';
                                                }, 2000);
                                            } catch (error) {
                                                alert('ÂúñÁâá‰∏äÂÇ≥Â§±ÊïóÔºö' + error.message);
                                                console.error(error);
                                            }
                                            e.target.value = ''; // ÈáçÁΩÆÊñá‰ª∂ËæìÂÖ•
                                        }}
                                    />
                                    <button
                                        type="button"
                                        className="btn btn-primary"
                                        onClick={() => document.getElementById('imageUpload').click()}
                                        style={{ marginRight: '10px' }}
                                    >
                                        üì∑ ÈÅ∏ÊìáÂúñÁâá‰∏äÂÇ≥
                                    </button>
                                    <span className="upload-status" style={{ color: '#059669', fontWeight: '600' }}></span>
                                </div>

                                {/* ÊâãÂä®ËæìÂÖ• URLÔºàÂèØÈÄâÔºâ */}
                                <div style={{ fontSize: '12px', color: '#666', marginBottom: '6px' }}>
                                    ÊàñÊâãÂãïËº∏ÂÖ•ÂúñÁâáÁ∂≤ÂùÄÔºö
                                </div>
                                <input
                                    type="text"
                                    placeholder="https://..."
                                    value={formData.image}
                                    onChange={(e) => handleChange('image', e.target.value)}
                                />
                            </div>
                            <div className="form-group">
                                <label>ÊèèËø∞</label>
                                <textarea
                                    value={formData.description}
                                    onChange={(e) => handleChange('description', e.target.value)}
                                />
                            </div>
                            <div className="form-group-inline">
                                <label className="toggle-switch">
                                    <input
                                        type="checkbox"
                                        checked={formData.available !== false}
                                        onChange={(e) => handleChange('available', e.target.checked)}
                                    />
                                    <span className="toggle-slider"></span>
                                </label>
                                <label>‰æõÊáâ‰∏≠</label>
                            </div>

                            {/* ÂÖ®Â±ÄÈÅ∏È†ÖÈÅ∏Êìá */}
                            {optionsLibrary.length > 0 && (
                                <div className="form-group">
                                    <label style={{ marginBottom: '12px', display: 'block' }}>
                                        üéØ ÊáâÁî®ÂÖ®Â±ÄÈÅ∏È†ÖÔºàÈ°ßÂÆ¢ÈªûÈ§êÊôÇÂèØÈÅ∏ÊìáÔºâ
                                    </label>
                                    <div style={{
                                        border: '1px solid #e0e0e0',
                                        borderRadius: '8px',
                                        padding: '12px',
                                        background: '#f9f9f9'
                                    }}>
                                        {optionsLibrary.filter(opt => opt.isEnabled !== false).map(option => (
                                            <div key={option.id} style={{
                                                display: 'flex',
                                                alignItems: 'center',
                                                padding: '8px',
                                                marginBottom: '8px',
                                                background: 'white',
                                                borderRadius: '6px',
                                                border: (formData.appliedOptionIds || []).includes(option.id)
                                                    ? '2px solid #059669'
                                                    : '1px solid #e0e0e0',
                                                cursor: 'pointer'
                                            }} onClick={() => handleToggleOption(option.id)}>
                                                <input
                                                    type="checkbox"
                                                    checked={(formData.appliedOptionIds || []).includes(option.id)}
                                                    onChange={() => handleToggleOption(option.id)}
                                                    style={{ marginRight: '10px', width: '18px', height: '18px', cursor: 'pointer' }}
                                                />
                                                <div style={{ flex: 1 }}>
                                                    <div style={{ fontWeight: '600', color: '#333' }}>
                                                        {option.name}
                                                        {option.required && (
                                                            <span style={{
                                                                marginLeft: '8px',
                                                                fontSize: '12px',
                                                                color: '#ef4444',
                                                                background: '#fee2e2',
                                                                padding: '2px 6px',
                                                                borderRadius: '4px'
                                                            }}>ÂøÖÈÅ∏</span>
                                                        )}
                                                    </div>
                                                    <div style={{ fontSize: '12px', color: '#666', marginTop: '2px' }}>
                                                        {option.type === 'single' ? 'ÂñÆÈÅ∏' : 'Â§öÈÅ∏'} ‚Ä¢
                                                        {option.choices.filter(c => c.isEnabled !== false).map(c => c.label).join(', ')}
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                    <div style={{ fontSize: '13px', color: '#666', marginTop: '8px' }}>
                                        üí° ÂãæÈÅ∏ÂæåÔºåÈ°ßÂÆ¢ÈªûÊ≠§È§êÊôÇÊúÉÂΩàÂá∫ÈÅ∏È†ÖËÆì‰ªñÂÄëÈÅ∏Êìá
                                    </div>
                                </div>
                            )}

                            <div className="btn-group">
                                <button type="button" className="btn btn-secondary" onClick={onClose}>
                                    ÂèñÊ∂à
                                </button>
                                <button type="submit" className="btn btn-primary">
                                    ÂÑ≤Â≠ò
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

                        // ÈôÑÂä†ÈÅ∏È†ÖÁÆ°ÁêÜÁµÑ‰ª∂
        function OptionsManagement({ optionsLibrary = [], onUpdateOptionsLibrary }) {
            const [showModal, setShowModal] = React.useState(false);
            const [editingOption, setEditingOption] = React.useState(null);
            const [optionName, setOptionName] = React.useState('');
            const [optionType, setOptionType] = React.useState('radio');
            const [optionValues, setOptionValues] = React.useState([{ label: '', price: 0 }]);

            const handleAddNew = () => {
                setEditingOption(null);
                setOptionName('');
                setOptionType('radio');
                setOptionValues([{ label: '', price: 0, enabled: true }]);
                setShowModal(true);
            };

            const handleEdit = (option) => {
                setEditingOption(option);
                setOptionName(option.name);
                setOptionType(option.type);
                setOptionValues(option.choices.map(c => ({
                    ...c,
                    enabled: c.enabled !== false
                })));
                setShowModal(true);
            };

            const handleDelete = (id) => {
                if (confirm('Á¢∫ÂÆöË¶ÅÂà™Èô§ÈÄôÂÄãÈÅ∏È†ÖÂóéÔºü')) {
                    onUpdateOptionsLibrary(optionsLibrary.filter(opt => opt.id !== id));
                }
            };

            const handleSave = () => {
                if (!optionName.trim()) { alert('Ë´ãËº∏ÂÖ•ÈÅ∏È†ÖÂêçÁ®±'); return; }
                if (optionValues.length === 0 || optionValues.some(v => !v.label.trim())) { alert('Ë´ãËá≥Â∞ëÊ∑ªÂä†‰∏ÄÂÄãÈÅ∏È†ÖÂÄº'); return; }
                const newOption = {
                    id: editingOption ? editingOption.id : `opt-${Date.now()}`,
                    name: optionName,
                    type: optionType,
                    is_enabled: editingOption ? editingOption.is_enabled : true,
                    choices: optionValues.map(v => ({
                        label: v.label.trim(),
                        price: Number(v.price) || 0,
                        enabled: v.enabled !== false
                    }))
                };
                if (editingOption) {
                    onUpdateOptionsLibrary(optionsLibrary.map(opt => opt.id === editingOption.id ? newOption : opt));
                } else {
                    onUpdateOptionsLibrary([...optionsLibrary, newOption]);
                }
                setShowModal(false);
            };

            const addValue = () => setOptionValues([...optionValues, { label: '', price: 0, enabled: true }]);
            const removeValue = (i) => optionValues.length > 1 && setOptionValues(optionValues.filter((_, idx) => idx !== i));
            const updateValue = (i, f, v) => { const u = [...optionValues]; u[i][f] = v; setOptionValues(u); };

            return React.createElement('div', { style: { padding: '20px' } },
                React.createElement('div', { style: { display: 'flex', justifyContent: 'space-between', marginBottom: '20px' } },
                    React.createElement('div', null,
                        React.createElement('h2', { style: { color: '#6B4423', marginBottom: '8px' } }, 'ÈôÑÂä†ÈÅ∏È†ÖÁÆ°ÁêÜ'),
                        React.createElement('p', { style: { color: '#666', fontSize: '14px' } }, 'ÁÆ°ÁêÜÂèØ‰æõÈÅ∏ÊìáÁöÑÈôÑÂä†ÈÅ∏È†ÖÔºåÂ¶ÇËæ£Â∫¶„ÄÅÈ£≤Êñô„ÄÅÂ§ßÂ∞èÁ≠â')
                    ),
                    React.createElement('button', {
                        onClick: handleAddNew,
                        style: { padding: '12px 24px', background: 'linear-gradient(135deg, #8B6F47 0%, #6B4423 100%)', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer', fontSize: '16px', fontWeight: '600' }
                    }, '‚ûï Êñ∞Â¢ûÈÅ∏È†Ö')
                ),
                optionsLibrary.length === 0 ?
                    React.createElement('div', { style: { padding: '60px 20px', textAlign: 'center', border: '2px dashed #ddd', borderRadius: '12px', background: '#fff' } },
                        React.createElement('div', { style: { fontSize: '48px', marginBottom: '16px' } }, 'üìù'),
                        React.createElement('p', { style: { fontSize: '16px', color: '#666' } }, 'ÁõÆÂâçÊ≤íÊúâÈôÑÂä†ÈÅ∏È†Ö'),
                        React.createElement('p', { style: { fontSize: '14px', color: '#999', marginTop: '8px' } }, 'ÈªûÊìä‰∏äÊñπÊåâÈàïÈñãÂßãÊñ∞Â¢û')
                    ) :
                    React.createElement('div', { style: { display: 'grid', gap: '16px' } },
                        optionsLibrary.map(option =>
                            React.createElement('div', { key: option.id, style: { background: '#fff', border: '1px solid #e0e0e0', borderRadius: '12px', padding: '20px' } },
                                React.createElement('div', { style: { display: 'flex', justifyContent: 'space-between', marginBottom: '16px' } },
                                    React.createElement('div', null,
                                        React.createElement('div', { style: { display: 'flex', alignItems: 'center', gap: '12px' } },
                                            React.createElement('h3', { style: { color: '#6B4423', marginBottom: '0' } }, option.name),
                                            React.createElement('label', {
                                                style: {
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    gap: '6px',
                                                    cursor: 'pointer',
                                                    fontSize: '13px',
                                                    color: option.is_enabled !== false ? '#10b981' : '#ef4444',
                                                    fontWeight: '600'
                                                }
                                            },
                                                React.createElement('input', {
                                                    type: 'checkbox',
                                                    checked: option.is_enabled !== false,
                                                    onChange: async (e) => {
                                                        const newEnabled = e.target.checked;
                                                        try {
                                                            const { error } = await window.supabaseClient
                                                                .from('options_library')
                                                                .update({ is_enabled: newEnabled })
                                                                .eq('id', option.id);

                                                            if (!error) {
                                                                onUpdateOptionsLibrary(optionsLibrary.map(opt =>
                                                                    opt.id === option.id ? {...opt, is_enabled: newEnabled} : opt
                                                                ));
                                                            }
                                                        } catch (err) {
                                                            console.error(err);
                                                            alert('Êõ¥Êñ∞Â§±Êïó');
                                                        }
                                                    },
                                                    style: { width: '16px', height: '16px', cursor: 'pointer' }
                                                }),
                                                option.is_enabled !== false ? '‚úÖ ÂïüÁî®‰∏≠' : '‚ùå Â∑≤ÂÅúÁî®'
                                            )
                                        ),
                                        React.createElement('span', { style: { display: 'inline-block', padding: '4px 12px', borderRadius: '12px', fontSize: '12px', background: option.type === 'radio' ? '#e3f2fd' : '#fff3e0', color: option.type === 'radio' ? '#1976d2' : '#f57c00', marginTop: '8px' } }, option.type === 'radio' ? 'ÂñÆÈÅ∏' : 'Â§öÈÅ∏')
                                    ),
                                    React.createElement('div', { style: { display: 'flex', gap: '8px' } },
                                        React.createElement('button', { onClick: () => handleEdit(option), style: { padding: '8px 16px', background: '#f5f5f5', border: '1px solid #ddd', borderRadius: '6px', cursor: 'pointer' } }, 'Á∑®ËºØ'),
                                        React.createElement('button', { onClick: () => handleDelete(option.id), style: { padding: '8px 16px', background: '#ffebee', color: '#c62828', border: '1px solid #ffcdd2', borderRadius: '6px', cursor: 'pointer' } }, 'Âà™Èô§')
                                    )
                                ),
                                React.createElement('div', { style: { display: 'grid', gap: '8px' } },
                                    option.choices.map((val, idx) =>
                                        React.createElement('div', {
                                            key: idx,
                                            style: {
                                                display: 'flex',
                                                justifyContent: 'space-between',
                                                alignItems: 'center',
                                                padding: '10px 12px',
                                                background: val.enabled !== false ? '#f9f9f9' : '#fee2e2',
                                                borderRadius: '6px',
                                                opacity: val.enabled !== false ? 1 : 0.6
                                            }
                                        },
                                            React.createElement('div', { style: { display: 'flex', alignItems: 'center', gap: '12px', flex: 1 } },
                                                React.createElement('input', {
                                                    type: 'checkbox',
                                                    checked: val.enabled !== false,
                                                    onChange: async (e) => {
                                                        const newEnabled = e.target.checked;
                                                        const updatedChoices = option.choices.map((c, i) =>
                                                            i === idx ? {...c, enabled: newEnabled} : c
                                                        );

                                                        try {
                                                            const { error } = await window.supabaseClient
                                                                .from('options_library')
                                                                .update({ choices: updatedChoices })
                                                                .eq('id', option.id);

                                                            if (!error) {
                                                                onUpdateOptionsLibrary(optionsLibrary.map(opt =>
                                                                    opt.id === option.id ? {...opt, choices: updatedChoices} : opt
                                                                ));
                                                            }
                                                        } catch (err) {
                                                            console.error(err);
                                                            alert('Êõ¥Êñ∞Â§±Êïó');
                                                        }
                                                    },
                                                    style: { width: '16px', height: '16px', cursor: 'pointer' }
                                                }),
                                                React.createElement('span', {
                                                    style: {
                                                        textDecoration: val.enabled !== false ? 'none' : 'line-through',
                                                        color: val.enabled !== false ? '#000' : '#999'
                                                    }
                                                }, val.label)
                                            ),
                                            React.createElement('span', { style: { fontWeight: 'bold', color: val.price > 0 ? '#6B4423' : '#999' } }, val.price > 0 ? `+$${val.price.toFixed(2)}` : '‰∏çÂä†ÂÉπ')
                                        )
                                    )
                                )
                            )
                        )
                    ),
                showModal && React.createElement('div', { style: { position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, background: 'rgba(0,0,0,0.5)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000 }, onClick: () => setShowModal(false) },
                    React.createElement('div', { style: { background: '#fff', borderRadius: '12px', padding: '30px', width: '90%', maxWidth: '600px', maxHeight: '80vh', overflow: 'auto' }, onClick: (e) => e.stopPropagation() },
                        React.createElement('h3', { style: { marginBottom: '20px', color: '#6B4423' } }, editingOption ? 'Á∑®ËºØÈÅ∏È†Ö' : 'Êñ∞Â¢ûÈÅ∏È†Ö'),
                        React.createElement('div', { style: { marginBottom: '20px' } },
                            React.createElement('label', { style: { display: 'block', marginBottom: '8px', fontWeight: 'bold' } }, 'ÈÅ∏È†ÖÂêçÁ®± *'),
                            React.createElement('input', { type: 'text', value: optionName, onChange: (e) => setOptionName(e.target.value), placeholder: '‰æãÂ¶ÇÔºöËæ£Â∫¶„ÄÅÈ£≤Êñô„ÄÅÂ§ßÂ∞è', style: { width: '100%', padding: '10px', border: '1px solid #ddd', borderRadius: '6px', fontSize: '16px' } })
                        ),
                        React.createElement('div', { style: { marginBottom: '20px' } },
                            React.createElement('label', { style: { display: 'block', marginBottom: '8px', fontWeight: 'bold' } }, 'ÈÅ∏È†ÖÈ°ûÂûã'),
                            React.createElement('select', { value: optionType, onChange: (e) => setOptionType(e.target.value), style: { width: '100%', padding: '10px', border: '1px solid #ddd', borderRadius: '6px', fontSize: '16px' } },
                                React.createElement('option', { value: 'radio' }, 'ÂñÆÈÅ∏ÔºàÈ°ßÂÆ¢Âè™ËÉΩÈÅ∏‰∏ÄÂÄãÔºâ'),
                                React.createElement('option', { value: 'checkbox' }, 'Â§öÈÅ∏ÔºàÈ°ßÂÆ¢ÂèØÈÅ∏Â§öÂÄãÔºâ')
                            )
                        ),
                        React.createElement('div', { style: { marginBottom: '20px' } },
                            React.createElement('label', { style: { display: 'block', marginBottom: '8px', fontWeight: 'bold' } }, 'ÈÅ∏È†ÖÂÄº'),
                            optionValues.map((val, idx) =>
                                React.createElement('div', { key: idx, style: { display: 'flex', gap: '8px', marginBottom: '8px' } },
                                    React.createElement('input', { type: 'text', value: val.label, onChange: (e) => updateValue(idx, 'label', e.target.value), placeholder: 'ÈÅ∏È†ÖÂêçÁ®±', style: { flex: 1, padding: '10px', border: '1px solid #ddd', borderRadius: '6px' } }),
                                    React.createElement('input', { type: 'number', value: val.price, onChange: (e) => updateValue(idx, 'price', e.target.value), placeholder: 'Âä†ÂÉπ', style: { width: '100px', padding: '10px', border: '1px solid #ddd', borderRadius: '6px' } }),
                                    React.createElement('button', { onClick: () => removeValue(idx), disabled: optionValues.length === 1, style: { padding: '10px', background: '#ffebee', color: '#c62828', border: 'none', borderRadius: '6px', cursor: optionValues.length === 1 ? 'not-allowed' : 'pointer', opacity: optionValues.length === 1 ? 0.5 : 1 } }, '‚úï')
                                )
                            ),
                            React.createElement('button', { onClick: addValue, style: { width: '100%', padding: '10px', background: '#f5f5f5', border: '2px dashed #ddd', borderRadius: '6px', cursor: 'pointer', marginTop: '8px' } }, '‚ûï Ê∑ªÂä†ÈÅ∏È†ÖÂÄº')
                        ),
                        React.createElement('div', { style: { display: 'flex', gap: '12px', justifyContent: 'flex-end' } },
                            React.createElement('button', { onClick: () => setShowModal(false), style: { padding: '10px 20px', background: '#f5f5f5', border: '1px solid #ddd', borderRadius: '6px', cursor: 'pointer' } }, 'ÂèñÊ∂à'),
                            React.createElement('button', { onClick: handleSave, style: { padding: '10px 20px', background: 'linear-gradient(135deg, #8B6F47 0%, #6B4423 100%)', color: 'white', border: 'none', borderRadius: '6px', cursor: 'pointer', fontWeight: 'bold' } }, 'ÂÑ≤Â≠ò')
                        )
                    )
                )
            );
        }

        // Áµ±Ë®àÂ†±Ë°®ÁµÑ‰ª∂
        function Statistics({ orders, menu }) {
            const today = new Date().toDateString();
            const todayOrders = orders.filter(order =>
                new Date(order.timestamp).toDateString() === today
            );

            // Ë®àÁÆóÂêÑÂïÜÂìÅÈä∑ÂîÆÁµ±Ë®à
            const itemStats = {};
            orders.forEach(order => {
                order.items.forEach(item => {
                    if (!itemStats[item.name]) {
                        itemStats[item.name] = {
                            name: item.name,
                            quantity: 0,
                            revenue: 0
                        };
                    }
                    itemStats[item.name].quantity += item.quantity;
                    itemStats[item.name].revenue += item.price * item.quantity;
                });
            });

            const sortedItems = Object.values(itemStats).sort((a, b) => b.revenue - a.revenue);

            // ÊåâÊó•ÊúüÁµ±Ë®à
            const dateStats = {};
            orders.forEach(order => {
                const date = new Date(order.timestamp).toLocaleDateString('zh-TW');
                if (!dateStats[date]) {
                    dateStats[date] = {
                        date,
                        orderCount: 0,
                        revenue: 0
                    };
                }
                dateStats[date].orderCount++;
                dateStats[date].revenue += order.total;
            });

            const sortedDates = Object.values(dateStats).sort((a, b) =>
                new Date(b.date) - new Date(a.date)
            ).slice(0, 30); // ÊúÄËøë30Â§©

            return (
                <div>
                    <h3 style={{ marginBottom: '20px', color: '#6B4423' }}>üìà ‰ªäÊó•Áµ±Ë®à</h3>
                    <div className="stats-grid">
                        <div className="stat-card">
                            <div className="stat-label">‰ªäÊó•Ë®ÇÂñÆ</div>
                            <div className="stat-value">{todayOrders.length}</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">‰ªäÊó•ÁáüÊ•≠È°ç</div>
                            <div className="stat-value">
                                ${todayOrders.reduce((sum, o) => sum + o.total, 0).toFixed(2)}
                            </div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">Á∏ΩË®ÇÂñÆÊï∏</div>
                            <div className="stat-value">{orders.length}</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">Á∏ΩÁáüÊ•≠È°ç</div>
                            <div className="stat-value">
                                ${orders.reduce((sum, o) => sum + o.total, 0).toFixed(2)}
                            </div>
                        </div>
                    </div>

                    <h3 style={{ marginTop: '40px', marginBottom: '15px', color: '#6B4423' }}>
                        üèÜ ÁÜ±Èä∑ÂïÜÂìÅÊéíË°å
                    </h3>
                    <table className="table">
                        <thead>
                            <tr>
                                <th>ÊéíÂêç</th>
                                <th>ÂïÜÂìÅÂêçÁ®±</th>
                                <th>Èä∑ÂîÆÊï∏Èáè</th>
                                <th>Èä∑ÂîÆÈáëÈ°ç</th>
                            </tr>
                        </thead>
                        <tbody>
                            {sortedItems.slice(0, 10).map((item, index) => (
                                <tr key={item.name}>
                                    <td>
                                        <span style={{
                                            fontSize: '20px',
                                            fontWeight: 'bold',
                                            color: index === 0 ? '#fbbf24' : index === 1 ? '#94a3b8' : index === 2 ? '#cd7f32' : '#666'
                                        }}>
                                            {index + 1}
                                        </span>
                                    </td>
                                    <td style={{ fontWeight: 'bold' }}>{item.name}</td>
                                    <td>{item.quantity}</td>
                                    <td style={{ color: '#6B4423', fontWeight: 'bold' }}>
                                        ${item.revenue.toFixed(2)}
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>

                    <h3 style={{ marginTop: '40px', marginBottom: '15px', color: '#6B4423' }}>
                        üìÖ ÊØèÊó•ÁáüÊ•≠Áµ±Ë®à
                    </h3>
                    <table className="table">
                        <thead>
                            <tr>
                                <th>Êó•Êúü</th>
                                <th>Ë®ÇÂñÆÊï∏</th>
                                <th>ÁáüÊ•≠È°ç</th>
                            </tr>
                        </thead>
                        <tbody>
                            {sortedDates.map(stat => (
                                <tr key={stat.date}>
                                    <td>{stat.date}</td>
                                    <td>{stat.orderCount}</td>
                                    <td style={{ color: '#6B4423', fontWeight: 'bold' }}>
                                        ${stat.revenue.toFixed(2)}
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            );
        }

        // Â∫´Â≠òÁÆ°ÁêÜÁµÑ‰ª∂
        function InventoryManagement() {
            const [inventoryItems, setInventoryItems] = useState([]);
            const [loading, setLoading] = useState(true);
            const [showQuickActionModal, setShowQuickActionModal] = useState(false);
            const [selectedItem, setSelectedItem] = useState(null);
            const [actionType, setActionType] = useState('');
            const [actionQty, setActionQty] = useState('');

            // üÜï Êñ∞ÂäüËÉΩÁä∂ÊÄÅ
            const [showReceiveModal, setShowReceiveModal] = useState(false);
            const [showCountModal, setShowCountModal] = useState(false);
            const [showAddItemModal, setShowAddItemModal] = useState(false);
            const [showEditModal, setShowEditModal] = useState(false);
            const [showHistoryModal, setShowHistoryModal] = useState(false);

            const [receiveForm, setReceiveForm] = useState({ qty: '', unit: 'pcs', cost: '', supplier: '' });
            const [countForm, setCountForm] = useState({ actualQty: '', notes: '' });
            const [newItemForm, setNewItemForm] = useState({
                name: '', itemType: 'PACKAGING', baseUnit: 'pcs', unitsPerCase: '',
                reorderPoint: '100', reorderQty: '200', leadTimeDays: '3', currentCost: '0.50'
            });
            const [editForm, setEditForm] = useState({});
            const [transactions, setTransactions] = useState([]);

            // üÜïüÜï ËèúÂìÅÈÖçÁΩÆÁÆ°ÁêÜÁä∂ÊÄÅ
            const [currentView, setCurrentView] = useState('inventory'); // 'inventory' or 'menu_config'
            const [menuItems, setMenuItems] = useState([]);
            const [selectedMenuItem, setSelectedMenuItem] = useState(null);
            const [menuPackagingMaps, setMenuPackagingMaps] = useState([]);
            const [showAddMappingModal, setShowAddMappingModal] = useState(false);
            const [showEditMappingModal, setShowEditMappingModal] = useState(false);
            const [addMappingForm, setAddMappingForm] = useState({ inventoryItemId: '', qtyPerSale: '1' });
            const [selectedInventoryItems, setSelectedInventoryItems] = useState([]); // ÊâπÈáèÈÄâÊã©ÁöÑÂ∫ìÂ≠òÂìÅÈ°π
            const [editMappingForm, setEditMappingForm] = useState({});
            const [menuSearchQuery, setMenuSearchQuery] = useState('');
            const [selectedMappings, setSelectedMappings] = useState([]);

            // üÜïüÜïüÜï Toast POS Style UI Áä∂ÊÄÅ
            const [searchQuery, setSearchQuery] = useState('');
            const [statusFilter, setStatusFilter] = useState('all'); // 'all', 'ok', 'low_stock', 'out_of_stock'
            const [expandedRows, setExpandedRows] = useState([]); // Â±ïÂºÄÁöÑË°å ID
            const [openMenuId, setOpenMenuId] = useState(null); // ÊâìÂºÄÁöÑ‰∏ãÊãâËèúÂçï ID
            const [sortBy, setSortBy] = useState('urgent_first'); // ÊéíÂ∫èÈÄâÈ°π

            // ËºâÂÖ•Â∫´Â≠òÊï∏Êìö
            const loadInventory = async () => {
                setLoading(true);
                try {
                    if (!window.supabaseClient) {
                        console.error('‚ùå Supabase client not initialized');
                        return;
                    }

                    const { data, error } = await window.supabaseClient
                        .from('inventory_overview')
                        .select('*')
                        .order('name', { ascending: true });

                    if (error) {
                        console.error('‚ùå Error loading inventory:', error);
                        return;
                    }

                    setInventoryItems(data || []);
                } catch (error) {
                    console.error('‚ùå Error loading inventory:', error);
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => {
                loadInventory();
                // ÊØè 10 ÁßíËá™ÂãïÂà∑Êñ∞
                const interval = setInterval(loadInventory, 10000);
                return () => clearInterval(interval);
            }, []);

            // üÜïüÜï Âä†ËΩΩËèúÂçïÈ°π
            const loadMenuItems = async () => {
                try {
                    const { data, error } = await window.supabaseClient
                        .from('menu')
                        .select('*')
                        .order('name', { ascending: true });

                    if (error) {
                        console.error('‚ùå Error loading menu items:', error);
                        return;
                    }

                    setMenuItems(data || []);
                } catch (error) {
                    console.error('‚ùå Error loading menu items:', error);
                }
            };

            // üÜïüÜï Âä†ËΩΩÊüê‰∏™ËèúÂìÅÁöÑÈÖçÁΩÆ
            const loadMenuPackagingMaps = async (menuItemName) => {
                try {
                    const { data, error } = await window.supabaseClient
                        .from('menu_packaging_map')
                        .select(`
                            *,
                            inventory_items (
                                id,
                                name,
                                item_type,
                                base_unit,
                                current_cost,
                                qty_on_hand:inventory_overview(qty_on_hand)
                            )
                        `)
                        .eq('menu_item_name', menuItemName);

                    if (error) {
                        console.error('‚ùå Error loading menu packaging maps:', error);
                        return;
                    }

                    setMenuPackagingMaps(data || []);
                } catch (error) {
                    console.error('‚ùå Error loading menu packaging maps:', error);
                }
            };

            // üÜïüÜï Ê∑ªÂä†ÈÖçÁΩÆÔºàÊîØÊåÅÊâπÈáèÔºâ
            const handleAddMapping = async () => {
                if (!selectedMenuItem) {
                    alert('Ë´ãÈÅ∏ÊìáËèúÂìÅ');
                    return;
                }

                if (selectedInventoryItems.length === 0) {
                    alert('Ë´ãËá≥Â∞ëÈÅ∏Êìá‰∏ÄÂÄãÂ∫´Â≠òÂìÅÈ†Ö');
                    return;
                }

                const qty = parseInt(addMappingForm.qtyPerSale);
                if (!qty || qty <= 0) {
                    alert('Êï∏ÈáèÂøÖÈ†àÂ§ßÊñº 0');
                    return;
                }

                try {
                    // ÊâπÈáèÊèíÂÖ•Â§ö‰∏™ÈÖçÁΩÆ
                    const mappings = selectedInventoryItems.map(itemId => ({
                        menu_item_name: selectedMenuItem.name,
                        inventory_item_id: itemId,
                        qty_per_sale: qty,
                        notes: addMappingForm.notes || ''
                    }));

                    const { error } = await window.supabaseClient
                        .from('menu_packaging_map')
                        .insert(mappings);

                    if (error) {
                        console.error('‚ùå Error adding mappings:', error);
                        alert('Ê∑ªÂä†Â§±ÊïóÔºö' + error.message);
                        return;
                    }

                    alert(`‚úÖ ÊàêÂäüÊ∑ªÂä† ${selectedInventoryItems.length} ÂÄãÈÖçÁΩÆÔºÅ`);
                    setShowAddMappingModal(false);
                    setAddMappingForm({ inventoryItemId: '', qtyPerSale: '1', notes: '' });
                    setSelectedInventoryItems([]);
                    loadMenuPackagingMaps(selectedMenuItem.name);
                } catch (error) {
                    console.error('‚ùå Error:', error);
                    alert('Ê∑ªÂä†Â§±Êïó');
                }
            };

            // üÜïüÜï Êõ¥Êñ∞ÈÖçÁΩÆ
            const handleUpdateMapping = async () => {
                if (!editMappingForm.id || !editMappingForm.qty_per_sale) {
                    alert('Ë´ãÂ°´ÂØ´ÊâÄÊúâÂøÖÂ°´È†Ö');
                    return;
                }

                const qty = parseInt(editMappingForm.qty_per_sale);
                if (qty <= 0) {
                    alert('Êï∏ÈáèÂøÖÈ†àÂ§ßÊñº 0');
                    return;
                }

                try {
                    const { error } = await window.supabaseClient
                        .from('menu_packaging_map')
                        .update({
                            qty_per_sale: qty,
                            notes: editMappingForm.notes || ''
                        })
                        .eq('id', editMappingForm.id);

                    if (error) {
                        console.error('‚ùå Error updating mapping:', error);
                        alert('Êõ¥Êñ∞Â§±ÊïóÔºö' + error.message);
                        return;
                    }

                    alert('‚úÖ ÈÖçÁΩÆÊõ¥Êñ∞ÊàêÂäüÔºÅ');
                    setShowEditMappingModal(false);
                    setEditMappingForm({});
                    loadMenuPackagingMaps(selectedMenuItem.name);
                } catch (error) {
                    console.error('‚ùå Error:', error);
                    alert('Êõ¥Êñ∞Â§±Êïó');
                }
            };

            // üÜïüÜï Âà†Èô§ÈÖçÁΩÆ
            const handleDeleteMapping = async (mappingId, itemName) => {
                if (!confirm(`Á¢∫ÂÆöË¶ÅÂà™Èô§„Äå${itemName}„ÄçÁöÑÈÖçÁΩÆÂóéÔºü`)) {
                    return;
                }

                try {
                    const { error } = await window.supabaseClient
                        .from('menu_packaging_map')
                        .delete()
                        .eq('id', mappingId);

                    if (error) {
                        console.error('‚ùå Error deleting mapping:', error);
                        alert('Âà™Èô§Â§±ÊïóÔºö' + error.message);
                        return;
                    }

                    alert('‚úÖ ÈÖçÁΩÆÂà™Èô§ÊàêÂäüÔºÅ');
                    loadMenuPackagingMaps(selectedMenuItem.name);
                } catch (error) {
                    console.error('‚ùå Error:', error);
                    alert('Âà™Èô§Â§±Êïó');
                }
            };

            // üÜïüÜï ÊâπÈáèÂà†Èô§ÈÖçÁΩÆ
            const handleBatchDelete = async () => {
                if (selectedMappings.length === 0) {
                    alert('Ë´ãÂÖàÈÅ∏ÊìáË¶ÅÂà™Èô§ÁöÑÈÖçÁΩÆ');
                    return;
                }

                if (!confirm(`Á¢∫ÂÆöË¶ÅÂà™Èô§ ${selectedMappings.length} ÂÄãÈÖçÁΩÆÂóéÔºü`)) {
                    return;
                }

                try {
                    const { error } = await window.supabaseClient
                        .from('menu_packaging_map')
                        .delete()
                        .in('id', selectedMappings);

                    if (error) {
                        console.error('‚ùå Error batch deleting:', error);
                        alert('ÊâπÈáèÂà™Èô§Â§±ÊïóÔºö' + error.message);
                        return;
                    }

                    alert('‚úÖ ÊâπÈáèÂà™Èô§ÊàêÂäüÔºÅ');
                    setSelectedMappings([]);
                    loadMenuPackagingMaps(selectedMenuItem.name);
                } catch (error) {
                    console.error('‚ùå Error:', error);
                    alert('ÊâπÈáèÂà™Èô§Â§±Êïó');
                }
            };

            // üÜïüÜï Âä†ËΩΩËèúÂçïÈ°πÔºàÂΩìÂàáÊç¢Âà∞ËèúÂìÅÈÖçÁΩÆËßÜÂõæÊó∂Ôºâ
            useEffect(() => {
                if (currentView === 'menu_config' && menuItems.length === 0) {
                    loadMenuItems();
                }
            }, [currentView]);

            // Âø´Êç∑Êìç‰ΩúÂáΩÊï∏
            const handleQuickAction = async () => {
                if (!selectedItem || !actionType || !actionQty || parseInt(actionQty) <= 0) {
                    alert('Ë´ãËº∏ÂÖ•ÊúâÊïàÁöÑÊï∏Èáè');
                    return;
                }

                try {
                    const { data, error } = await window.supabaseClient
                        .rpc('quick_adjustment', {
                            p_item_id: selectedItem.id,
                            p_adjustment_type: actionType,
                            p_qty: parseInt(actionQty)
                        });

                    if (error) {
                        console.error('‚ùå Error executing quick action:', error);
                        alert('Êìç‰ΩúÂ§±ÊïóÔºö' + error.message);
                        return;
                    }

                    if (!data.success) {
                        alert('Êìç‰ΩúÂ§±ÊïóÔºö' + data.message);
                        return;
                    }

                    alert('‚úÖ Êìç‰ΩúÊàêÂäüÔºÅ');
                    setShowQuickActionModal(false);
                    setSelectedItem(null);
                    setActionType('');
                    setActionQty('');
                    loadInventory();
                } catch (error) {
                    console.error('‚ùå Error:', error);
                    alert('Êìç‰ΩúÂ§±Êïó');
                }
            };

            // ÊâìÈñãÂø´Êç∑Êìç‰Ωú Modal
            const openQuickAction = (item, type) => {
                setSelectedItem(item);
                setActionType(type);
                setActionQty('');
                setShowQuickActionModal(true);
            };

            // Áç≤ÂèñÁãÄÊÖãÈ°èËâ≤
            const getStatusColor = (status) => {
                switch (status) {
                    case 'ok': return '#10b981'; // Á∂†Ëâ≤
                    case 'low_stock': return '#f59e0b'; // Ê©ôËâ≤
                    case 'out_of_stock': return '#ef4444'; // Á¥ÖËâ≤
                    default: return '#6b7280'; // ÁÅ∞Ëâ≤
                }
            };

            // Áç≤ÂèñÁãÄÊÖãÊñáÂ≠ó
            const getStatusText = (status) => {
                switch (status) {
                    case 'ok': return '‚úÖ ÂÖÖË∂≥';
                    case 'low_stock': return '‚ö†Ô∏è ÂÅè‰Ωé';
                    case 'out_of_stock': return '‚ùå Áº∫Ë≤®';
                    default: return '‚ùì Êú™Áü•';
                }
            };

            // Áç≤ÂèñÊìç‰ΩúÈ°ûÂûãÊñáÂ≠ó
            const getActionTypeText = (type) => {
                switch (type) {
                    case 'staff_meal': return 'üç¥ Âì°Â∑•È§ê';
                    case 'waste': return 'üóëÔ∏è Â†±Âª¢';
                    case 'gift': return 'üéÅ Ë¥àÈÄÅ';
                    default: return type;
                }
            };

            // Ë®àÁÆóÁ∏ΩÂ∫´Â≠òÂÉπÂÄº
            const totalInventoryValue = inventoryItems.reduce((sum, item) => {
                return sum + (parseFloat(item.current_cost || 0) * parseInt(item.qty_on_hand || 0));
            }, 0);

            if (loading) {
                return (
                    <div style={{ textAlign: 'center', padding: '40px' }}>
                        <div style={{ fontSize: '48px', marginBottom: '20px' }}>üì¶</div>
                        <div>ËºâÂÖ•‰∏≠...</div>
                    </div>
                );
            }

            return (
                <div>
                    {/* üÜïüÜï ËßÜÂõæÂàáÊç¢ÊåâÈíÆ */}
                    <div style={{ marginBottom: '20px', display: 'flex', gap: '10px', alignItems: 'center', borderBottom: '2px solid #e5e7eb', paddingBottom: '10px' }}>
                        <button
                            onClick={() => setCurrentView('inventory')}
                            style={{
                                padding: '10px 20px',
                                backgroundColor: currentView === 'inventory' ? '#6B4423' : 'transparent',
                                color: currentView === 'inventory' ? 'white' : '#6B4423',
                                border: currentView === 'inventory' ? 'none' : '2px solid #6B4423',
                                borderRadius: '4px',
                                cursor: 'pointer',
                                fontSize: '14px',
                                fontWeight: 'bold'
                            }}
                        >
                            üì¶ Â∫´Â≠òÁ∏ΩË¶Ω
                        </button>
                        <button
                            onClick={() => setCurrentView('menu_config')}
                            style={{
                                padding: '10px 20px',
                                backgroundColor: currentView === 'menu_config' ? '#6B4423' : 'transparent',
                                color: currentView === 'menu_config' ? 'white' : '#6B4423',
                                border: currentView === 'menu_config' ? 'none' : '2px solid #6B4423',
                                borderRadius: '4px',
                                cursor: 'pointer',
                                fontSize: '14px',
                                fontWeight: 'bold'
                            }}
                        >
                            üçΩÔ∏è ËèúÂìÅÈÖçÁΩÆ
                        </button>
                    </div>

                    {/* Â∫ìÂ≠òÊÄªËßàËßÜÂõæ */}
                    {currentView === 'inventory' && (
                        <div>
                            {/* üé® Toast POS Style - KPI Âç°ÁâáÂå∫Ôºà1Â§ß+2Â∞èÔºâ */}
                            <div className="kpi-cards-modern">
                                {/* Â∑¶‰æßÂ§ßÂç°ÔºöÂ∫ìÂ≠òÊÄª‰ª∑ÂÄº */}
                                <div className="kpi-card-modern primary">
                                    <div className="kpi-value-large">${totalInventoryValue.toFixed(2)}</div>
                                    <div className="kpi-label-small">Â∫´Â≠òÁ∏ΩÂÉπÂÄº</div>
                                </div>

                                {/* Âè≥‰æßÂ∞èÂç°Â†ÜÂè† */}
                                <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>
                                    {/* ‰ΩéÂ∫ìÂ≠òÈ¢ÑË≠¶ */}
                                    <div className="kpi-card-modern secondary">
                                        <div className="kpi-badge warning">
                                            {inventoryItems.filter(item => item.stock_status === 'low_stock').length}
                                        </div>
                                        <div className="kpi-secondary-content">
                                            <div className="kpi-secondary-label">‰ΩéÂ∫´Â≠òÈ†êË≠¶</div>
                                            <div className="kpi-secondary-value">‚ö†Ô∏è ÈúÄË¶ÅÈóúÊ≥®</div>
                                        </div>
                                    </div>

                                    {/* Áº∫Ë¥ßÂìÅÈ°π */}
                                    <div className="kpi-card-modern secondary">
                                        <div className="kpi-badge danger">
                                            {inventoryItems.filter(item => item.stock_status === 'out_of_stock').length}
                                        </div>
                                        <div className="kpi-secondary-content">
                                            <div className="kpi-secondary-label">Áº∫Ë≤®ÂìÅÈ†Ö</div>
                                            <div className="kpi-secondary-value">‚ùå Á´ãÂç≥Ë£úË≤®</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* üé® ÊêúÁ¥¢ÂíåÁ≠õÈÄâÊ†è */}
                            <div className="search-filter-bar">
                                <div className="search-box-modern">
                                    <span className="search-icon">üîç</span>
                                    <input
                                        type="text"
                                        placeholder="üëâ ÊêúÂ∞ãÂìÅÈ†ÖÊàñÂàÜÈ°û"
                                        value={searchQuery}
                                        onChange={(e) => setSearchQuery(e.target.value)}
                                    />
                                </div>

                                <div className="filter-group">
                                    <select
                                        className="filter-select"
                                        value={statusFilter}
                                        onChange={(e) => setStatusFilter(e.target.value)}
                                    >
                                        <option value="all">ÂÖ®ÈÉ®</option>
                                        <option value="ok">‚úÖ Ê≠£Â∏∏</option>
                                        <option value="low_stock">‚ö†Ô∏è ‰ΩéÂ∫´Â≠ò</option>
                                        <option value="out_of_stock">‚ùå Áº∫Ë≤®</option>
                                    </select>

                                    <select
                                        className="filter-select"
                                        value={sortBy}
                                        onChange={(e) => setSortBy(e.target.value)}
                                    >
                                        <option value="urgent_first">üî• Áº∫Ë≤®ÂÑ™ÂÖà</option>
                                        <option value="low_stock_first">‚ö†Ô∏è ‰ΩéÂ∫´Â≠òÂÑ™ÂÖà</option>
                                        <option value="stock_most">üìä Â∫´Â≠òÊúÄÂ§ö</option>
                                        <option value="stock_least">üìâ Â∫´Â≠òÊúÄÂ∞ë</option>
                                        <option value="name_asc">üî§ ÂêçÁ®±ÊéíÂ∫è</option>
                                    </select>

                                    <button
                                        className="btn-primary-modern"
                                        onClick={() => setShowAddItemModal(true)}
                                    >
                                        <span>‚ûï</span>
                                        <span>Ê∑ªÂä†ÂìÅÈ†Ö</span>
                                    </button>
                                </div>
                            </div>

                            {/* üé® Summary Âä®ÊÄÅÂå∫ */}
                            <div style={{
                                background: 'white',
                                padding: '16px 20px',
                                borderRadius: '8px',
                                marginBottom: '16px',
                                display: 'flex',
                                gap: '24px',
                                fontSize: '13px',
                                color: '#6b7280',
                                boxShadow: '0 1px 3px rgba(0, 0, 0, 0.06)'
                            }}>
                                <div>
                                    <span style={{ marginRight: '6px' }}>üì¶</span>
                                    <strong style={{ color: '#374151' }}>Á∏ΩÂìÅÈ†ÖÔºö</strong>
                                    {inventoryItems.length} È†Ö
                                </div>
                                <div>
                                    <span style={{ marginRight: '6px' }}>‚úÖ</span>
                                    <strong style={{ color: '#374151' }}>Ê≠£Â∏∏Â∫´Â≠òÔºö</strong>
                                    {inventoryItems.filter(i => i.stock_status === 'ok').length} È†Ö
                                </div>
                                <div>
                                    <span style={{ marginRight: '6px' }}>‚è∞</span>
                                    <strong style={{ color: '#374151' }}>ÊúÄËøëÊõ¥Êñ∞Ôºö</strong>
                                    ÂâõÂâõ
                                </div>
                            </div>

                            {/* üé® ÁÆÄÂåñË°®Ê†º */}
                            <table className="table-modern">
                                <thead>
                                    <tr>
                                        <th>ÂìÅÈ†ÖÂêçÁ®±</th>
                                        <th>ÁèæÊúâÂ∫´Â≠ò</th>
                                        <th>ÁãÄÊÖã</th>
                                        <th style={{ textAlign: 'right' }}>Êìç‰Ωú</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {inventoryItems
                                        .filter(item => {
                                            // ÊêúÁ¥¢ËøáÊª§
                                            const matchSearch = item.name.toLowerCase().includes(searchQuery.toLowerCase());
                                            // Áä∂ÊÄÅËøáÊª§
                                            const matchStatus = statusFilter === 'all' || item.stock_status === statusFilter;
                                            return matchSearch && matchStatus;
                                        })
                                        .sort((a, b) => {
                                            if (sortBy === 'urgent_first') {
                                                // Áº∫Ë¥ß > ‰ΩéÂ∫ìÂ≠ò > Ê≠£Â∏∏
                                                const order = { 'out_of_stock': 0, 'low_stock': 1, 'ok': 2 };
                                                return order[a.stock_status] - order[b.stock_status];
                                            } else if (sortBy === 'low_stock_first') {
                                                const order = { 'low_stock': 0, 'out_of_stock': 1, 'ok': 2 };
                                                return order[a.stock_status] - order[b.stock_status];
                                            } else if (sortBy === 'stock_most') {
                                                return (b.qty_on_hand || 0) - (a.qty_on_hand || 0);
                                            } else if (sortBy === 'stock_least') {
                                                return (a.qty_on_hand || 0) - (b.qty_on_hand || 0);
                                            } else if (sortBy === 'name_asc') {
                                                return a.name.localeCompare(b.name, 'zh-TW');
                                            }
                                            return 0;
                                        })
                                        .map(item => (
                                            <React.Fragment key={item.id}>
                                                <tr onClick={() => {
                                                    if (expandedRows.includes(item.id)) {
                                                        setExpandedRows(expandedRows.filter(id => id !== item.id));
                                                    } else {
                                                        setExpandedRows([...expandedRows, item.id]);
                                                    }
                                                }}>
                                                    <td style={{ fontWeight: 'bold', color: '#111827' }}>
                                                        <span style={{ marginRight: '8px', color: '#6b7280' }}>
                                                            {expandedRows.includes(item.id) ? '‚ñº' : '‚ñ∂'}
                                                        </span>
                                                        {item.name}
                                                    </td>
                                                    <td>
                                                        <span className="inventory-qty" style={{
                                                            color: item.stock_status === 'ok' ? '#10b981' :
                                                                   item.stock_status === 'low_stock' ? '#f59e0b' : '#ef4444'
                                                        }}>
                                                            {item.qty_on_hand}
                                                        </span>
                                                        <span className="inventory-unit">{item.unit}</span>
                                                    </td>
                                                    <td>
                                                        <span className={`status-badge ${item.stock_status === 'ok' ? 'ok' : item.stock_status === 'low_stock' ? 'low' : 'out'}`}>
                                                            {item.stock_status === 'ok' ? '‚úÖ Ê≠£Â∏∏' :
                                                             item.stock_status === 'low_stock' ? '‚ö†Ô∏è ÂÅè‰Ωé' : '‚ùå Áº∫Ë≤®'}
                                                        </span>
                                                    </td>
                                                    <td>
                                                        <div className="action-buttons" style={{ justifyContent: 'flex-end' }}>
                                                            <button
                                                                className={`btn-action-primary ${
                                                                    item.stock_status === 'out_of_stock' ? 'urgent' :
                                                                    item.stock_status === 'low_stock' ? 'low' : 'normal'
                                                                }`}
                                                                onClick={(e) => {
                                                                    e.stopPropagation();
                                                                    setSelectedItem(item);
                                                                    setReceiveForm({ qty: '', unit: item.unit || 'pcs', cost: item.current_cost?.toString() || '', supplier: '' });
                                                                    setShowReceiveModal(true);
                                                                }}
                                                            >
                                                                ÈÄ≤Ë≤®
                                                            </button>
                                                            <div style={{ position: 'relative' }}>
                                                                <button
                                                                    className="btn-more"
                                                                    onClick={(e) => {
                                                                        e.stopPropagation();
                                                                        setOpenMenuId(openMenuId === item.id ? null : item.id);
                                                                    }}
                                                                >
                                                                    ‚ãØ
                                                                </button>
                                                                {openMenuId === item.id && (
                                                                    <div className="dropdown-menu" onClick={(e) => e.stopPropagation()}>
                                                                        <button
                                                                            className="dropdown-item"
                                                                            onClick={() => {
                                                                                setSelectedItem(item);
                                                                                setCountForm({ actualQty: item.qty_on_hand?.toString() || '0', notes: '' });
                                                                                setShowCountModal(true);
                                                                                setOpenMenuId(null);
                                                                            }}
                                                                        >
                                                                            üìù Áõ§Èªû
                                                                        </button>
                                                                        <button
                                                                            className="dropdown-item"
                                                                            onClick={() => {
                                                                                setSelectedItem(item);
                                                                                setEditForm({
                                                                                    reorderPoint: item.reorder_point?.toString() || '100',
                                                                                    reorderQty: item.reorder_qty?.toString() || '200',
                                                                                    leadTimeDays: item.lead_time_days?.toString() || '3',
                                                                                    currentCost: item.current_cost?.toString() || '0.50',
                                                                                    unitsPerCase: item.units_per_case?.toString() || ''
                                                                                });
                                                                                setShowEditModal(true);
                                                                                setOpenMenuId(null);
                                                                            }}
                                                                        >
                                                                            ‚úèÔ∏è Á∑®ËºØ
                                                                        </button>
                                                                        <button
                                                                            className="dropdown-item"
                                                                            onClick={async () => {
                                                                                setSelectedItem(item);
                                                                                setShowHistoryModal(true);
                                                                                setOpenMenuId(null);
                                                                                try {
                                                                                    const { data, error } = await window.supabaseClient
                                                                                        .from('inventory_transactions')
                                                                                        .select('*')
                                                                                        .eq('item_id', item.id)
                                                                                        .order('created_at', { ascending: false })
                                                                                        .limit(50);
                                                                                    if (!error) setTransactions(data || []);
                                                                                } catch (e) { console.error(e); }
                                                                            }}
                                                                        >
                                                                            üìä Ê≠∑Âè≤
                                                                        </button>
                                                                        <div className="dropdown-divider"></div>
                                                                        <button
                                                                            className="dropdown-item"
                                                                            onClick={() => {
                                                                                openQuickAction(item, 'staff_meal');
                                                                                setOpenMenuId(null);
                                                                            }}
                                                                        >
                                                                            üç¥ Âì°Â∑•È§ê
                                                                        </button>
                                                                        <button
                                                                            className="dropdown-item"
                                                                            onClick={() => {
                                                                                openQuickAction(item, 'waste');
                                                                                setOpenMenuId(null);
                                                                            }}
                                                                        >
                                                                            üóëÔ∏è Â†±Âª¢
                                                                        </button>
                                                                        <button
                                                                            className="dropdown-item"
                                                                            onClick={() => {
                                                                                openQuickAction(item, 'gift');
                                                                                setOpenMenuId(null);
                                                                            }}
                                                                        >
                                                                            üéÅ Ë¥àÈÄÅ
                                                                        </button>
                                                                    </div>
                                                                )}
                                                            </div>
                                                        </div>
                                                    </td>
                                                </tr>

                                                {/* Â±ïÂºÄËØ¶ÊÉÖ */}
                                                {expandedRows.includes(item.id) && (
                                                    <tr>
                                                        <td colSpan="4" style={{ padding: 0, border: 'none' }}>
                                                            <div className="expanded-details">
                                                                <div className="detail-grid">
                                                                    <div className="detail-item">
                                                                        <div className="detail-label">ÂÆâÂÖ®Â∫´Â≠ò</div>
                                                                        <div className="detail-value">{item.reorder_point} {item.unit}</div>
                                                                    </div>
                                                                    <div className="detail-item">
                                                                        <div className="detail-label">ÂñÆ‰ΩçÊàêÊú¨</div>
                                                                        <div className="detail-value">${parseFloat(item.current_cost || 0).toFixed(2)}</div>
                                                                    </div>
                                                                    <div className="detail-item">
                                                                        <div className="detail-label">Â∫´Â≠òÂÉπÂÄº</div>
                                                                        <div className="detail-value" style={{ color: '#6B4423' }}>
                                                                            ${(parseFloat(item.current_cost || 0) * parseInt(item.qty_on_hand || 0)).toFixed(2)}
                                                                        </div>
                                                                    </div>
                                                                    <div className="detail-item">
                                                                        <div className="detail-label">Âë®ËΩâÂ§©Êï∏</div>
                                                                        <div className="detail-value">
                                                                            {item.days_of_cover !== null ? (
                                                                                <span style={{
                                                                                    color: parseFloat(item.days_of_cover) < 3 ? '#ef4444' :
                                                                                           parseFloat(item.days_of_cover) < 7 ? '#f59e0b' : '#10b981'
                                                                                }}>
                                                                                    {parseFloat(item.days_of_cover).toFixed(1)} Â§©
                                                                                </span>
                                                                            ) : (
                                                                                <span style={{ color: '#9ca3af' }}>N/A</span>
                                                                            )}
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                {/* ÊúÄËøëÊìç‰ΩúËÆ∞ÂΩïÈ¢ÑÁïôÂå∫ */}
                                                                <div className="recent-transactions" style={{ display: 'none' }}>
                                                                    <div style={{ fontWeight: '600', fontSize: '13px', color: '#6b7280', marginBottom: '8px' }}>
                                                                        üìù ÊúÄËøëÊìç‰ΩúË®òÈåÑ
                                                                    </div>
                                                                    {/* ÂèØ‰ª•Âú®ËøôÈáåÊ∑ªÂä†ÊúÄËøëÁöÑ‰∫§ÊòìËÆ∞ÂΩï */}
                                                                </div>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                )}
                                            </React.Fragment>
                                        ))}
                                </tbody>
                            </table>

                            {inventoryItems
                                .filter(item => {
                                    const matchSearch = item.name.toLowerCase().includes(searchQuery.toLowerCase());
                                    const matchStatus = statusFilter === 'all' || item.stock_status === statusFilter;
                                    return matchSearch && matchStatus;
                                }).length === 0 && (
                                <div style={{ textAlign: 'center', padding: '60px 20px', color: '#9ca3af', background: 'white', borderRadius: '8px', marginTop: '20px' }}>
                                    <div style={{ fontSize: '48px', marginBottom: '16px' }}>üì≠</div>
                                    <div style={{ fontSize: '16px', fontWeight: '600', marginBottom: '8px' }}>Êâæ‰∏çÂà∞Á¨¶ÂêàÊ¢ù‰ª∂ÁöÑÂìÅÈ†Ö</div>
                                    <div style={{ fontSize: '14px' }}>Ë´ãÂòóË©¶Ë™øÊï¥ÊêúÂ∞ãÊ¢ù‰ª∂ÊàñÁØ©ÈÅ∏Âô®</div>
                                </div>
                            )}

                    {/* Âø´Êç∑Êìç‰Ωú Modal */}
                    {showQuickActionModal && selectedItem && (
                        <div className="modal" onClick={() => setShowQuickActionModal(false)}>
                            <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                                <span className="close" onClick={() => setShowQuickActionModal(false)}>&times;</span>
                                <h2>{getActionTypeText(actionType)} - {selectedItem.name}</h2>
                                <div style={{ marginTop: '20px' }}>
                                    <div style={{ marginBottom: '15px' }}>
                                        <strong>ÁèæÊúâÂ∫´Â≠òÔºö</strong>
                                        <span style={{
                                            fontSize: '20px',
                                            marginLeft: '10px',
                                            color: getStatusColor(selectedItem.stock_status)
                                        }}>
                                            {selectedItem.qty_on_hand}
                                        </span>
                                    </div>
                                    <div style={{ marginBottom: '15px' }}>
                                        <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold' }}>
                                            Êï∏Èáè
                                        </label>
                                        <input
                                            type="number"
                                            min="1"
                                            value={actionQty}
                                            onChange={(e) => setActionQty(e.target.value)}
                                            style={{
                                                width: '100%',
                                                padding: '10px',
                                                fontSize: '16px',
                                                border: '1px solid #ddd',
                                                borderRadius: '4px'
                                            }}
                                            placeholder="Ë´ãËº∏ÂÖ•Êï∏Èáè"
                                        />
                                    </div>
                                    <div style={{ display: 'flex', gap: '10px', marginTop: '20px' }}>
                                        <button
                                            onClick={handleQuickAction}
                                            style={{
                                                flex: 1,
                                                padding: '12px',
                                                backgroundColor: '#6B4423',
                                                color: 'white',
                                                border: 'none',
                                                borderRadius: '4px',
                                                cursor: 'pointer',
                                                fontSize: '16px',
                                                fontWeight: 'bold'
                                            }}
                                        >
                                            Á¢∫Ë™ç
                                        </button>
                                        <button
                                            onClick={() => setShowQuickActionModal(false)}
                                            style={{
                                                flex: 1,
                                                padding: '12px',
                                                backgroundColor: '#6b7280',
                                                color: 'white',
                                                border: 'none',
                                                borderRadius: '4px',
                                                cursor: 'pointer',
                                                fontSize: '16px'
                                            }}
                                        >
                                            ÂèñÊ∂à
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* üÜï ËøõË¥ßModal */}
                    {showReceiveModal && selectedItem && (
                        <div className="modal" onClick={() => setShowReceiveModal(false)}>
                            <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                                <span className="close" onClick={() => setShowReceiveModal(false)}>&times;</span>
                                <h2>üì¶ ÈÄ≤Ë≤® - {selectedItem.name}</h2>
                                <div style={{ marginTop: '20px' }}>
                                    <div style={{ marginBottom: '15px' }}>
                                        <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold' }}>Êï∏Èáè</label>
                                        <input type="number" value={receiveForm.qty} onChange={(e) => setReceiveForm({...receiveForm, qty: e.target.value})}
                                            style={{ width: '100%', padding: '10px', fontSize: '16px', border: '1px solid #ddd', borderRadius: '4px' }} />
                                    </div>
                                    <div style={{ marginBottom: '15px' }}>
                                        <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold' }}>ÂñÆ‰Ωç</label>
                                        <select value={receiveForm.unit} onChange={(e) => setReceiveForm({...receiveForm, unit: e.target.value})}
                                            style={{ width: '100%', padding: '10px', fontSize: '16px', border: '1px solid #ddd', borderRadius: '4px' }}>
                                            <option value="pcs">pcs (ÂÄã)</option>
                                            <option value="box">box (ÁÆ±)</option>
                                            <option value="bag">bag (ÂåÖ)</option>
                                            <option value="pack">pack (ÁµÑ)</option>
                                        </select>
                                    </div>
                                    <div style={{ marginBottom: '15px' }}>
                                        <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold' }}>ÂñÆ‰ΩçÊàêÊú¨</label>
                                        <input type="number" step="0.01" value={receiveForm.cost} onChange={(e) => setReceiveForm({...receiveForm, cost: e.target.value})}
                                            style={{ width: '100%', padding: '10px', fontSize: '16px', border: '1px solid #ddd', borderRadius: '4px' }} />
                                    </div>
                                    <div style={{ marginBottom: '15px' }}>
                                        <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold' }}>‰æõÊáâÂïÜÔºàÈÅ∏Â°´Ôºâ</label>
                                        <input type="text" value={receiveForm.supplier} onChange={(e) => setReceiveForm({...receiveForm, supplier: e.target.value})}
                                            style={{ width: '100%', padding: '10px', fontSize: '16px', border: '1px solid #ddd', borderRadius: '4px' }} />
                                    </div>
                                    <div style={{ display: 'flex', gap: '10px', marginTop: '20px' }}>
                                        <button onClick={async () => {
                                            if (!receiveForm.qty || !receiveForm.cost) { alert('Ë´ãÂ°´ÂØ´Êï∏ÈáèÂíåÊàêÊú¨'); return; }
                                            try {
                                                const { data, error } = await window.supabaseClient.rpc('receive_inventory_with_conversion', {
                                                    p_item_id: selectedItem.id, p_qty: parseInt(receiveForm.qty), p_unit: receiveForm.unit,
                                                    p_cost_per_unit: parseFloat(receiveForm.cost), p_supplier: receiveForm.supplier || null,
                                                    p_batch_number: null, p_expiry_date: null
                                                });
                                                if (error) { alert('ÈÄ≤Ë≤®Â§±ÊïóÔºö' + error.message); return; }
                                                if (!data.success) { alert('ÈÄ≤Ë≤®Â§±ÊïóÔºö' + data.message); return; }
                                                alert('‚úÖ ÈÄ≤Ë≤®ÊàêÂäüÔºÅ\n' + data.message);
                                                setShowReceiveModal(false);
                                                loadInventory();
                                            } catch (e) { alert('ÈÄ≤Ë≤®Â§±Êïó'); }
                                        }} style={{ flex: 1, padding: '12px', backgroundColor: '#6B4423', color: 'white', border: 'none', borderRadius: '4px', cursor: 'pointer', fontSize: '16px', fontWeight: 'bold' }}>Á¢∫Ë™ç</button>
                                        <button onClick={() => setShowReceiveModal(false)} style={{ flex: 1, padding: '12px', backgroundColor: '#6b7280', color: 'white', border: 'none', borderRadius: '4px', cursor: 'pointer', fontSize: '16px' }}>ÂèñÊ∂à</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* üÜï ÁõòÁÇπModal */}
                    {showCountModal && selectedItem && (
                        <div className="modal" onClick={() => setShowCountModal(false)}>
                            <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                                <span className="close" onClick={() => setShowCountModal(false)}>&times;</span>
                                <h2>üìù Áõ§ÈªûË™øÊï¥ - {selectedItem.name}</h2>
                                <div style={{ marginTop: '20px' }}>
                                    <div style={{ marginBottom: '15px' }}>
                                        <strong>Á≥ªÁµ±Â∫´Â≠òÔºö</strong><span style={{ fontSize: '20px', marginLeft: '10px' }}>{selectedItem.qty_on_hand}</span>
                                    </div>
                                    <div style={{ marginBottom: '15px' }}>
                                        <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold' }}>ÂØ¶ÈöõÂ∫´Â≠ò</label>
                                        <input type="number" value={countForm.actualQty} onChange={(e) => setCountForm({...countForm, actualQty: e.target.value})}
                                            style={{ width: '100%', padding: '10px', fontSize: '16px', border: '1px solid #ddd', borderRadius: '4px' }} />
                                    </div>
                                    <div style={{ marginBottom: '15px' }}>
                                        <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold' }}>ÂÇôË®ªÔºàÈÅ∏Â°´Ôºâ</label>
                                        <textarea value={countForm.notes} onChange={(e) => setCountForm({...countForm, notes: e.target.value})}
                                            style={{ width: '100%', padding: '10px', fontSize: '16px', border: '1px solid #ddd', borderRadius: '4px', minHeight: '60px' }} />
                                    </div>
                                    <div style={{ display: 'flex', gap: '10px', marginTop: '20px' }}>
                                        <button onClick={async () => {
                                            if (!countForm.actualQty) { alert('Ë´ãËº∏ÂÖ•ÂØ¶ÈöõÊï∏Èáè'); return; }
                                            try {
                                                const { data, error } = await window.supabaseClient.rpc('inventory_count_adjustment', {
                                                    p_item_id: selectedItem.id, p_actual_qty: parseInt(countForm.actualQty),
                                                    p_adjusted_by: 'admin', p_notes: countForm.notes || null
                                                });
                                                if (error) { alert('Áõ§ÈªûË™øÊï¥Â§±ÊïóÔºö' + error.message); return; }
                                                const delta = data.delta;
                                                const message = delta === 0 ? '‚úÖ Áõ§ÈªûÂÆåÊàêÔºÅÂ∫´Â≠òÊï∏Èáè‰∏ÄËá¥ÔºåÁÑ°ÈúÄË™øÊï¥„ÄÇ' :
                                                    `‚úÖ Áõ§ÈªûÂÆåÊàêÔºÅ\nÁ≥ªÁµ±Â∫´Â≠òÔºö${data.system_qty}\nÂØ¶ÈöõÂ∫´Â≠òÔºö${data.actual_qty}\nÂ∑ÆÁï∞Ôºö${delta > 0 ? '+' : ''}${delta}`;
                                                alert(message);
                                                setShowCountModal(false);
                                                loadInventory();
                                            } catch (e) { alert('Áõ§ÈªûË™øÊï¥Â§±Êïó'); }
                                        }} style={{ flex: 1, padding: '12px', backgroundColor: '#6B4423', color: 'white', border: 'none', borderRadius: '4px', cursor: 'pointer', fontSize: '16px', fontWeight: 'bold' }}>Á¢∫Ë™ç</button>
                                        <button onClick={() => setShowCountModal(false)} style={{ flex: 1, padding: '12px', backgroundColor: '#6b7280', color: 'white', border: 'none', borderRadius: '4px', cursor: 'pointer', fontSize: '16px' }}>ÂèñÊ∂à</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* üÜï Ê∑ªÂä†Êñ∞ÂìÅÈ°πModal */}
                    {showAddItemModal && (
                        <div className="modal" onClick={() => setShowAddItemModal(false)}>
                            <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                                <span className="close" onClick={() => setShowAddItemModal(false)}>&times;</span>
                                <h2>‚ûï Ê∑ªÂä†Êñ∞ÂìÅÈ†Ö</h2>
                                <div style={{ marginTop: '20px' }}>
                                    <div style={{ marginBottom: '15px' }}>
                                        <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold' }}>ÂìÅÈ†ÖÂêçÁ®± *</label>
                                        <input type="text" value={newItemForm.name} onChange={(e) => setNewItemForm({...newItemForm, name: e.target.value})}
                                            style={{ width: '100%', padding: '10px', fontSize: '16px', border: '1px solid #ddd', borderRadius: '4px' }} />
                                    </div>
                                    <div style={{ marginBottom: '15px' }}>
                                        <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold' }}>È°ûÂûã</label>
                                        <select value={newItemForm.itemType} onChange={(e) => setNewItemForm({...newItemForm, itemType: e.target.value})}
                                            style={{ width: '100%', padding: '10px', fontSize: '16px', border: '1px solid #ddd', borderRadius: '4px' }}>
                                            <option value="PACKAGING">ÂåÖÊùê</option>
                                            <option value="BEVERAGE_PACKAGED">Áì∂Ë£ùÈ£≤Êñô</option>
                                            <option value="PREPACKAGED_FOOD">È†êÂåÖË£ùÈ£üÂìÅ</option>
                                            <option value="SUPPLY">ËÄóÊùê</option>
                                        </select>
                                    </div>
                                    <div style={{ marginBottom: '15px' }}>
                                        <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold' }}>‰∏ªÂñÆ‰Ωç</label>
                                        <select value={newItemForm.baseUnit} onChange={(e) => setNewItemForm({...newItemForm, baseUnit: e.target.value})}
                                            style={{ width: '100%', padding: '10px', fontSize: '16px', border: '1px solid #ddd', borderRadius: '4px' }}>
                                            <option value="pcs">pcs (ÂÄã)</option>
                                            <option value="box">box (Áõí)</option>
                                            <option value="bag">bag (ÂåÖ)</option>
                                            <option value="bottle">bottle (Áì∂)</option>
                                            <option value="can">can (ÁΩê)</option>
                                            <option value="roll">roll (Âç∑)</option>
                                            <option value="pack">pack (ÁµÑ)</option>
                                        </select>
                                    </div>
                                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '10px', marginBottom: '15px' }}>
                                        <div>
                                            <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold' }}>Ë£úË≤®Èªû</label>
                                            <input type="number" value={newItemForm.reorderPoint} onChange={(e) => setNewItemForm({...newItemForm, reorderPoint: e.target.value})}
                                                style={{ width: '100%', padding: '10px', fontSize: '16px', border: '1px solid #ddd', borderRadius: '4px' }} />
                                        </div>
                                        <div>
                                            <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold' }}>Âª∫Ë≠∞Ë£úË≤®Èáè</label>
                                            <input type="number" value={newItemForm.reorderQty} onChange={(e) => setNewItemForm({...newItemForm, reorderQty: e.target.value})}
                                                style={{ width: '100%', padding: '10px', fontSize: '16px', border: '1px solid #ddd', borderRadius: '4px' }} />
                                        </div>
                                    </div>
                                    <div style={{ marginBottom: '15px' }}>
                                        <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold' }}>ÂñÆ‰ΩçÊàêÊú¨</label>
                                        <input type="number" step="0.01" value={newItemForm.currentCost} onChange={(e) => setNewItemForm({...newItemForm, currentCost: e.target.value})}
                                            style={{ width: '100%', padding: '10px', fontSize: '16px', border: '1px solid #ddd', borderRadius: '4px' }} />
                                    </div>
                                    <div style={{ display: 'flex', gap: '10px', marginTop: '20px' }}>
                                        <button onClick={async () => {
                                            if (!newItemForm.name) { alert('Ë´ãËº∏ÂÖ•ÂìÅÈ†ÖÂêçÁ®±'); return; }
                                            try {
                                                const { error } = await window.supabaseClient.from('inventory_items').insert([{
                                                    name: newItemForm.name, item_type: newItemForm.itemType, is_countable: true,
                                                    base_unit: newItemForm.baseUnit, units_per_case: newItemForm.unitsPerCase ? parseInt(newItemForm.unitsPerCase) : null,
                                                    reorder_point: parseInt(newItemForm.reorderPoint), reorder_qty: parseInt(newItemForm.reorderQty),
                                                    lead_time_days: parseInt(newItemForm.leadTimeDays), current_cost: parseFloat(newItemForm.currentCost)
                                                }]);
                                                if (error) { alert('Êñ∞Â¢ûÂìÅÈ†ÖÂ§±ÊïóÔºö' + error.message); return; }
                                                alert('‚úÖ Êñ∞Â¢ûÂìÅÈ†ÖÊàêÂäüÔºÅ');
                                                setShowAddItemModal(false);
                                                setNewItemForm({ name: '', itemType: 'PACKAGING', baseUnit: 'pcs', unitsPerCase: '', reorderPoint: '100', reorderQty: '200', leadTimeDays: '3', currentCost: '0.50' });
                                                loadInventory();
                                            } catch (e) { alert('Êñ∞Â¢ûÂìÅÈ†ÖÂ§±Êïó'); }
                                        }} style={{ flex: 1, padding: '12px', backgroundColor: '#6B4423', color: 'white', border: 'none', borderRadius: '4px', cursor: 'pointer', fontSize: '16px', fontWeight: 'bold' }}>Á¢∫Ë™ç</button>
                                        <button onClick={() => setShowAddItemModal(false)} style={{ flex: 1, padding: '12px', backgroundColor: '#6b7280', color: 'white', border: 'none', borderRadius: '4px', cursor: 'pointer', fontSize: '16px' }}>ÂèñÊ∂à</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* üÜï ÁºñËæëÂìÅÈ°πModal */}
                    {showEditModal && selectedItem && (
                        <div className="modal" onClick={() => setShowEditModal(false)}>
                            <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                                <span className="close" onClick={() => setShowEditModal(false)}>&times;</span>
                                <h2>‚úèÔ∏è Á∑®ËºØÂìÅÈ†Ö - {selectedItem.name}</h2>
                                <div style={{ marginTop: '20px' }}>
                                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '10px', marginBottom: '15px' }}>
                                        <div>
                                            <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold' }}>Ë£úË≤®Èªû</label>
                                            <input type="number" value={editForm.reorderPoint} onChange={(e) => setEditForm({...editForm, reorderPoint: e.target.value})}
                                                style={{ width: '100%', padding: '10px', fontSize: '16px', border: '1px solid #ddd', borderRadius: '4px' }} />
                                        </div>
                                        <div>
                                            <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold' }}>Âª∫Ë≠∞Ë£úË≤®Èáè</label>
                                            <input type="number" value={editForm.reorderQty} onChange={(e) => setEditForm({...editForm, reorderQty: e.target.value})}
                                                style={{ width: '100%', padding: '10px', fontSize: '16px', border: '1px solid #ddd', borderRadius: '4px' }} />
                                        </div>
                                    </div>
                                    <div style={{ marginBottom: '15px' }}>
                                        <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold' }}>ÂñÆ‰ΩçÊàêÊú¨</label>
                                        <input type="number" step="0.01" value={editForm.currentCost} onChange={(e) => setEditForm({...editForm, currentCost: e.target.value})}
                                            style={{ width: '100%', padding: '10px', fontSize: '16px', border: '1px solid #ddd', borderRadius: '4px' }} />
                                    </div>
                                    <div style={{ marginBottom: '15px' }}>
                                        <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold' }}>Âà∞Ë≤®Â§©Êï∏</label>
                                        <input type="number" value={editForm.leadTimeDays} onChange={(e) => setEditForm({...editForm, leadTimeDays: e.target.value})}
                                            style={{ width: '100%', padding: '10px', fontSize: '16px', border: '1px solid #ddd', borderRadius: '4px' }} />
                                    </div>
                                    <div style={{ display: 'flex', gap: '10px', marginTop: '20px' }}>
                                        <button onClick={async () => {
                                            try {
                                                const { error } = await window.supabaseClient.from('inventory_items').update({
                                                    reorder_point: parseInt(editForm.reorderPoint), reorder_qty: parseInt(editForm.reorderQty),
                                                    lead_time_days: parseInt(editForm.leadTimeDays), current_cost: parseFloat(editForm.currentCost),
                                                    units_per_case: editForm.unitsPerCase ? parseInt(editForm.unitsPerCase) : null
                                                }).eq('id', selectedItem.id);
                                                if (error) { alert('Êõ¥Êñ∞ÂìÅÈ†ÖÂ§±ÊïóÔºö' + error.message); return; }
                                                alert('‚úÖ Êõ¥Êñ∞ÊàêÂäüÔºÅ');
                                                setShowEditModal(false);
                                                loadInventory();
                                            } catch (e) { alert('Êõ¥Êñ∞ÂìÅÈ†ÖÂ§±Êïó'); }
                                        }} style={{ flex: 1, padding: '12px', backgroundColor: '#6B4423', color: 'white', border: 'none', borderRadius: '4px', cursor: 'pointer', fontSize: '16px', fontWeight: 'bold' }}>Á¢∫Ë™ç</button>
                                        <button onClick={() => setShowEditModal(false)} style={{ flex: 1, padding: '12px', backgroundColor: '#6b7280', color: 'white', border: 'none', borderRadius: '4px', cursor: 'pointer', fontSize: '16px' }}>ÂèñÊ∂à</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* üÜï ‰∫§ÊòìÂéÜÂè≤Modal */}
                    {showHistoryModal && selectedItem && (
                        <div className="modal" onClick={() => setShowHistoryModal(false)}>
                            <div className="modal-content" onClick={(e) => e.stopPropagation()} style={{ maxWidth: '800px' }}>
                                <span className="close" onClick={() => setShowHistoryModal(false)}>&times;</span>
                                <h2>üìä ‰∫§ÊòìÊ≠∑Âè≤ - {selectedItem.name}</h2>
                                <div style={{ marginTop: '20px', maxHeight: '500px', overflowY: 'auto' }}>
                                    <table className="table">
                                        <thead>
                                            <tr>
                                                <th>ÊôÇÈñì</th>
                                                <th>È°ûÂûã</th>
                                                <th>Êï∏Èáè</th>
                                                <th>ÂñÆ‰ΩçÊàêÊú¨</th>
                                                <th>ÈóúËÅØ</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {transactions.map((t, i) => (
                                                <tr key={i}>
                                                    <td>{new Date(t.created_at).toLocaleString('zh-TW')}</td>
                                                    <td>{t.transaction_type === 'in' ? 'üì¶ ÂÖ•Â∫´' : 'üì§ Âá∫Â∫´'}</td>
                                                    <td style={{ color: t.transaction_type === 'in' ? '#10b981' : '#ef4444' }}>
                                                        {t.transaction_type === 'in' ? '+' : '-'}{t.qty}
                                                    </td>
                                                    <td>${parseFloat(t.cost_per_unit || 0).toFixed(2)}</td>
                                                    <td>{t.reference_type}</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                    {transactions.length === 0 && (
                                        <div style={{ textAlign: 'center', padding: '40px', color: '#9ca3af' }}>
                                            <div>Êö´ÁÑ°‰∫§ÊòìË®òÈåÑ</div>
                                        </div>
                                    )}
                                </div>
                                <button onClick={() => setShowHistoryModal(false)} style={{ width: '100%', padding: '12px', marginTop: '20px', backgroundColor: '#6b7280', color: 'white', border: 'none', borderRadius: '4px', cursor: 'pointer', fontSize: '16px' }}>ÈóúÈñâ</button>
                            </div>
                        </div>
                    )}
                        </div>
                    )}

                    {/* üÜïüÜï ËèúÂìÅÈÖçÁΩÆËßÜÂõæ */}
                    {currentView === 'menu_config' && (
                        <div style={{ display: 'flex', gap: '20px', height: '70vh' }}>
                            {/* Â∑¶‰æßÔºöËèúÂìÅÂàóË°® */}
                            <div style={{ width: '35%', borderRight: '2px solid #e5e7eb', paddingRight: '20px', overflowY: 'auto' }}>
                                <div style={{ marginBottom: '15px', position: 'sticky', top: 0, backgroundColor: 'white', paddingBottom: '10px', zIndex: 10 }}>
                                    <h3 style={{ color: '#6B4423', marginBottom: '10px' }}>üçΩÔ∏è ËèúÂìÅÂàóË°®</h3>
                                    <input
                                        type="text"
                                        placeholder="ÊêúÁ¥¢ËèúÂìÅ..."
                                        value={menuSearchQuery}
                                        onChange={(e) => setMenuSearchQuery(e.target.value)}
                                        style={{
                                            width: '100%',
                                            padding: '10px',
                                            fontSize: '14px',
                                            border: '1px solid #ddd',
                                            borderRadius: '4px'
                                        }}
                                    />
                                </div>

                                {menuItems
                                    .filter(item => item.name.toLowerCase().includes(menuSearchQuery.toLowerCase()) ||
                                                   (item.english_name && item.english_name.toLowerCase().includes(menuSearchQuery.toLowerCase())))
                                    .map(menuItem => (
                                        <div
                                            key={menuItem.id}
                                            onClick={() => {
                                                setSelectedMenuItem(menuItem);
                                                loadMenuPackagingMaps(menuItem.name);
                                            }}
                                            style={{
                                                padding: '15px',
                                                marginBottom: '10px',
                                                border: selectedMenuItem?.id === menuItem.id ? '2px solid #6B4423' : '1px solid #e5e7eb',
                                                borderRadius: '8px',
                                                cursor: 'pointer',
                                                backgroundColor: selectedMenuItem?.id === menuItem.id ? '#fef3c7' : 'white',
                                                transition: 'all 0.2s'
                                            }}
                                        >
                                            <div style={{ fontWeight: 'bold', fontSize: '16px', color: '#6B4423' }}>{menuItem.name}</div>
                                            {menuItem.english_name && (
                                                <div style={{ fontSize: '12px', color: '#9ca3af', marginTop: '3px' }}>{menuItem.english_name}</div>
                                            )}
                                            <div style={{ fontSize: '13px', color: '#6b7280', marginTop: '5px' }}>
                                                ${parseFloat(menuItem.price).toFixed(2)}
                                            </div>
                                        </div>
                                    ))}
                            </div>

                            {/* Âè≥‰æßÔºöÈÖçÁΩÆËØ¶ÊÉÖ */}
                            <div style={{ flex: 1, overflowY: 'auto' }}>
                                {!selectedMenuItem ? (
                                    <div style={{ textAlign: 'center', padding: '60px 20px', color: '#9ca3af' }}>
                                        <div style={{ fontSize: '48px', marginBottom: '20px' }}>üçΩÔ∏è</div>
                                        <div style={{ fontSize: '18px', fontWeight: 'bold' }}>Ë´ãÂæûÂ∑¶ÂÅ¥ÈÅ∏Êìá‰∏ÄÂÄãËèúÂìÅ</div>
                                        <div style={{ fontSize: '14px', marginTop: '10px' }}>ÈÅ∏ÊìáÂæåÂèØÈÖçÁΩÆË©≤ËèúÂìÅÁöÑÂ∫´Â≠òÊâ£Ê∏õÈ†ÖÁõÆ</div>
                                    </div>
                                ) : (
                                    <div>
                                        {/* ÈÖçÁΩÆËØ¶ÊÉÖÂ§¥ÈÉ® */}
                                        <div style={{ marginBottom: '20px', padding: '20px', backgroundColor: '#fef3c7', borderRadius: '8px', border: '2px solid #6B4423' }}>
                                            <h3 style={{ color: '#6B4423', marginBottom: '10px' }}>üìã {selectedMenuItem.name}</h3>
                                            {selectedMenuItem.english_name && (
                                                <div style={{ fontSize: '14px', color: '#92400e', marginBottom: '5px' }}>{selectedMenuItem.english_name}</div>
                                            )}
                                            <div style={{ fontSize: '16px', color: '#6b7280' }}>
                                                ÂîÆÂÉπ: ${parseFloat(selectedMenuItem.price).toFixed(2)}
                                            </div>
                                        </div>

                                        {/* Êìç‰ΩúÊåâÈíÆ */}
                                        <div style={{ marginBottom: '20px', display: 'flex', gap: '10px' }}>
                                            <button
                                                onClick={() => {
                                                    setAddMappingForm({ inventoryItemId: '', qtyPerSale: '1', notes: '' });
                                                    setSelectedInventoryItems([]);
                                                    setShowAddMappingModal(true);
                                                }}
                                                style={{
                                                    padding: '10px 20px',
                                                    backgroundColor: '#10b981',
                                                    color: 'white',
                                                    border: 'none',
                                                    borderRadius: '4px',
                                                    cursor: 'pointer',
                                                    fontSize: '14px',
                                                    fontWeight: 'bold'
                                                }}
                                            >
                                                ‚ûï Ê∑ªÂä†ÈÖçÁΩÆ
                                            </button>
                                            {selectedMappings.length > 0 && (
                                                <button
                                                    onClick={handleBatchDelete}
                                                    style={{
                                                        padding: '10px 20px',
                                                        backgroundColor: '#ef4444',
                                                        color: 'white',
                                                        border: 'none',
                                                        borderRadius: '4px',
                                                        cursor: 'pointer',
                                                        fontSize: '14px'
                                                    }}
                                                >
                                                    üóëÔ∏è ÊâπÈáèÂà†Èô§ ({selectedMappings.length})
                                                </button>
                                            )}
                                            <button
                                                onClick={() => loadMenuPackagingMaps(selectedMenuItem.name)}
                                                style={{
                                                    padding: '10px 20px',
                                                    backgroundColor: '#6b7280',
                                                    color: 'white',
                                                    border: 'none',
                                                    borderRadius: '4px',
                                                    cursor: 'pointer',
                                                    fontSize: '14px'
                                                }}
                                            >
                                                üîÑ Âà∑Êñ∞
                                            </button>
                                        </div>

                                        {/* ÈÖçÁΩÆÂàóË°® */}
                                        <h4 style={{ color: '#6B4423', marginBottom: '15px' }}>Áï∂ÂâçÈÖçÁΩÆÁöÑÂ∫´Â≠òÊâ£Ê∏õÈ†Ö ({menuPackagingMaps.length})</h4>

                                        {menuPackagingMaps.length === 0 ? (
                                            <div style={{ textAlign: 'center', padding: '40px', border: '2px dashed #e5e7eb', borderRadius: '8px', color: '#9ca3af' }}>
                                                <div style={{ fontSize: '36px', marginBottom: '10px' }}>üì¶</div>
                                                <div style={{ fontSize: '16px', fontWeight: 'bold' }}>Êö´ÁÑ°ÈÖçÁΩÆ</div>
                                                <div style={{ fontSize: '14px', marginTop: '5px' }}>ÈªûÊìä„ÄåÊ∑ªÂä†ÈÖçÁΩÆ„ÄçÊåâÈàïÈñãÂßãÈÖçÁΩÆ</div>
                                            </div>
                                        ) : (
                                            <table className="table">
                                                <thead>
                                                    <tr>
                                                        <th style={{ width: '50px' }}>
                                                            <input
                                                                type="checkbox"
                                                                checked={selectedMappings.length === menuPackagingMaps.length && menuPackagingMaps.length > 0}
                                                                onChange={(e) => {
                                                                    if (e.target.checked) {
                                                                        setSelectedMappings(menuPackagingMaps.map(m => m.id));
                                                                    } else {
                                                                        setSelectedMappings([]);
                                                                    }
                                                                }}
                                                            />
                                                        </th>
                                                        <th>Â∫´Â≠òÂìÅÈ†Ö</th>
                                                        <th>È°ûÂûã</th>
                                                        <th>ÊØè‰ªΩÁî®Èáè</th>
                                                        <th>ÂñÆ‰Ωç</th>
                                                        <th>Áï∂ÂâçÂ∫´Â≠ò</th>
                                                        <th>ÂñÆ‰ΩçÊàêÊú¨</th>
                                                        <th>ÂÇôË®ª</th>
                                                        <th>Êìç‰Ωú</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {menuPackagingMaps.map(mapping => {
                                                        const invItem = mapping.inventory_items;
                                                        const qtyOnHand = invItem.qty_on_hand && invItem.qty_on_hand.length > 0 ? invItem.qty_on_hand[0].qty_on_hand : 0;

                                                        return (
                                                            <tr key={mapping.id}>
                                                                <td>
                                                                    <input
                                                                        type="checkbox"
                                                                        checked={selectedMappings.includes(mapping.id)}
                                                                        onChange={(e) => {
                                                                            if (e.target.checked) {
                                                                                setSelectedMappings([...selectedMappings, mapping.id]);
                                                                            } else {
                                                                                setSelectedMappings(selectedMappings.filter(id => id !== mapping.id));
                                                                            }
                                                                        }}
                                                                    />
                                                                </td>
                                                                <td style={{ fontWeight: 'bold' }}>{invItem.name}</td>
                                                                <td>
                                                                    <span style={{
                                                                        padding: '3px 8px',
                                                                        borderRadius: '4px',
                                                                        fontSize: '11px',
                                                                        backgroundColor: '#e0e7ff',
                                                                        color: '#3730a3'
                                                                    }}>
                                                                        {invItem.item_type}
                                                                    </span>
                                                                </td>
                                                                <td style={{ fontSize: '18px', fontWeight: 'bold', color: '#6B4423' }}>
                                                                    {mapping.qty_per_sale}
                                                                </td>
                                                                <td>{invItem.base_unit}</td>
                                                                <td style={{
                                                                    color: qtyOnHand < 50 ? '#ef4444' : qtyOnHand < 100 ? '#f59e0b' : '#10b981',
                                                                    fontWeight: 'bold'
                                                                }}>
                                                                    {qtyOnHand}
                                                                </td>
                                                                <td>${parseFloat(invItem.current_cost || 0).toFixed(2)}</td>
                                                                <td style={{ fontSize: '12px', color: '#6b7280' }}>
                                                                    {mapping.notes || '-'}
                                                                </td>
                                                                <td>
                                                                    <div style={{ display: 'flex', gap: '5px' }}>
                                                                        <button
                                                                            onClick={() => {
                                                                                setEditMappingForm({
                                                                                    id: mapping.id,
                                                                                    qty_per_sale: mapping.qty_per_sale.toString(),
                                                                                    notes: mapping.notes || ''
                                                                                });
                                                                                setShowEditMappingModal(true);
                                                                            }}
                                                                            style={{
                                                                                padding: '6px 12px',
                                                                                fontSize: '13px',
                                                                                backgroundColor: '#f59e0b',
                                                                                color: 'white',
                                                                                border: 'none',
                                                                                borderRadius: '3px',
                                                                                cursor: 'pointer'
                                                                            }}
                                                                        >
                                                                            Á∑®ËºØ
                                                                        </button>
                                                                        <button
                                                                            onClick={() => handleDeleteMapping(mapping.id, invItem.name)}
                                                                            style={{
                                                                                padding: '6px 12px',
                                                                                fontSize: '13px',
                                                                                backgroundColor: '#ef4444',
                                                                                color: 'white',
                                                                                border: 'none',
                                                                                borderRadius: '3px',
                                                                                cursor: 'pointer'
                                                                            }}
                                                                        >
                                                                            Âà™Èô§
                                                                        </button>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                        );
                                                    })}
                                                </tbody>
                                            </table>
                                        )}
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    {/* üÜïüÜï Ê∑ªÂä†ÈÖçÁΩÆ ModalÔºàÊâπÈáèÊ®°ÂºèÔºâ */}
                    {showAddMappingModal && selectedMenuItem && (
                        <div className="modal" onClick={() => setShowAddMappingModal(false)}>
                            <div className="modal-content" onClick={(e) => e.stopPropagation()} style={{ maxWidth: '600px', maxHeight: '80vh', overflowY: 'auto' }}>
                                <span className="close" onClick={() => setShowAddMappingModal(false)}>&times;</span>
                                <h2>‚ûï ÊâπÈáèÊ∑ªÂä†Â∫´Â≠òÈÖçÁΩÆ - {selectedMenuItem.name}</h2>
                                <div style={{ marginTop: '20px' }}>
                                    <div style={{ marginBottom: '20px' }}>
                                        <label style={{ display: 'block', marginBottom: '10px', fontWeight: 'bold', fontSize: '16px' }}>
                                            ÈÅ∏ÊìáÂ∫´Â≠òÂìÅÈ†Ö *
                                            <span style={{ marginLeft: '10px', fontSize: '13px', color: '#6b7280', fontWeight: 'normal' }}>
                                                ÔºàÂ∑≤ÈÅ∏Êìá {selectedInventoryItems.length} È†ÖÔºâ
                                            </span>
                                        </label>
                                        <div style={{
                                            maxHeight: '300px',
                                            overflowY: 'auto',
                                            border: '2px solid #e5e7eb',
                                            borderRadius: '8px',
                                            padding: '12px',
                                            background: '#fafbfc'
                                        }}>
                                            {inventoryItems.map(item => (
                                                <label
                                                    key={item.id}
                                                    style={{
                                                        display: 'flex',
                                                        alignItems: 'center',
                                                        padding: '12px',
                                                        marginBottom: '8px',
                                                        background: 'white',
                                                        border: '1px solid #e5e7eb',
                                                        borderRadius: '6px',
                                                        cursor: 'pointer',
                                                        transition: 'all 0.2s'
                                                    }}
                                                    onMouseEnter={(e) => e.currentTarget.style.background = '#f3f4f6'}
                                                    onMouseLeave={(e) => e.currentTarget.style.background = 'white'}
                                                >
                                                    <input
                                                        type="checkbox"
                                                        checked={selectedInventoryItems.includes(item.id)}
                                                        onChange={(e) => {
                                                            if (e.target.checked) {
                                                                setSelectedInventoryItems([...selectedInventoryItems, item.id]);
                                                            } else {
                                                                setSelectedInventoryItems(selectedInventoryItems.filter(id => id !== item.id));
                                                            }
                                                        }}
                                                        style={{
                                                            width: '18px',
                                                            height: '18px',
                                                            marginRight: '12px',
                                                            cursor: 'pointer'
                                                        }}
                                                    />
                                                    <div style={{ flex: 1 }}>
                                                        <div style={{ fontWeight: 'bold', fontSize: '15px', color: '#111827' }}>
                                                            {item.name}
                                                        </div>
                                                        <div style={{ fontSize: '13px', color: '#6b7280', marginTop: '4px' }}>
                                                            <span style={{
                                                                display: 'inline-block',
                                                                padding: '2px 8px',
                                                                background: '#e0e7ff',
                                                                color: '#3730a3',
                                                                borderRadius: '4px',
                                                                fontSize: '11px',
                                                                marginRight: '8px'
                                                            }}>
                                                                {item.item_type}
                                                            </span>
                                                            Â∫´Â≠ò: <strong>{item.qty_on_hand}</strong> {item.unit}
                                                        </div>
                                                    </div>
                                                </label>
                                            ))}
                                        </div>
                                        <div style={{ marginTop: '10px', display: 'flex', gap: '8px' }}>
                                            <button
                                                onClick={() => setSelectedInventoryItems(inventoryItems.map(i => i.id))}
                                                style={{
                                                    padding: '6px 12px',
                                                    fontSize: '13px',
                                                    background: '#f3f4f6',
                                                    border: '1px solid #d1d5db',
                                                    borderRadius: '4px',
                                                    cursor: 'pointer'
                                                }}
                                            >
                                                ‚úÖ ÂÖ®ÈÅ∏
                                            </button>
                                            <button
                                                onClick={() => setSelectedInventoryItems([])}
                                                style={{
                                                    padding: '6px 12px',
                                                    fontSize: '13px',
                                                    background: '#f3f4f6',
                                                    border: '1px solid #d1d5db',
                                                    borderRadius: '4px',
                                                    cursor: 'pointer'
                                                }}
                                            >
                                                ‚ùå Ê∏ÖÁ©∫
                                            </button>
                                        </div>
                                    </div>
                                    <div style={{ marginBottom: '15px' }}>
                                        <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold' }}>ÊØè‰ªΩÁî®Èáè *</label>
                                        <input
                                            type="number"
                                            min="1"
                                            value={addMappingForm.qtyPerSale}
                                            onChange={(e) => setAddMappingForm({...addMappingForm, qtyPerSale: e.target.value})}
                                            style={{ width: '100%', padding: '10px', fontSize: '16px', border: '1px solid #ddd', borderRadius: '4px' }}
                                        />
                                    </div>
                                    <div style={{ marginBottom: '15px' }}>
                                        <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold' }}>ÂÇôË®ªÔºàÂèØÈÅ∏Ôºâ</label>
                                        <input
                                            type="text"
                                            value={addMappingForm.notes || ''}
                                            onChange={(e) => setAddMappingForm({...addMappingForm, notes: e.target.value})}
                                            placeholder="‰æãÂ¶ÇÔºö‰æøÁï∂Áõí„ÄÅÊπØÊùØ„ÄÅÈ£üÊùêÁ≠â"
                                            style={{ width: '100%', padding: '10px', fontSize: '16px', border: '1px solid #ddd', borderRadius: '4px' }}
                                        />
                                    </div>
                                    <div style={{ display: 'flex', gap: '10px', marginTop: '20px' }}>
                                        <button
                                            onClick={handleAddMapping}
                                            style={{
                                                flex: 1,
                                                padding: '12px',
                                                backgroundColor: '#10b981',
                                                color: 'white',
                                                border: 'none',
                                                borderRadius: '4px',
                                                cursor: 'pointer',
                                                fontSize: '16px',
                                                fontWeight: 'bold'
                                            }}
                                        >
                                            Á¢∫Ë™çÊ∑ªÂä†
                                        </button>
                                        <button
                                            onClick={() => setShowAddMappingModal(false)}
                                            style={{
                                                flex: 1,
                                                padding: '12px',
                                                backgroundColor: '#6b7280',
                                                color: 'white',
                                                border: 'none',
                                                borderRadius: '4px',
                                                cursor: 'pointer',
                                                fontSize: '16px'
                                            }}
                                        >
                                            ÂèñÊ∂à
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* üÜïüÜï ÁºñËæëÈÖçÁΩÆ Modal */}
                    {showEditMappingModal && (
                        <div className="modal" onClick={() => setShowEditMappingModal(false)}>
                            <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                                <span className="close" onClick={() => setShowEditMappingModal(false)}>&times;</span>
                                <h2>‚úèÔ∏è Á∑®ËºØÈÖçÁΩÆ</h2>
                                <div style={{ marginTop: '20px' }}>
                                    <div style={{ marginBottom: '15px' }}>
                                        <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold' }}>ÊØè‰ªΩÁî®Èáè *</label>
                                        <input
                                            type="number"
                                            min="1"
                                            value={editMappingForm.qty_per_sale}
                                            onChange={(e) => setEditMappingForm({...editMappingForm, qty_per_sale: e.target.value})}
                                            style={{ width: '100%', padding: '10px', fontSize: '16px', border: '1px solid #ddd', borderRadius: '4px' }}
                                        />
                                    </div>
                                    <div style={{ marginBottom: '15px' }}>
                                        <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold' }}>ÂÇôË®ªÔºàÂèØÈÅ∏Ôºâ</label>
                                        <input
                                            type="text"
                                            value={editMappingForm.notes || ''}
                                            onChange={(e) => setEditMappingForm({...editMappingForm, notes: e.target.value})}
                                            style={{ width: '100%', padding: '10px', fontSize: '16px', border: '1px solid #ddd', borderRadius: '4px' }}
                                        />
                                    </div>
                                    <div style={{ display: 'flex', gap: '10px', marginTop: '20px' }}>
                                        <button
                                            onClick={handleUpdateMapping}
                                            style={{
                                                flex: 1,
                                                padding: '12px',
                                                backgroundColor: '#f59e0b',
                                                color: 'white',
                                                border: 'none',
                                                borderRadius: '4px',
                                                cursor: 'pointer',
                                                fontSize: '16px',
                                                fontWeight: 'bold'
                                            }}
                                        >
                                            Á¢∫Ë™çÊõ¥Êñ∞
                                        </button>
                                        <button
                                            onClick={() => setShowEditMappingModal(false)}
                                            style={{
                                                flex: 1,
                                                padding: '12px',
                                                backgroundColor: '#6b7280',
                                                color: 'white',
                                                border: 'none',
                                                borderRadius: '4px',
                                                cursor: 'pointer',
                                                fontSize: '16px'
                                            }}
                                        >
                                            ÂèñÊ∂à
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // ‰∏ªÊáâÁî®Á®ãÂºè
        function AdminApp() {
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [currentSession, setCurrentSession] = useState(null);
            const [currentView, setCurrentView] = useState('dashboard');
            const [orders, setOrders] = useState([]);
            const [menu, setMenu] = useState([]);
            const [optionsLibrary, setOptionsLibrary] = useState([]);

            // Ê™¢Êü•ÁôªÂÖ•ÁãÄÊÖã
            useEffect(() => {
                const checkSession = async () => {
                    try {
                        // Á≠âÂæÖ Supabase ÂàùÂßãÂåñ
                        let attempts = 0;
                        while (!window.supabaseReady && attempts < 50) {
                            await new Promise(resolve => setTimeout(resolve, 100));
                            attempts++;
                        }

                        if (!window.supabaseReady || !window.supabaseClient) {
                            return;
                        }

                        // Ê™¢Êü•ÊòØÂê¶ÊúâÁèæÊúâ session
                        const { data: { session } } = await window.supabaseClient.auth.getSession();
                        if (session) {
                            console.log('‚úÖ Found existing session:', session.user.email);
                            setCurrentSession(session);
                            setIsLoggedIn(true);
                        }
                    } catch (error) {
                        console.error('‚ùå Error checking session:', error);
                    }
                };

                checkSession();
            }, []);

            // ËºâÂÖ•Êï∏Êìö
            useEffect(() => {
                if (!isLoggedIn) return;

                const loadAllData = async () => {
                    try {
                        // Á≠âÂæÖ Supabase ÂàùÂßãÂåñ
                        let attempts = 0;
                        while (!window.supabaseReady && attempts < 50) {
                            await new Promise(resolve => setTimeout(resolve, 100));
                            attempts++;
                        }

                        if (!window.supabaseReady) {
                            console.warn('‚ö†Ô∏è Supabase not ready, using localStorage');
                            setOrders(loadFromLocalStorage('orders', []));
                            setMenu(loadFromLocalStorage('menu', []));
                            setOptionsLibrary(loadFromLocalStorage('optionsLibrary', []));
                            return;
                        }

                        console.log('üì° Loading admin data from Supabase...');

                        // ‰∏¶Ë°åÂä†ËºâÊâÄÊúâÊï∏Êìö
                        const [ordersData, menuData, optionsData] = await Promise.all([
                            loadFromSupabase('orders'),
                            loadFromSupabase('menu'),
                            loadFromSupabase('options_library')
                        ]);

                        // Ë®ÇÂñÆÊï∏ÊìöËΩâÊèõÔºàÂÖºÂÆπÂâçÂè∞ÂíåÂì°Â∑•POSÔºâ
                        if (ordersData) {
                            const normalizedOrders = ordersData.map(order => ({
                                id: order.id,
                                orderNumber: order.daily_order_number ? `#${order.daily_order_number}` : `#${order.id.toString().slice(-6)}`,
                                customerName: order.customer_name,
                                phone: order.phone,
                                serviceMode: order.service_mode || order.order_type || 'dine-in',
                                items: order.items,
                                total: parseFloat(order.total || order.total_price || 0),
                                status: order.status || 'pending',
                                notes: order.notes,
                                scheduledTime: order.scheduled_time,
                                timestamp: order.created_at,
                                createdAt: order.created_at,
                                updatedAt: order.updated_at || order.created_at,
                                // Êñ∞Â¢ûÂì°Â∑•POSÂ≠óÊÆµ
                                orderSource: order.order_source || 'customer',
                                paymentMethod: order.payment_method,
                                paymentStatus: order.payment_status,
                                staffName: order.staff_name,
                                subtotal: order.subtotal,
                                tax: order.tax,
                                hasCustomItems: order.has_custom_items
                            }));
                            setOrders(normalizedOrders);
                        } else {
                            setOrders(loadFromLocalStorage('orders', []));
                        }

                        // ËèúÂñÆÊï∏ÊìöËΩâÊèõ
                        if (menuData) {
                            const normalizedMenu = menuData.map(item => ({
                                id: item.id,
                                name: item.name,
                                englishName: item.english_name || '',
                                price: parseFloat(item.price),
                                category: item.category,
                                emoji: item.emoji || '',
                                image: item.image || '',
                                description: item.description || '',
                                isAvailable: item.available !== false,
                                appliedOptionIds: item.applied_option_ids || []
                            }));
                            setMenu(normalizedMenu);
                        } else {
                            setMenu(loadFromLocalStorage('menu', []));
                        }

                        // ÈÅ∏È†ÖÂ∫´Êï∏ÊìöËΩâÊèõ
                        if (optionsData) {
                            const normalizedOptions = optionsData.map(opt => ({
                                id: opt.id,
                                name: opt.name,
                                type: opt.type,
                                required: opt.required || false,
                                isEnabled: opt.is_enabled !== false,
                                categories: opt.categories || [],
                                choices: opt.choices
                            }));
                            setOptionsLibrary(normalizedOptions);
                        } else {
                            setOptionsLibrary(loadFromLocalStorage('optionsLibrary', []));
                        }

                    } catch (error) {
                        console.error('‚ùå Error loading data:', error);
                        setOrders(loadFromLocalStorage('orders', []));
                        setMenu(loadFromLocalStorage('menu', []));
                        setOptionsLibrary(loadFromLocalStorage('optionsLibrary', []));
                    }
                };

                loadAllData();
            }, [isLoggedIn]);

            // ÂÆöÊúüÂæû Supabase Âà∑Êñ∞Êï∏Êìö
            useEffect(() => {
                // Guard: Êú™ÁôªÂÖ•‰∏çÂà∑Êñ∞
                if (!isLoggedIn) return;

                const refreshData = async () => {
                    if (!window.supabaseReady) return;

                    try {
                        // Âà∑Êñ∞Ë®ÇÂñÆ
                        const ordersData = await loadFromSupabase('orders');
                        if (ordersData) {
                            const normalizedOrders = ordersData.map(order => ({
                                id: order.id,
                                orderNumber: `#${order.id.toString().slice(-6)}`,
                                customerName: order.customer_name,
                                phone: order.phone,
                                serviceMode: order.service_mode || 'dine-in',
                                items: order.items,
                                total: parseFloat(order.total),
                                status: order.status || 'pending',
                                notes: order.notes,
                                scheduledTime: order.scheduled_time,
                                timestamp: order.created_at,
                                createdAt: order.created_at,
                                updatedAt: order.updated_at || order.created_at
                            }));
                            setOrders(normalizedOrders);
                        }
                    } catch (error) {
                        console.error('‚ùå Error refreshing data:', error);
                    }
                };

                // ÂÆöÊúüÂà∑Êñ∞Êï∏ÊìöÔºàÊØè10ÁßíÔºâ
                const interval = setInterval(refreshData, 10000);

                return () => {
                    clearInterval(interval);
                };
            }, [isLoggedIn]);

            const handleLogin = (session) => {
                console.log('‚úÖ handleLogin called with session:', session?.user?.email);
                setCurrentSession(session);
                setIsLoggedIn(true);
            };

            const handleLogout = async () => {
                try {
                    if (window.supabaseClient) {
                        await window.supabaseClient.auth.signOut();
                        console.log('‚úÖ Logged out successfully');
                    }
                } catch (error) {
                    console.error('‚ùå Error logging out:', error);
                }
                setCurrentSession(null);
                setIsLoggedIn(false);
                setCurrentView('dashboard');
            };

            const handleUpdateOrder = async (orderId, updatedOrder) => {
                // Ëé∑ÂèñÂéüËÆ¢ÂçïÁä∂ÊÄÅ
                const oldOrder = orders.find(o => o.id === orderId);
                const oldStatus = oldOrder ? oldOrder.status : null;

                const updatedOrders = orders.map(order =>
                    order.id === orderId ? updatedOrder : order
                );
                setOrders(updatedOrders);

                // Êõ¥Êñ∞Âà∞ Supabase
                await updateOrderInSupabase(orderId, updatedOrder);

                // üöÄ Â¶ÇÊûúËÆ¢ÂçïÁä∂ÊÄÅÂèò‰∏∫ acceptedÔºåËá™Âä®Êâ£Èô§ÂåÖÊùêÂ∫ìÂ≠ò
                if (updatedOrder.status === 'accepted' && oldStatus !== 'accepted') {
                    console.log('üì¶ ËÆ¢ÂçïÂ∑≤Êé•ÂèóÔºåÂºÄÂßãÊâ£Èô§ÂåÖÊùêÂ∫ìÂ≠ò...', orderId);

                    try {
                        if (!window.supabaseClient) {
                            console.warn('‚ö†Ô∏è Supabase client not available, skipping inventory deduction');
                            return;
                        }

                        const { data, error } = await window.supabaseClient
                            .rpc('consume_inventory_for_order', {
                                p_order_id: orderId
                            });

                        if (error) {
                            console.error('‚ùå Êâ£Â∫ìÂ≠òÂ§±Ë¥•:', error);
                            alert('‚ö†Ô∏è ËÆ¢ÂçïÂ∑≤Êé•ÂèóÔºå‰ΩÜÂåÖÊùêÂ∫ìÂ≠òÊâ£Èô§Â§±Ë¥•Ôºö\n' + error.message + '\n\nËØ∑Ê£ÄÊü•ÂåÖÊùêÈÖçÁΩÆÊàñÊâãÂä®Ë∞ÉÊï¥Â∫ìÂ≠ò„ÄÇ');
                            return;
                        }

                        if (!data.success) {
                            console.error('‚ùå Â∫ìÂ≠ò‰∏çË∂≥:', data);
                            alert('‚ö†Ô∏è ' + data.message + '\n\nËØ∑Ë°•ÂÖÖÂåÖÊùêÂ∫ìÂ≠òÂêéÂÜçÊé•ÂèóËÆ¢Âçï„ÄÇ');
                            // ÂèØÈÄâÔºöÂõûÊªöËÆ¢ÂçïÁä∂ÊÄÅ
                            // updatedOrder.status = oldStatus;
                            // await updateOrderInSupabase(orderId, updatedOrder);
                            return;
                        }

                        console.log('‚úÖ ÂåÖÊùêÂ∫ìÂ≠òÊâ£Èô§ÊàêÂäü:', data);

                        // ÊòæÁ§∫Êâ£Èô§ËØ¶ÊÉÖ
                        if (data.deductions && data.deductions.length > 0) {
                            const deductionDetails = data.deductions
                                .map(d => `  ‚Ä¢ ${d.packaging}: -${d.qty_deducted} ${d.unit}`)
                                .join('\n');
                            console.log('üì¶ Êâ£Èô§ÊòéÁªÜ:\n' + deductionDetails);
                        }

                    } catch (err) {
                        console.error('‚ùå Êâ£Â∫ìÂ≠òÂºÇÂ∏∏:', err);
                        alert('Êâ£Â∫ìÂ≠òÂ§±Ë¥•Ôºö' + err.message + '\n\nËØ∑Ê£ÄÊü•ÂåÖÊùêÈÖçÁΩÆ„ÄÇ');
                    }
                }

                // ÂÇôÁî®Ôºö‰øùÂ≠òÂà∞ localStorage
                saveToLocalStorage('orders', updatedOrders);
            };

            const handleUpdateMenu = async (updatedMenu) => {
                setMenu(updatedMenu);

                // ‰øùÂ≠òÂà∞ Supabase
                await saveMenuToSupabase(updatedMenu);

                // ÂÇôÁî®Ôºö‰øùÂ≠òÂà∞ localStorage
                saveToLocalStorage('menu', updatedMenu);
            };

            const handleUpdateOptionsLibrary = async (updatedLibrary) => {
                setOptionsLibrary(updatedLibrary);

                // ‰øùÂ≠òÂà∞ Supabase
                await saveOptionsToSupabase(updatedLibrary);

                // ÂÇôÁî®Ôºö‰øùÂ≠òÂà∞ localStorage
                saveToLocalStorage('optionsLibrary', updatedLibrary);
            };

            if (!isLoggedIn) {
                return React.createElement(AdminLogin, { onLogin: handleLogin });
            }

            const menuItems = [
                { id: 'dashboard', icon: 'üìä', label: 'ÂÑÄË°®Êùø' },
                { id: 'orders', icon: 'üì¶', label: 'Ë®ÇÂñÆÁÆ°ÁêÜ' },
                { id: 'menu', icon: 'üç±', label: 'ËèúÂñÆÁÆ°ÁêÜ' },
                { id: 'options', icon: '‚öôÔ∏è', label: 'ÈôÑÂä†ÈÅ∏È†ÖÁÆ°ÁêÜ' },
                { id: 'inventory', icon: 'üì¶', label: 'Â∫´Â≠òÁÆ°ÁêÜ' },
                { id: 'statistics', icon: 'üìà', label: 'Áµ±Ë®àÂ†±Ë°®' }
            ];

            const viewTitles = {
                dashboard: 'ÂÑÄË°®Êùø',
                orders: 'Ë®ÇÂñÆÁÆ°ÁêÜ',
                menu: 'ËèúÂñÆÁÆ°ÁêÜ',
                options: 'ÈôÑÂä†ÈÅ∏È†ÖÁÆ°ÁêÜ',
                inventory: 'Â∫´Â≠òÁÆ°ÁêÜ',
                statistics: 'Áµ±Ë®àÂ†±Ë°®'
            };

            const viewDescriptions = {
                dashboard: 'Âç≥ÊôÇË®ÇÂñÆÁõ£ÊéßËàá‰ªäÊó•Áµ±Ë®à',
                orders: 'ÁÆ°ÁêÜÊâÄÊúâË®ÇÂñÆÁãÄÊÖã',
                menu: 'Á∑®ËºØËèúÂñÆÈ†ÖÁõÆËàá‰æõÊáâÁãÄÊÖã',
                options: 'ÁÆ°ÁêÜÂèØ‰æõÈÅ∏ÊìáÁöÑÈôÑÂä†ÈÅ∏È†ÖÔºåÂ¶ÇËæ£Â∫¶„ÄÅÈ£≤Êñô„ÄÅÂ§ßÂ∞èÁ≠â',
                inventory: 'ÁÆ°ÁêÜÂ∫´Â≠ò„ÄÅÂø´ÈÄüË™øÊï¥„ÄÅÊü•ÁúãÈ†êË≠¶',
                statistics: 'Êü•ÁúãÁáüÊî∂ËàáÈä∑ÂîÆÁµ±Ë®à'
            };

            return (
                <div className="admin-container">
                    <div className="admin-layout">
                        <aside className="sidebar">
                            <div className="sidebar-header">
                                <h1>üç± ÂæåÂè∞ÁÆ°ÁêÜ</h1>
                                <p>Lee's Taiwanese Comfort Food</p>
                            </div>
                            <ul className="sidebar-menu">
                                {menuItems.map(item => (
                                    <li key={item.id}>
                                        <button
                                            className={currentView === item.id ? 'active' : ''}
                                            onClick={() => setCurrentView(item.id)}
                                        >
                                            <span>{item.icon}</span>
                                            <span>{item.label}</span>
                                        </button>
                                    </li>
                                ))}
                            </ul>
                            <div className="sidebar-footer">
                                <button onClick={handleLogout}>
                                    üö™ ÁôªÂá∫
                                </button>
                            </div>
                        </aside>

                        <main className="main-content">
                            <div className="content-header">
                                <h2>{viewTitles[currentView]}</h2>
                                <p>{viewDescriptions[currentView]}</p>
                            </div>
                            <div className="content-body">
                                {currentView === 'dashboard' && (
                                    <Dashboard orders={orders} menu={menu} />
                                )}
                                {currentView === 'orders' && (
                                    <OrderManagement
                                        orders={orders}
                                        onUpdateOrder={handleUpdateOrder}
                                    />
                                )}
                                {currentView === 'menu' && (
                                    <MenuManagement
                                        menu={menu}
                                        onUpdateMenu={handleUpdateMenu}
                                        optionsLibrary={optionsLibrary}
                                    />
                                )}
                                {currentView === 'options' && (
                                    <OptionsManagement
                                        optionsLibrary={optionsLibrary}
                                        onUpdateOptionsLibrary={handleUpdateOptionsLibrary}
                                    />
                                )}
                                {currentView === 'statistics' && (
                                    <Statistics orders={orders} menu={menu} />
                                )}
                                {currentView === 'inventory' && (
                                    <InventoryManagement />
                                )}
                            </div>
                        </main>
                    </div>
                </div>
            );
        }

        // Ê∏≤ÊüìÊáâÁî®Á®ãÂºè
        ReactDOM.render(React.createElement(AdminApp), document.getElementById('root'));
    </script>
</body>
</html>
<!-- Trigger Vercel deployment -->
