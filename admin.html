<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂæåÂè∞ÁÆ°ÁêÜÁ≥ªÁµ± - Lee's Taiwanese Comfort Food</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500;600;700&family=Noto+Serif+TC:wght@400;500;600;700;900&display=swap" rel="stylesheet">

    <style>
        /* Êó•ÂºèÂÆöÈ£üÂ∫óÈ¢®Ê†ºÈÖçËâ≤ - Ê∑°ÈõÖÊ∏ÖÊñ∞ */
        :root {
            --wood-dark: #6B4423;
            --wood-medium: #8B6F47;
            --wood-light: #D4A574;
            --wood-pale: #E8DCC8;
            --cream: #FFFBF5;
            --cream-dark: #F9F5EF;
            --taiwan-red: #C1272D;
            --taiwan-green: #2F5233;
            --warm-white: #FFFFFF;
            --text-dark: #3E2723;
            --text-medium: #5D4037;
            --shadow-soft: rgba(107, 68, 35, 0.08);
            --shadow-medium: rgba(107, 68, 35, 0.12);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Lora', 'Noto Serif TC', serif;
            background: linear-gradient(135deg, var(--wood-pale) 0%, var(--cream-dark) 100%);
            min-height: 100vh;
            position: relative;
        }

        /* Ê∑°ÈõÖÊú®Ë≥™Á¥ãÁêÜËÉåÊôØ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                repeating-linear-gradient(90deg, transparent, transparent 3px, rgba(107, 68, 35, 0.015) 3px, rgba(107, 68, 35, 0.015) 6px),
                repeating-linear-gradient(0deg, transparent, transparent 3px, rgba(107, 68, 35, 0.01) 3px, rgba(107, 68, 35, 0.01) 6px);
            pointer-events: none;
            z-index: 0;
        }

        .admin-container {
            position: relative;
            z-index: 1;
            min-height: 100vh;
        }

        /* ÁôªÂÖ•ÁïåÈù¢ */
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .login-title {
            text-align: center;
            color: var(--wood-dark);
            margin-bottom: 30px;
            font-size: 28px;
        }

        /* ÂæåÂè∞‰ΩàÂ±Ä */
        .admin-layout {
            display: flex;
            height: 100vh;
        }

        /* ÂÅ¥ÈÇäÊ¨Ñ */
        .sidebar {
            width: 260px;
            background: linear-gradient(180deg, var(--wood-dark) 0%, var(--wood-medium) 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 2px 0 8px rgba(0,0,0,0.1);
        }

        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 20px;
        }

        .sidebar-header h1 {
            font-size: 20px;
            margin-bottom: 5px;
        }

        .sidebar-header p {
            font-size: 13px;
            opacity: 0.8;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin: 5px 10px;
        }

        .sidebar-menu button {
            width: 100%;
            padding: 12px 20px;
            background: transparent;
            border: none;
            color: white;
            text-align: left;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-menu button:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .sidebar-menu button.active {
            background: rgba(255, 255, 255, 0.2);
            font-weight: 600;
        }

        .sidebar-footer {
            position: absolute;
            bottom: 20px;
            left: 10px;
            right: 10px;
        }

        .sidebar-footer button {
            width: 100%;
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 17px;
            font-weight: 600;
            white-space: nowrap;
            overflow: visible;
            text-overflow: clip;
        }

        .sidebar-footer button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* ‰∏ªÂÖßÂÆπÂçÄ */
        .main-content {
            flex: 1;
            overflow-y: auto;
            background: var(--cream);
        }

        .content-header {
            background: white;
            padding: 20px 30px;
            border-bottom: 1px solid #e5e7eb;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .content-header h2 {
            color: var(--wood-dark);
            font-size: 24px;
            margin-bottom: 5px;
        }

        .content-header p {
            color: var(--text-medium);
            font-size: 14px;
        }

        .content-body {
            padding: 30px;
        }

        /* Áµ±Ë®àÂç°Áâá */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #8B6F47 0%, #6B4423 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(107, 68, 35, 0.25);
            border: 2px solid rgba(212, 165, 116, 0.3);
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
        }

        /* Ë®ÇÂñÆÂç°Áâá */
        .order-card {
            border: 1px solid rgba(212, 165, 116, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
            background: var(--warm-white);
            box-shadow: 0 2px 6px var(--shadow-soft);
        }

        .order-card:hover {
            border-color: var(--wood-light);
            box-shadow: 0 4px 12px var(--shadow-medium);
            transform: translateY(-2px);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .order-number {
            font-size: 20px;
            font-weight: bold;
            color: var(--wood-dark);
        }

        .order-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }

        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .status-accepted {
            background: #dbeafe;
            color: #1e40af;
        }

        .status-completed {
            background: #d1fae5;
            color: #065f46;
        }

        .status-cancelled {
            background: #fee2e2;
            color: #991b1b;
        }

        .order-items {
            margin: 15px 0;
            padding: 15px;
            background: #f9fafb;
            border-radius: 8px;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .admin-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        /* ÊåâÈàïÊ®£Âºè */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            font-family: 'Lora', 'Noto Serif TC', serif;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--wood-medium) 0%, var(--wood-dark) 100%);
            color: var(--warm-white);
            box-shadow: 0 2px 8px rgba(107, 68, 35, 0.2);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--wood-dark) 0%, var(--wood-medium) 100%);
            box-shadow: 0 4px 12px rgba(107, 68, 35, 0.3);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--cream);
            color: var(--wood-dark);
            border: 2px solid var(--wood-light);
        }

        .btn-secondary:hover {
            background: var(--cream-dark);
            border-color: var(--wood-medium);
            transform: translateY(-2px);
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--taiwan-red) 0%, #A01F23 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(193, 39, 45, 0.2);
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #A01F23 0%, var(--taiwan-red) 100%);
            box-shadow: 0 4px 12px rgba(193, 39, 45, 0.3);
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #f59e0b;
            color: white;
        }

        .btn-warning:hover {
            background: #d97706;
            transform: translateY(-2px);
        }

        /* Ë°®Ê†º */
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 6px var(--shadow-soft);
        }

        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }

        .table th {
            background: #f9fafb;
            font-weight: bold;
            color: var(--wood-dark);
        }

        .table tr:hover {
            background: #f9fafb;
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: var(--warm-white);
            padding: 30px;
            border-radius: 12px;
            max-width: 800px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            border: 1px solid rgba(212, 165, 116, 0.2);
            box-shadow: 0 4px 20px var(--shadow-medium);
        }

        .modal-header {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            color: var(--wood-dark);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            font-family: 'Lora', 'Noto Serif TC', serif;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        /* Toggle ÈñãÈóú */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.3s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: #059669;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        .form-group-inline {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .availability-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: bold;
        }

        .badge-available {
            background: #d1fae5;
            color: #059669;
        }

        .badge-unavailable {
            background: #fee2e2;
            color: #dc2626;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #9ca3af;
        }

        .empty-state-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }

        .search-bar {
            margin-bottom: 20px;
        }

        .search-bar input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
        }

        .search-bar input:focus {
            outline: none;
            border-color: var(--wood-medium);
        }

        /* ÈÅ∏È†ÖÂç°ÁâáÊ®£Âºè */
        .option-card {
            background: var(--warm-white);
            border: 1px solid rgba(212, 165, 116, 0.2);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
            box-shadow: 0 2px 6px var(--shadow-soft);
        }

        .option-card:hover {
            border-color: var(--wood-light);
            box-shadow: 0 4px 12px var(--shadow-medium);
            transform: translateY(-2px);
        }

        .option-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .option-name {
            font-size: 20px;
            font-weight: bold;
            color: var(--wood-dark);
        }

        .option-type-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: bold;
        }

        .badge-radio {
            background: #dbeafe;
            color: #1e40af;
        }

        .badge-checkbox {
            background: #fef3c7;
            color: #92400e;
        }

        .option-values-list {
            background: #f9fafb;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .option-value-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .option-value-item:last-child {
            border-bottom: none;
        }

        .option-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .option-value-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .option-value-input-group input {
            flex: 1;
        }

        .option-value-input-group button {
            padding: 8px 12px;
            font-size: 14px;
        }

        .add-value-btn {
            width: 100%;
            padding: 10px;
            background: var(--cream);
            border: 2px dashed var(--wood-light);
            color: var(--wood-dark);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Lora', 'Noto Serif TC', serif;
            font-size: 14px;
        }

        .add-value-btn:hover {
            background: var(--cream-dark);
            border-color: var(--wood-medium);
        }

        /* ÈüøÊáâÂºèË®≠Ë®à */
        @media (max-width: 768px) {
            .admin-layout {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
            }

            .sidebar-footer {
                position: static;
                margin-top: 20px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Supabase ÂàùÂßãÂåñ -->
    <script>
        // Supabase ÈÖçÁΩÆ
        var SUPABASE_URL = 'https://tskelejztsdeewtpjcoq.supabase.co';
        var SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRza2VsZWp6dHNkZWV3dHBqY29xIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExOTUxNjUsImV4cCI6MjA4Njc3MTE2NX0.WFGyeBVRIXfrA9h2BVwQ9zpbmcHDXmI0xsFfdDVdGos';

        window.supabaseClient = null;
        window.supabaseReady = false;

        // Âä®ÊÄÅÂä†ËΩΩ Supabase CDN
        (function() {
            var script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.js';

            script.onload = function() {
                console.log('‚úÖ [Admin] Supabase CDN loaded');
                if (window.supabase && window.supabase.createClient) {
                    try {
                        window.supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                        window.supabaseReady = true;
                        console.log('‚úÖ [Admin] Supabase client initialized');
                    } catch (e) {
                        console.error('‚ùå [Admin] Supabase initialization failed:', e);
                    }
                }
            };

            script.onerror = function() {
                console.error('‚ùå [Admin] Supabase CDN loading failed');
            };

            document.head.appendChild(script);
        })();
    </script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ‰∏äÂÇ≥ÂúñÁâáÂà∞ Supabase Storage
        const uploadImageToSupabase = async (file) => {
            try {
                if (!window.supabaseClient) {
                    throw new Error('Supabase client not initialized');
                }

                // ÁîüÊàêÂîØ‰∏ÄÊñá‰ª∂Âêç
                const fileExt = file.name.split('.').pop();
                const fileName = `${Date.now()}-${Math.random().toString(36).substring(7)}.${fileExt}`;
                const filePath = `menu/${fileName}`;

                console.log('üì§ Uploading image:', filePath);

                // ‰∏äÂÇ≥Êñá‰ª∂Âà∞ Storage
                const { data, error } = await window.supabaseClient.storage
                    .from('menu-images')
                    .upload(filePath, file, {
                        cacheControl: '3600',
                        upsert: false
                    });

                if (error) {
                    console.error('‚ùå Upload error:', error);
                    throw error;
                }

                // Áç≤ÂèñÂÖ¨Èñã URL
                const { data: urlData } = window.supabaseClient.storage
                    .from('menu-images')
                    .getPublicUrl(filePath);

                console.log('‚úÖ Image uploaded:', urlData.publicUrl);
                return urlData.publicUrl;
            } catch (error) {
                console.error('‚ùå Error uploading image:', error);
                throw error;
            }
        };

        // Âæû Supabase Âä†ËºâÊï∏Êìö
        const loadFromSupabase = async (table) => {
            try {
                if (!window.supabaseReady || !window.supabaseClient) {
                    console.warn(`‚ö†Ô∏è Supabase not ready, using localStorage for ${table}`);
                    return null;
                }

                console.log(`üì° Loading ${table} from Supabase...`);
                const { data, error } = await window.supabaseClient
                    .from(table)
                    .select('*')
                    .order('id');

                if (error) {
                    console.error(`‚ùå Error loading ${table}:`, error);
                    return null;
                }

                console.log(`‚úÖ Loaded ${data.length} items from ${table}`);
                return data;
            } catch (error) {
                console.error(`‚ùå Error loading from Supabase ${table}:`, error);
                return null;
            }
        };

        // ‰øùÂ≠òËèúÂñÆÂà∞ Supabase
        const saveMenuToSupabase = async (menuData) => {
            try {
                if (!window.supabaseReady || !window.supabaseClient) {
                    console.warn('‚ö†Ô∏è Supabase not ready, using localStorage');
                    localStorage.setItem('menu', JSON.stringify(menuData));
                    return false;
                }

                console.log('üíæ Saving menu to Supabase...');

                // ËΩâÊèõÂâçÁ´ØÊ†ºÂºèÂà∞Êï∏ÊìöÂ∫´Ê†ºÂºè
                const dbFormat = menuData.map(item => ({
                    id: item.id,
                    name: item.name,
                    english_name: item.englishName || null,
                    price: parseFloat(item.price),
                    category: item.category,
                    emoji: item.emoji || null,
                    image: item.image || null,
                    description: item.description || null,
                    available: item.isAvailable !== false,
                    applied_option_ids: item.appliedOptionIds || []
                }));

                const { error } = await window.supabaseClient
                    .from('menu')
                    .upsert(dbFormat, { onConflict: 'id' });

                if (error) {
                    console.error('‚ùå Error saving menu:', error);
                    // ÂÇôÁî®Ôºö‰øùÂ≠òÂà∞ localStorage
                    localStorage.setItem('menu', JSON.stringify(menuData));
                    return false;
                }

                console.log('‚úÖ Menu saved to Supabase');
                return true;
            } catch (error) {
                console.error('‚ùå Error:', error);
                localStorage.setItem('menu', JSON.stringify(menuData));
                return false;
            }
        };

        // ‰øùÂ≠òÈÅ∏È†ÖÂ∫´Âà∞ Supabase
        const saveOptionsToSupabase = async (optionsData) => {
            try {
                if (!window.supabaseReady || !window.supabaseClient) {
                    console.warn('‚ö†Ô∏è Supabase not ready, using localStorage');
                    localStorage.setItem('optionsLibrary', JSON.stringify(optionsData));
                    return false;
                }

                console.log('üíæ Saving options to Supabase...');

                // ËΩâÊèõÂâçÁ´ØÊ†ºÂºèÂà∞Êï∏ÊìöÂ∫´Ê†ºÂºè
                const dbFormat = optionsData.map(item => ({
                    id: item.id,
                    name: item.name,
                    type: item.type,
                    required: item.required || false,
                    is_enabled: item.isEnabled !== false,
                    categories: item.categories || [],
                    choices: item.choices
                }));

                const { error } = await window.supabaseClient
                    .from('options_library')
                    .upsert(dbFormat, { onConflict: 'id' });

                if (error) {
                    console.error('‚ùå Error saving options:', error);
                    localStorage.setItem('optionsLibrary', JSON.stringify(optionsData));
                    return false;
                }

                console.log('‚úÖ Options saved to Supabase');
                return true;
            } catch (error) {
                console.error('‚ùå Error:', error);
                localStorage.setItem('optionsLibrary', JSON.stringify(optionsData));
                return false;
            }
        };

        // Êõ¥Êñ∞Ë®ÇÂñÆÁãÄÊÖãÂà∞ Supabase
        const updateOrderInSupabase = async (orderId, updates) => {
            try {
                if (!window.supabaseReady || !window.supabaseClient) {
                    console.warn('‚ö†Ô∏è Supabase not ready, using localStorage');
                    return false;
                }

                console.log(`üíæ Updating order ${orderId} in Supabase...`);

                const { error } = await window.supabaseClient
                    .from('orders')
                    .update({
                        status: updates.status,
                        updated_at: new Date().toISOString()
                    })
                    .eq('id', orderId);

                if (error) {
                    console.error('‚ùå Error updating order:', error);
                    return false;
                }

                console.log('‚úÖ Order updated in Supabase');
                return true;
            } catch (error) {
                console.error('‚ùå Error:', error);
                return false;
            }
        };

        // Âæû localStorage ËÆÄÂèñÊï∏ÊìöÔºàÂÇôÁî®Ôºâ
        const loadFromLocalStorage = (key, defaultValue) => {
            try {
                const item = localStorage.getItem(key);
                return item ? JSON.parse(item) : defaultValue;
            } catch (error) {
                console.error('Error loading from localStorage:', error);
                return defaultValue;
            }
        };

        // ÂÑ≤Â≠òÂà∞ localStorageÔºàÂÇôÁî®Ôºâ
        const saveToLocalStorage = (key, value) => {
            try {
                localStorage.setItem(key, JSON.stringify(value));
            } catch (error) {
                console.error('Error saving to localStorage:', error);
            }
        };

        // ÁôªÂÖ•ÁµÑ‰ª∂ - ‰ΩøÁî® Supabase Auth
        function AdminLogin({ onLogin }) {
            const [email, setEmail] = React.useState('');
            const [password, setPassword] = React.useState('');
            const [error, setError] = React.useState('');
            const [loading, setLoading] = React.useState(false);

            const handleLogin = async (e) => {
                e.preventDefault();
                setError('');
                setLoading(true);

                try {
                    // Á≠âÂæÖ Supabase ÂàùÂßãÂåñ
                    let attempts = 0;
                    while (!window.supabaseReady && attempts < 50) {
                        await new Promise(resolve => setTimeout(resolve, 100));
                        attempts++;
                    }

                    if (!window.supabaseReady || !window.supabaseClient) {
                        throw new Error('Supabase Êú™ÂàùÂßãÂåñÔºåË´ãÂà∑Êñ∞È†ÅÈù¢ÈáçË©¶');
                    }

                    console.log('üîê Attempting login with email:', email);

                    // ‰ΩøÁî® Supabase Auth ÁôªÂÖ•
                    const { data, error: authError } = await window.supabaseClient.auth.signInWithPassword({
                        email: email,
                        password: password
                    });

                    if (authError) {
                        console.error('‚ùå Login error:', authError);
                        throw authError;
                    }

                    if (data && data.user) {
                        console.log('‚úÖ Login successful:', data.user.email);
                        onLogin(data.session);
                    } else {
                        throw new Error('ÁôªÂÖ•Â§±ÊïóÔºöÁÑ°Ê≥ïÁç≤ÂèñÁî®Êà∂‰ø°ÊÅØ');
                    }
                } catch (err) {
                    console.error('‚ùå Login failed:', err);
                    if (err.message.includes('Invalid login credentials')) {
                        setError('ÁôªÂÖ•Â§±ÊïóÔºöÈÉµÁÆ±ÊàñÂØÜÁ¢ºÈåØË™§');
                    } else if (err.message.includes('Email not confirmed')) {
                        setError('Ë´ãÂÖàÁ¢∫Ë™çÊÇ®ÁöÑÈÉµÁÆ±Âú∞ÂùÄ');
                    } else {
                        setError(err.message || 'ÁôªÂÖ•Â§±ÊïóÔºåË´ãÈáçË©¶');
                    }
                } finally {
                    setLoading(false);
                }
            };

            return React.createElement('div', { className: 'login-container' },
                React.createElement('h2', { className: 'login-title' }, 'üîê ÁÆ°ÁêÜÂæåÂè∞ÁôªÂÖ•'),
                React.createElement('form', { onSubmit: handleLogin },
                    React.createElement('div', { className: 'form-group' },
                        React.createElement('label', null, 'ÁÆ°ÁêÜÂì°ÈÉµÁÆ±'),
                        React.createElement('input', {
                            type: 'email',
                            value: email,
                            onChange: (e) => setEmail(e.target.value),
                            placeholder: 'Ë´ãËº∏ÂÖ•ÁÆ°ÁêÜÂì°ÈÉµÁÆ±',
                            required: true,
                            disabled: loading
                        })
                    ),
                    React.createElement('div', { className: 'form-group', style: { marginTop: '15px' } },
                        React.createElement('label', null, 'ÂØÜÁ¢º'),
                        React.createElement('input', {
                            type: 'password',
                            value: password,
                            onChange: (e) => setPassword(e.target.value),
                            placeholder: 'Ë´ãËº∏ÂÖ•ÂØÜÁ¢º',
                            required: true,
                            disabled: loading
                        })
                    ),
                    error && React.createElement('p', {
                        style: { color: 'red', marginBottom: '15px' }
                    }, error),
                    React.createElement('button', {
                        type: 'submit',
                        className: 'btn btn-primary',
                        style: { width: '100%' },
                        disabled: loading
                    }, loading ? 'ÁôªÂÖ•‰∏≠...' : 'ÁôªÂÖ•')
                ),
                React.createElement('p', {
                    style: { marginTop: '20px', textAlign: 'center', color: '#666', fontSize: '14px' }
                }, '‰ΩøÁî® Supabase Auth ÁÆ°ÁêÜÂì°Â∏≥ËôüÁôªÂÖ•')
            );
        }

        // ÂÑÄË°®ÊùøÁµÑ‰ª∂
        function Dashboard({ orders, menu }) {
            const today = new Date().toDateString();

            const todayOrders = orders.filter(order =>
                new Date(order.timestamp).toDateString() === today
            );

            const stats = {
                orderCount: todayOrders.length,
                revenue: todayOrders.reduce((sum, order) => sum + order.total, 0),
                itemCount: todayOrders.reduce((sum, order) =>
                    sum + order.items.reduce((itemSum, item) => itemSum + item.quantity, 0), 0
                ),
                pendingCount: todayOrders.filter(o => o.status === 'pending').length
            };

            const pendingOrders = orders.filter(o => o.status === 'pending');

            return (
                <div>
                    <div className="stats-grid">
                        <div className="stat-card">
                            <div className="stat-label">‰ªäÊó•Ë®ÇÂñÆÊï∏</div>
                            <div className="stat-value">{stats.orderCount}</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">‰ªäÊó•ÁáüÊ•≠È°ç</div>
                            <div className="stat-value">${stats.revenue.toFixed(2)}</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">‰ªäÊó•Èä∑ÂîÆÊï∏Èáè</div>
                            <div className="stat-value">{stats.itemCount}</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">ÂæÖËôïÁêÜË®ÇÂñÆ</div>
                            <div className="stat-value">{stats.pendingCount}</div>
                        </div>
                    </div>

                    <h3 style={{ marginTop: '30px', marginBottom: '15px', color: '#6B4423' }}>
                        üîî ÂæÖËôïÁêÜË®ÇÂñÆ ({pendingOrders.length})
                    </h3>

                    {pendingOrders.length === 0 ? (
                        <div className="empty-state">
                            <div className="empty-state-icon">‚úÖ</div>
                            <p>ÁõÆÂâçÊ≤íÊúâÂæÖËôïÁêÜÁöÑË®ÇÂñÆ</p>
                        </div>
                    ) : (
                        pendingOrders.map(order => (
                            <OrderCard key={order.id} order={order} />
                        ))
                    )}
                </div>
            );
        }

        // Ë®ÇÂñÆÁÆ°ÁêÜÁµÑ‰ª∂
        function OrderManagement({ orders, onUpdateOrder }) {
            const [filter, setFilter] = useState('all');
            const [searchTerm, setSearchTerm] = useState('');

            const filteredOrders = orders.filter(order => {
                const matchesFilter = filter === 'all' || order.status === filter;
                const matchesSearch = order.id.toString().includes(searchTerm) ||
                                    order.customerName?.toLowerCase().includes(searchTerm.toLowerCase());
                return matchesFilter && matchesSearch;
            });

            return (
                <div>
                    <div style={{ display: 'flex', gap: '10px', marginBottom: '20px' }}>
                        <button
                            className={`btn ${filter === 'all' ? 'btn-primary' : 'btn-secondary'}`}
                            onClick={() => setFilter('all')}
                        >
                            ÂÖ®ÈÉ® ({orders.length})
                        </button>
                        <button
                            className={`btn ${filter === 'pending' ? 'btn-primary' : 'btn-secondary'}`}
                            onClick={() => setFilter('pending')}
                        >
                            ÂæÖËôïÁêÜ ({orders.filter(o => o.status === 'pending').length})
                        </button>
                        <button
                            className={`btn ${filter === 'accepted' ? 'btn-primary' : 'btn-secondary'}`}
                            onClick={() => setFilter('accepted')}
                        >
                            ÈÄ≤Ë°å‰∏≠ ({orders.filter(o => o.status === 'accepted').length})
                        </button>
                        <button
                            className={`btn ${filter === 'completed' ? 'btn-primary' : 'btn-secondary'}`}
                            onClick={() => setFilter('completed')}
                        >
                            Â∑≤ÂÆåÊàê ({orders.filter(o => o.status === 'completed').length})
                        </button>
                    </div>

                    <div className="search-bar">
                        <input
                            type="text"
                            placeholder="ÊêúÂ∞ãË®ÇÂñÆÁ∑®ËôüÊàñÈ°ßÂÆ¢ÂßìÂêç..."
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                        />
                    </div>

                    {filteredOrders.length === 0 ? (
                        <div className="empty-state">
                            <div className="empty-state-icon">üì¶</div>
                            <p>Ê≤íÊúâÊâæÂà∞Ë®ÇÂñÆ</p>
                        </div>
                    ) : (
                        filteredOrders.map(order => (
                            <OrderCard
                                key={order.id}
                                order={order}
                                onUpdateOrder={onUpdateOrder}
                            />
                        ))
                    )}
                </div>
            );
        }

        // Ë®ÇÂñÆÂç°ÁâáÁµÑ‰ª∂
        function OrderCard({ order, onUpdateOrder }) {
            const statusMap = {
                pending: { text: 'ÂæÖËôïÁêÜ', class: 'status-pending' },
                accepted: { text: 'ÈÄ≤Ë°å‰∏≠', class: 'status-accepted' },
                completed: { text: 'Â∑≤ÂÆåÊàê', class: 'status-completed' },
                cancelled: { text: 'Â∑≤ÂèñÊ∂à', class: 'status-cancelled' }
            };

            const handleStatusChange = (newStatus) => {
                if (onUpdateOrder) {
                    onUpdateOrder(order.id, { ...order, status: newStatus });
                }
            };

            return (
                <div className="order-card">
                    <div className="order-header">
                        <div>
                            <div className="order-number">Ë®ÇÂñÆ #{order.id}</div>
                            <div style={{ fontSize: '14px', color: '#666', marginTop: '5px' }}>
                                {new Date(order.timestamp).toLocaleString('zh-TW')}
                            </div>
                        </div>
                        <span className={`order-status ${statusMap[order.status].class}`}>
                            {statusMap[order.status].text}
                        </span>
                    </div>

                    {order.customerName && (
                        <div style={{ marginBottom: '10px', fontSize: '15px' }}>
                            <strong>È°ßÂÆ¢:</strong> {order.customerName}
                            {order.phone && ` ‚Ä¢ ${order.phone}`}
                        </div>
                    )}

                    {order.serviceMode && (
                        <div style={{ marginBottom: '10px', fontSize: '15px' }}>
                            <strong>Áî®È§êÊñπÂºè:</strong> {order.serviceMode === 'dine-in' ? 'ÂÖßÁî®' : 'Â§ñÂ∏∂'}
                        </div>
                    )}

                    <div className="order-items">
                        {order.items.map((item, index) => (
                            <div key={index} className="order-item">
                                <span>{item.name} x {item.quantity}</span>
                                <span>${(item.price * item.quantity).toFixed(2)}</span>
                            </div>
                        ))}
                        <div style={{ marginTop: '10px', paddingTop: '10px', borderTop: '1px solid #e5e7eb', fontWeight: 'bold' }}>
                            <div className="order-item">
                                <span>Á∏ΩË®à</span>
                                <span style={{ color: '#6B4423', fontSize: '18px' }}>${order.total.toFixed(2)}</span>
                            </div>
                        </div>
                    </div>

                    {order.notes && (
                        <div style={{ marginTop: '10px', padding: '10px', background: '#fef3c7', borderRadius: '5px', fontSize: '14px' }}>
                            <strong>ÂÇôË®ª:</strong> {order.notes}
                        </div>
                    )}

                    {onUpdateOrder && order.status !== 'completed' && order.status !== 'cancelled' && (
                        <div className="admin-actions">
                            {order.status === 'pending' && (
                                <>
                                    <button
                                        className="btn btn-success"
                                        onClick={() => handleStatusChange('accepted')}
                                    >
                                        Êé•ÂèóË®ÇÂñÆ
                                    </button>
                                    <button
                                        className="btn btn-danger"
                                        onClick={() => handleStatusChange('cancelled')}
                                    >
                                        ÊãíÁµïË®ÇÂñÆ
                                    </button>
                                </>
                            )}
                            {order.status === 'accepted' && (
                                <button
                                    className="btn btn-success"
                                    onClick={() => handleStatusChange('completed')}
                                >
                                    ÂÆåÊàêË®ÇÂñÆ
                                </button>
                            )}
                        </div>
                    )}
                </div>
            );
        }

        // ËèúÂñÆÁÆ°ÁêÜÁµÑ‰ª∂
        function MenuManagement({ menu, onUpdateMenu, optionsLibrary = [] }) {
            const [editingItem, setEditingItem] = useState(null);
            const [showModal, setShowModal] = useState(false);
            const [filter, setFilter] = useState('all');

            const categories = {
                all: 'ÂÖ®ÈÉ®',
                highlight: 'Â∞èÂ∫óÁ≤æÈÅ∏',
                fried: 'ÂêÑÂºèÁÇ∏Áâ©',
                bento: '‰æøÁï∂/ËìãÈ£Ø',
                drinks: 'È£≤Êñô'
            };

            const filteredMenu = filter === 'all'
                ? menu
                : menu.filter(item => item.category === filter);

            const handleSaveItem = (item) => {
                const updatedMenu = editingItem.id
                    ? menu.map(m => m.id === item.id ? item : m)
                    : [...menu, { ...item, id: Date.now() }];

                onUpdateMenu(updatedMenu);
                setShowModal(false);
                setEditingItem(null);
            };

            const handleDeleteItem = (id) => {
                if (confirm('Á¢∫ÂÆöË¶ÅÂà™Èô§ÈÄôÂÄãËèúÂñÆÈ†ÖÁõÆÂóéÔºü')) {
                    onUpdateMenu(menu.filter(item => item.id !== id));
                }
            };

            const handleToggleAvailability = (id) => {
                const updatedMenu = menu.map(item =>
                    item.id === id ? { ...item, available: !item.available } : item
                );
                onUpdateMenu(updatedMenu);
            };

            return (
                <div>
                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '20px' }}>
                        <div style={{ display: 'flex', gap: '10px' }}>
                            {Object.entries(categories).map(([key, label]) => (
                                <button
                                    key={key}
                                    className={`btn ${filter === key ? 'btn-primary' : 'btn-secondary'}`}
                                    onClick={() => setFilter(key)}
                                >
                                    {label}
                                </button>
                            ))}
                        </div>
                        <button
                            className="btn btn-success"
                            onClick={() => {
                                setEditingItem({
                                    name: '',
                                    englishName: '',
                                    price: 0,
                                    category: 'highlight',
                                    emoji: 'üç±',
                                    image: '',
                                    description: '',
                                    available: true,
                                    options: []
                                });
                                setShowModal(true);
                            }}
                        >
                            ‚ûï Êñ∞Â¢ûËèúÂñÆ
                        </button>
                    </div>

                    <table className="table">
                        <thead>
                            <tr>
                                <th>ÂêçÁ®±</th>
                                <th>ÂàÜÈ°û</th>
                                <th>ÂÉπÊ†º</th>
                                <th>ÁãÄÊÖã</th>
                                <th>Êìç‰Ωú</th>
                            </tr>
                        </thead>
                        <tbody>
                            {filteredMenu.map(item => (
                                <tr key={item.id}>
                                    <td>
                                        <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>
                                            <span style={{ fontSize: '24px' }}>{item.emoji}</span>
                                            <div>
                                                <div style={{ fontWeight: 'bold' }}>{item.name}</div>
                                                <div style={{ fontSize: '12px', color: '#666' }}>
                                                    {item.englishName}
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>{categories[item.category]}</td>
                                    <td style={{ fontWeight: 'bold', color: '#6B4423' }}>
                                        ${item.price.toFixed(2)}
                                    </td>
                                    <td>
                                        <label className="toggle-switch">
                                            <input
                                                type="checkbox"
                                                checked={item.available !== false}
                                                onChange={() => handleToggleAvailability(item.id)}
                                            />
                                            <span className="toggle-slider"></span>
                                        </label>
                                        <span style={{ marginLeft: '10px', fontSize: '13px' }}>
                                            {item.available !== false ? '‰æõÊáâ‰∏≠' : 'Â∑≤ÂîÆÁΩÑ'}
                                        </span>
                                    </td>
                                    <td>
                                        <div style={{ display: 'flex', gap: '5px' }}>
                                            <button
                                                className="btn btn-secondary"
                                                style={{ padding: '5px 10px', fontSize: '14px' }}
                                                onClick={() => {
                                                    setEditingItem(item);
                                                    setShowModal(true);
                                                }}
                                            >
                                                Á∑®ËºØ
                                            </button>
                                            <button
                                                className="btn btn-danger"
                                                style={{ padding: '5px 10px', fontSize: '14px' }}
                                                onClick={() => handleDeleteItem(item.id)}
                                            >
                                                Âà™Èô§
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>

                    {showModal && (
                        <MenuItemModal
                            item={editingItem}
                            onSave={handleSaveItem}
                            onClose={() => {
                                setShowModal(false);
                                setEditingItem(null);
                            }}
                            optionsLibrary={optionsLibrary}
                        />
                    )}
                </div>
            );
        }

        // ËèúÂñÆÈ†ÖÁõÆÁ∑®ËºØ Modal
        function MenuItemModal({ item, onSave, onClose, optionsLibrary = [] }) {
            const [formData, setFormData] = useState(item);

            const handleChange = (field, value) => {
                setFormData({ ...formData, [field]: value });
            };

            const handleToggleOption = (optionId) => {
                const currentIds = formData.appliedOptionIds || [];
                const newIds = currentIds.includes(optionId)
                    ? currentIds.filter(id => id !== optionId)
                    : [...currentIds, optionId];
                setFormData({ ...formData, appliedOptionIds: newIds });
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave(formData);
            };

            return (
                <div className="modal" onClick={onClose}>
                    <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                        <div className="modal-header">
                            {item.id ? 'Á∑®ËºØËèúÂñÆÈ†ÖÁõÆ' : 'Êñ∞Â¢ûËèúÂñÆÈ†ÖÁõÆ'}
                        </div>
                        <form onSubmit={handleSubmit}>
                            <div className="form-group">
                                <label>‰∏≠ÊñáÂêçÁ®± *</label>
                                <input
                                    type="text"
                                    value={formData.name}
                                    onChange={(e) => handleChange('name', e.target.value)}
                                    required
                                />
                            </div>
                            <div className="form-group">
                                <label>Ëã±ÊñáÂêçÁ®±</label>
                                <input
                                    type="text"
                                    value={formData.englishName}
                                    onChange={(e) => handleChange('englishName', e.target.value)}
                                />
                            </div>
                            <div className="form-group">
                                <label>ÂÉπÊ†º *</label>
                                <input
                                    type="number"
                                    step="0.01"
                                    value={formData.price}
                                    onChange={(e) => handleChange('price', parseFloat(e.target.value))}
                                    required
                                />
                            </div>
                            <div className="form-group">
                                <label>ÂàÜÈ°û *</label>
                                <select
                                    value={formData.category}
                                    onChange={(e) => handleChange('category', e.target.value)}
                                    required
                                >
                                    <option value="highlight">Â∞èÂ∫óÁ≤æÈÅ∏</option>
                                    <option value="fried">ÂêÑÂºèÁÇ∏Áâ©</option>
                                    <option value="bento">‰æøÁï∂/ËìãÈ£Ø</option>
                                    <option value="drinks">È£≤Êñô</option>
                                </select>
                            </div>
                            <div className="form-group">
                                <label>ÂúñÁ§∫ Emoji</label>
                                <input
                                    type="text"
                                    value={formData.emoji}
                                    onChange={(e) => handleChange('emoji', e.target.value)}
                                    placeholder="üç±"
                                />
                            </div>
                            <div className="form-group">
                                <label>ÂúñÁâá</label>

                                {/* ÂõæÁâáÈ¢ÑËßà */}
                                {formData.image && (
                                    <div style={{
                                        marginBottom: '10px',
                                        border: '2px solid #e0e0e0',
                                        borderRadius: '8px',
                                        padding: '10px',
                                        background: '#f9f9f9'
                                    }}>
                                        <img
                                            src={formData.image}
                                            alt="ÂïÜÂìÅÂúñÁâá"
                                            style={{
                                                maxWidth: '200px',
                                                maxHeight: '200px',
                                                borderRadius: '6px',
                                                display: 'block',
                                                marginBottom: '8px'
                                            }}
                                        />
                                        <button
                                            type="button"
                                            className="btn btn-secondary"
                                            style={{ fontSize: '12px', padding: '4px 8px' }}
                                            onClick={() => handleChange('image', '')}
                                        >
                                            üóëÔ∏è ÁßªÈô§ÂúñÁâá
                                        </button>
                                    </div>
                                )}

                                {/* Êñá‰ª∂‰∏ä‰º† */}
                                <div style={{ marginBottom: '10px' }}>
                                    <input
                                        type="file"
                                        accept="image/*"
                                        id="imageUpload"
                                        style={{ display: 'none' }}
                                        onChange={async (e) => {
                                            const file = e.target.files[0];
                                            if (!file) return;

                                            // Ê™¢Êü•Êñá‰ª∂Â§ßÂ∞èÔºàÊúÄÂ§ß 2MBÔºâ
                                            if (file.size > 2 * 1024 * 1024) {
                                                alert('ÂúñÁâáÊ™îÊ°àÂ§™Â§ßÔºÅË´ãÈÅ∏ÊìáÂ∞èÊñº 2MB ÁöÑÂúñÁâá„ÄÇ');
                                                return;
                                            }

                                            try {
                                                const uploadBtn = document.querySelector('.upload-status');
                                                if (uploadBtn) uploadBtn.textContent = '‚è≥ ‰∏äÂÇ≥‰∏≠...';

                                                const imageUrl = await uploadImageToSupabase(file);
                                                handleChange('image', imageUrl);

                                                if (uploadBtn) uploadBtn.textContent = '‚úÖ ‰∏äÂÇ≥ÊàêÂäüÔºÅ';
                                                setTimeout(() => {
                                                    if (uploadBtn) uploadBtn.textContent = '';
                                                }, 2000);
                                            } catch (error) {
                                                alert('ÂúñÁâá‰∏äÂÇ≥Â§±ÊïóÔºö' + error.message);
                                                console.error(error);
                                            }
                                            e.target.value = ''; // ÈáçÁΩÆÊñá‰ª∂ËæìÂÖ•
                                        }}
                                    />
                                    <button
                                        type="button"
                                        className="btn btn-primary"
                                        onClick={() => document.getElementById('imageUpload').click()}
                                        style={{ marginRight: '10px' }}
                                    >
                                        üì∑ ÈÅ∏ÊìáÂúñÁâá‰∏äÂÇ≥
                                    </button>
                                    <span className="upload-status" style={{ color: '#059669', fontWeight: '600' }}></span>
                                </div>

                                {/* ÊâãÂä®ËæìÂÖ• URLÔºàÂèØÈÄâÔºâ */}
                                <div style={{ fontSize: '12px', color: '#666', marginBottom: '6px' }}>
                                    ÊàñÊâãÂãïËº∏ÂÖ•ÂúñÁâáÁ∂≤ÂùÄÔºö
                                </div>
                                <input
                                    type="text"
                                    placeholder="https://..."
                                    value={formData.image}
                                    onChange={(e) => handleChange('image', e.target.value)}
                                />
                            </div>
                            <div className="form-group">
                                <label>ÊèèËø∞</label>
                                <textarea
                                    value={formData.description}
                                    onChange={(e) => handleChange('description', e.target.value)}
                                />
                            </div>
                            <div className="form-group-inline">
                                <label className="toggle-switch">
                                    <input
                                        type="checkbox"
                                        checked={formData.available !== false}
                                        onChange={(e) => handleChange('available', e.target.checked)}
                                    />
                                    <span className="toggle-slider"></span>
                                </label>
                                <label>‰æõÊáâ‰∏≠</label>
                            </div>

                            {/* ÂÖ®Â±ÄÈÅ∏È†ÖÈÅ∏Êìá */}
                            {optionsLibrary.length > 0 && (
                                <div className="form-group">
                                    <label style={{ marginBottom: '12px', display: 'block' }}>
                                        üéØ ÊáâÁî®ÂÖ®Â±ÄÈÅ∏È†ÖÔºàÈ°ßÂÆ¢ÈªûÈ§êÊôÇÂèØÈÅ∏ÊìáÔºâ
                                    </label>
                                    <div style={{
                                        border: '1px solid #e0e0e0',
                                        borderRadius: '8px',
                                        padding: '12px',
                                        background: '#f9f9f9'
                                    }}>
                                        {optionsLibrary.filter(opt => opt.isEnabled !== false).map(option => (
                                            <div key={option.id} style={{
                                                display: 'flex',
                                                alignItems: 'center',
                                                padding: '8px',
                                                marginBottom: '8px',
                                                background: 'white',
                                                borderRadius: '6px',
                                                border: (formData.appliedOptionIds || []).includes(option.id)
                                                    ? '2px solid #059669'
                                                    : '1px solid #e0e0e0',
                                                cursor: 'pointer'
                                            }} onClick={() => handleToggleOption(option.id)}>
                                                <input
                                                    type="checkbox"
                                                    checked={(formData.appliedOptionIds || []).includes(option.id)}
                                                    onChange={() => handleToggleOption(option.id)}
                                                    style={{ marginRight: '10px', width: '18px', height: '18px', cursor: 'pointer' }}
                                                />
                                                <div style={{ flex: 1 }}>
                                                    <div style={{ fontWeight: '600', color: '#333' }}>
                                                        {option.name}
                                                        {option.required && (
                                                            <span style={{
                                                                marginLeft: '8px',
                                                                fontSize: '12px',
                                                                color: '#ef4444',
                                                                background: '#fee2e2',
                                                                padding: '2px 6px',
                                                                borderRadius: '4px'
                                                            }}>ÂøÖÈÅ∏</span>
                                                        )}
                                                    </div>
                                                    <div style={{ fontSize: '12px', color: '#666', marginTop: '2px' }}>
                                                        {option.type === 'single' ? 'ÂñÆÈÅ∏' : 'Â§öÈÅ∏'} ‚Ä¢
                                                        {option.choices.filter(c => c.isEnabled !== false).map(c => c.label).join(', ')}
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                    <div style={{ fontSize: '13px', color: '#666', marginTop: '8px' }}>
                                        üí° ÂãæÈÅ∏ÂæåÔºåÈ°ßÂÆ¢ÈªûÊ≠§È§êÊôÇÊúÉÂΩàÂá∫ÈÅ∏È†ÖËÆì‰ªñÂÄëÈÅ∏Êìá
                                    </div>
                                </div>
                            )}

                            <div className="btn-group">
                                <button type="button" className="btn btn-secondary" onClick={onClose}>
                                    ÂèñÊ∂à
                                </button>
                                <button type="submit" className="btn btn-primary">
                                    ÂÑ≤Â≠ò
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        }

                        // ÈôÑÂä†ÈÅ∏È†ÖÁÆ°ÁêÜÁµÑ‰ª∂
        function OptionsManagement({ optionsLibrary = [], onUpdateOptionsLibrary }) {
            const [showModal, setShowModal] = React.useState(false);
            const [editingOption, setEditingOption] = React.useState(null);
            const [optionName, setOptionName] = React.useState('');
            const [optionType, setOptionType] = React.useState('radio');
            const [optionValues, setOptionValues] = React.useState([{ label: '', price: 0 }]);

            const handleAddNew = () => {
                setEditingOption(null);
                setOptionName('');
                setOptionType('radio');
                setOptionValues([{ label: '', price: 0 }]);
                setShowModal(true);
            };

            const handleEdit = (option) => {
                setEditingOption(option);
                setOptionName(option.name);
                setOptionType(option.type);
                setOptionValues([...option.choices]);
                setShowModal(true);
            };

            const handleDelete = (id) => {
                if (confirm('Á¢∫ÂÆöË¶ÅÂà™Èô§ÈÄôÂÄãÈÅ∏È†ÖÂóéÔºü')) {
                    onUpdateOptionsLibrary(optionsLibrary.filter(opt => opt.id !== id));
                }
            };

            const handleSave = () => {
                if (!optionName.trim()) { alert('Ë´ãËº∏ÂÖ•ÈÅ∏È†ÖÂêçÁ®±'); return; }
                if (optionValues.length === 0 || optionValues.some(v => !v.label.trim())) { alert('Ë´ãËá≥Â∞ëÊ∑ªÂä†‰∏ÄÂÄãÈÅ∏È†ÖÂÄº'); return; }
                const newOption = {
                    id: editingOption ? editingOption.id : `opt-${Date.now()}`,
                    name: optionName,
                    type: optionType,
                    choices: optionValues.map(v => ({ label: v.label.trim(), price: Number(v.price) || 0 }))
                };
                if (editingOption) {
                    onUpdateOptionsLibrary(optionsLibrary.map(opt => opt.id === editingOption.id ? newOption : opt));
                } else {
                    onUpdateOptionsLibrary([...optionsLibrary, newOption]);
                }
                setShowModal(false);
            };

            const addValue = () => setOptionValues([...optionValues, { label: '', price: 0 }]);
            const removeValue = (i) => optionValues.length > 1 && setOptionValues(optionValues.filter((_, idx) => idx !== i));
            const updateValue = (i, f, v) => { const u = [...optionValues]; u[i][f] = v; setOptionValues(u); };

            return React.createElement('div', { style: { padding: '20px' } },
                React.createElement('div', { style: { display: 'flex', justifyContent: 'space-between', marginBottom: '20px' } },
                    React.createElement('div', null,
                        React.createElement('h2', { style: { color: '#6B4423', marginBottom: '8px' } }, 'ÈôÑÂä†ÈÅ∏È†ÖÁÆ°ÁêÜ'),
                        React.createElement('p', { style: { color: '#666', fontSize: '14px' } }, 'ÁÆ°ÁêÜÂèØ‰æõÈÅ∏ÊìáÁöÑÈôÑÂä†ÈÅ∏È†ÖÔºåÂ¶ÇËæ£Â∫¶„ÄÅÈ£≤Êñô„ÄÅÂ§ßÂ∞èÁ≠â')
                    ),
                    React.createElement('button', {
                        onClick: handleAddNew,
                        style: { padding: '12px 24px', background: 'linear-gradient(135deg, #8B6F47 0%, #6B4423 100%)', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer', fontSize: '16px', fontWeight: '600' }
                    }, '‚ûï Êñ∞Â¢ûÈÅ∏È†Ö')
                ),
                optionsLibrary.length === 0 ?
                    React.createElement('div', { style: { padding: '60px 20px', textAlign: 'center', border: '2px dashed #ddd', borderRadius: '12px', background: '#fff' } },
                        React.createElement('div', { style: { fontSize: '48px', marginBottom: '16px' } }, 'üìù'),
                        React.createElement('p', { style: { fontSize: '16px', color: '#666' } }, 'ÁõÆÂâçÊ≤íÊúâÈôÑÂä†ÈÅ∏È†Ö'),
                        React.createElement('p', { style: { fontSize: '14px', color: '#999', marginTop: '8px' } }, 'ÈªûÊìä‰∏äÊñπÊåâÈàïÈñãÂßãÊñ∞Â¢û')
                    ) :
                    React.createElement('div', { style: { display: 'grid', gap: '16px' } },
                        optionsLibrary.map(option =>
                            React.createElement('div', { key: option.id, style: { background: '#fff', border: '1px solid #e0e0e0', borderRadius: '12px', padding: '20px' } },
                                React.createElement('div', { style: { display: 'flex', justifyContent: 'space-between', marginBottom: '16px' } },
                                    React.createElement('div', null,
                                        React.createElement('h3', { style: { color: '#6B4423', marginBottom: '8px' } }, option.name),
                                        React.createElement('span', { style: { display: 'inline-block', padding: '4px 12px', borderRadius: '12px', fontSize: '12px', background: option.type === 'radio' ? '#e3f2fd' : '#fff3e0', color: option.type === 'radio' ? '#1976d2' : '#f57c00' } }, option.type === 'radio' ? 'ÂñÆÈÅ∏' : 'Â§öÈÅ∏')
                                    ),
                                    React.createElement('div', { style: { display: 'flex', gap: '8px' } },
                                        React.createElement('button', { onClick: () => handleEdit(option), style: { padding: '8px 16px', background: '#f5f5f5', border: '1px solid #ddd', borderRadius: '6px', cursor: 'pointer' } }, 'Á∑®ËºØ'),
                                        React.createElement('button', { onClick: () => handleDelete(option.id), style: { padding: '8px 16px', background: '#ffebee', color: '#c62828', border: '1px solid #ffcdd2', borderRadius: '6px', cursor: 'pointer' } }, 'Âà™Èô§')
                                    )
                                ),
                                React.createElement('div', { style: { display: 'grid', gap: '8px' } },
                                    option.choices.map((val, idx) =>
                                        React.createElement('div', { key: idx, style: { display: 'flex', justifyContent: 'space-between', padding: '8px 12px', background: '#f9f9f9', borderRadius: '6px' } },
                                            React.createElement('span', null, val.label),
                                            React.createElement('span', { style: { fontWeight: 'bold', color: val.price > 0 ? '#6B4423' : '#999' } }, val.price > 0 ? `+$${val.price.toFixed(2)}` : '‰∏çÂä†ÂÉπ')
                                        )
                                    )
                                )
                            )
                        )
                    ),
                showModal && React.createElement('div', { style: { position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, background: 'rgba(0,0,0,0.5)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000 }, onClick: () => setShowModal(false) },
                    React.createElement('div', { style: { background: '#fff', borderRadius: '12px', padding: '30px', width: '90%', maxWidth: '600px', maxHeight: '80vh', overflow: 'auto' }, onClick: (e) => e.stopPropagation() },
                        React.createElement('h3', { style: { marginBottom: '20px', color: '#6B4423' } }, editingOption ? 'Á∑®ËºØÈÅ∏È†Ö' : 'Êñ∞Â¢ûÈÅ∏È†Ö'),
                        React.createElement('div', { style: { marginBottom: '20px' } },
                            React.createElement('label', { style: { display: 'block', marginBottom: '8px', fontWeight: 'bold' } }, 'ÈÅ∏È†ÖÂêçÁ®± *'),
                            React.createElement('input', { type: 'text', value: optionName, onChange: (e) => setOptionName(e.target.value), placeholder: '‰æãÂ¶ÇÔºöËæ£Â∫¶„ÄÅÈ£≤Êñô„ÄÅÂ§ßÂ∞è', style: { width: '100%', padding: '10px', border: '1px solid #ddd', borderRadius: '6px', fontSize: '16px' } })
                        ),
                        React.createElement('div', { style: { marginBottom: '20px' } },
                            React.createElement('label', { style: { display: 'block', marginBottom: '8px', fontWeight: 'bold' } }, 'ÈÅ∏È†ÖÈ°ûÂûã'),
                            React.createElement('select', { value: optionType, onChange: (e) => setOptionType(e.target.value), style: { width: '100%', padding: '10px', border: '1px solid #ddd', borderRadius: '6px', fontSize: '16px' } },
                                React.createElement('option', { value: 'radio' }, 'ÂñÆÈÅ∏ÔºàÈ°ßÂÆ¢Âè™ËÉΩÈÅ∏‰∏ÄÂÄãÔºâ'),
                                React.createElement('option', { value: 'checkbox' }, 'Â§öÈÅ∏ÔºàÈ°ßÂÆ¢ÂèØÈÅ∏Â§öÂÄãÔºâ')
                            )
                        ),
                        React.createElement('div', { style: { marginBottom: '20px' } },
                            React.createElement('label', { style: { display: 'block', marginBottom: '8px', fontWeight: 'bold' } }, 'ÈÅ∏È†ÖÂÄº'),
                            optionValues.map((val, idx) =>
                                React.createElement('div', { key: idx, style: { display: 'flex', gap: '8px', marginBottom: '8px' } },
                                    React.createElement('input', { type: 'text', value: val.label, onChange: (e) => updateValue(idx, 'label', e.target.value), placeholder: 'ÈÅ∏È†ÖÂêçÁ®±', style: { flex: 1, padding: '10px', border: '1px solid #ddd', borderRadius: '6px' } }),
                                    React.createElement('input', { type: 'number', value: val.price, onChange: (e) => updateValue(idx, 'price', e.target.value), placeholder: 'Âä†ÂÉπ', style: { width: '100px', padding: '10px', border: '1px solid #ddd', borderRadius: '6px' } }),
                                    React.createElement('button', { onClick: () => removeValue(idx), disabled: optionValues.length === 1, style: { padding: '10px', background: '#ffebee', color: '#c62828', border: 'none', borderRadius: '6px', cursor: optionValues.length === 1 ? 'not-allowed' : 'pointer', opacity: optionValues.length === 1 ? 0.5 : 1 } }, '‚úï')
                                )
                            ),
                            React.createElement('button', { onClick: addValue, style: { width: '100%', padding: '10px', background: '#f5f5f5', border: '2px dashed #ddd', borderRadius: '6px', cursor: 'pointer', marginTop: '8px' } }, '‚ûï Ê∑ªÂä†ÈÅ∏È†ÖÂÄº')
                        ),
                        React.createElement('div', { style: { display: 'flex', gap: '12px', justifyContent: 'flex-end' } },
                            React.createElement('button', { onClick: () => setShowModal(false), style: { padding: '10px 20px', background: '#f5f5f5', border: '1px solid #ddd', borderRadius: '6px', cursor: 'pointer' } }, 'ÂèñÊ∂à'),
                            React.createElement('button', { onClick: handleSave, style: { padding: '10px 20px', background: 'linear-gradient(135deg, #8B6F47 0%, #6B4423 100%)', color: 'white', border: 'none', borderRadius: '6px', cursor: 'pointer', fontWeight: 'bold' } }, 'ÂÑ≤Â≠ò')
                        )
                    )
                )
            );
        }

        // Áµ±Ë®àÂ†±Ë°®ÁµÑ‰ª∂
        function Statistics({ orders, menu }) {
            const today = new Date().toDateString();
            const todayOrders = orders.filter(order =>
                new Date(order.timestamp).toDateString() === today
            );

            // Ë®àÁÆóÂêÑÂïÜÂìÅÈä∑ÂîÆÁµ±Ë®à
            const itemStats = {};
            orders.forEach(order => {
                order.items.forEach(item => {
                    if (!itemStats[item.name]) {
                        itemStats[item.name] = {
                            name: item.name,
                            quantity: 0,
                            revenue: 0
                        };
                    }
                    itemStats[item.name].quantity += item.quantity;
                    itemStats[item.name].revenue += item.price * item.quantity;
                });
            });

            const sortedItems = Object.values(itemStats).sort((a, b) => b.revenue - a.revenue);

            // ÊåâÊó•ÊúüÁµ±Ë®à
            const dateStats = {};
            orders.forEach(order => {
                const date = new Date(order.timestamp).toLocaleDateString('zh-TW');
                if (!dateStats[date]) {
                    dateStats[date] = {
                        date,
                        orderCount: 0,
                        revenue: 0
                    };
                }
                dateStats[date].orderCount++;
                dateStats[date].revenue += order.total;
            });

            const sortedDates = Object.values(dateStats).sort((a, b) =>
                new Date(b.date) - new Date(a.date)
            ).slice(0, 30); // ÊúÄËøë30Â§©

            return (
                <div>
                    <h3 style={{ marginBottom: '20px', color: '#6B4423' }}>üìà ‰ªäÊó•Áµ±Ë®à</h3>
                    <div className="stats-grid">
                        <div className="stat-card">
                            <div className="stat-label">‰ªäÊó•Ë®ÇÂñÆ</div>
                            <div className="stat-value">{todayOrders.length}</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">‰ªäÊó•ÁáüÊ•≠È°ç</div>
                            <div className="stat-value">
                                ${todayOrders.reduce((sum, o) => sum + o.total, 0).toFixed(2)}
                            </div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">Á∏ΩË®ÇÂñÆÊï∏</div>
                            <div className="stat-value">{orders.length}</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-label">Á∏ΩÁáüÊ•≠È°ç</div>
                            <div className="stat-value">
                                ${orders.reduce((sum, o) => sum + o.total, 0).toFixed(2)}
                            </div>
                        </div>
                    </div>

                    <h3 style={{ marginTop: '40px', marginBottom: '15px', color: '#6B4423' }}>
                        üèÜ ÁÜ±Èä∑ÂïÜÂìÅÊéíË°å
                    </h3>
                    <table className="table">
                        <thead>
                            <tr>
                                <th>ÊéíÂêç</th>
                                <th>ÂïÜÂìÅÂêçÁ®±</th>
                                <th>Èä∑ÂîÆÊï∏Èáè</th>
                                <th>Èä∑ÂîÆÈáëÈ°ç</th>
                            </tr>
                        </thead>
                        <tbody>
                            {sortedItems.slice(0, 10).map((item, index) => (
                                <tr key={item.name}>
                                    <td>
                                        <span style={{
                                            fontSize: '20px',
                                            fontWeight: 'bold',
                                            color: index === 0 ? '#fbbf24' : index === 1 ? '#94a3b8' : index === 2 ? '#cd7f32' : '#666'
                                        }}>
                                            {index + 1}
                                        </span>
                                    </td>
                                    <td style={{ fontWeight: 'bold' }}>{item.name}</td>
                                    <td>{item.quantity}</td>
                                    <td style={{ color: '#6B4423', fontWeight: 'bold' }}>
                                        ${item.revenue.toFixed(2)}
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>

                    <h3 style={{ marginTop: '40px', marginBottom: '15px', color: '#6B4423' }}>
                        üìÖ ÊØèÊó•ÁáüÊ•≠Áµ±Ë®à
                    </h3>
                    <table className="table">
                        <thead>
                            <tr>
                                <th>Êó•Êúü</th>
                                <th>Ë®ÇÂñÆÊï∏</th>
                                <th>ÁáüÊ•≠È°ç</th>
                            </tr>
                        </thead>
                        <tbody>
                            {sortedDates.map(stat => (
                                <tr key={stat.date}>
                                    <td>{stat.date}</td>
                                    <td>{stat.orderCount}</td>
                                    <td style={{ color: '#6B4423', fontWeight: 'bold' }}>
                                        ${stat.revenue.toFixed(2)}
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            );
        }

        // ‰∏ªÊáâÁî®Á®ãÂºè
        function AdminApp() {
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [currentSession, setCurrentSession] = useState(null);
            const [currentView, setCurrentView] = useState('dashboard');
            const [orders, setOrders] = useState([]);
            const [menu, setMenu] = useState([]);
            const [optionsLibrary, setOptionsLibrary] = useState([]);

            // Ê™¢Êü•ÁôªÂÖ•ÁãÄÊÖã
            useEffect(() => {
                const checkSession = async () => {
                    try {
                        // Á≠âÂæÖ Supabase ÂàùÂßãÂåñ
                        let attempts = 0;
                        while (!window.supabaseReady && attempts < 50) {
                            await new Promise(resolve => setTimeout(resolve, 100));
                            attempts++;
                        }

                        if (!window.supabaseReady || !window.supabaseClient) {
                            return;
                        }

                        // Ê™¢Êü•ÊòØÂê¶ÊúâÁèæÊúâ session
                        const { data: { session } } = await window.supabaseClient.auth.getSession();
                        if (session) {
                            console.log('‚úÖ Found existing session:', session.user.email);
                            setCurrentSession(session);
                            setIsLoggedIn(true);
                        }
                    } catch (error) {
                        console.error('‚ùå Error checking session:', error);
                    }
                };

                checkSession();
            }, []);

            // ËºâÂÖ•Êï∏Êìö
            useEffect(() => {
                if (!isLoggedIn) return;

                const loadAllData = async () => {
                    try {
                        // Á≠âÂæÖ Supabase ÂàùÂßãÂåñ
                        let attempts = 0;
                        while (!window.supabaseReady && attempts < 50) {
                            await new Promise(resolve => setTimeout(resolve, 100));
                            attempts++;
                        }

                        if (!window.supabaseReady) {
                            console.warn('‚ö†Ô∏è Supabase not ready, using localStorage');
                            setOrders(loadFromLocalStorage('orders', []));
                            setMenu(loadFromLocalStorage('menu', []));
                            setOptionsLibrary(loadFromLocalStorage('optionsLibrary', []));
                            return;
                        }

                        console.log('üì° Loading admin data from Supabase...');

                        // ‰∏¶Ë°åÂä†ËºâÊâÄÊúâÊï∏Êìö
                        const [ordersData, menuData, optionsData] = await Promise.all([
                            loadFromSupabase('orders'),
                            loadFromSupabase('menu'),
                            loadFromSupabase('options_library')
                        ]);

                        // Ë®ÇÂñÆÊï∏ÊìöËΩâÊèõ
                        if (ordersData) {
                            const normalizedOrders = ordersData.map(order => ({
                                id: order.id,
                                orderNumber: `#${order.id.toString().slice(-6)}`,
                                customerName: order.customer_name,
                                phone: order.phone,
                                serviceMode: order.service_mode || 'dine-in',
                                items: order.items,
                                total: parseFloat(order.total),
                                status: order.status || 'pending',
                                notes: order.notes,
                                scheduledTime: order.scheduled_time,
                                timestamp: order.created_at,
                                createdAt: order.created_at,
                                updatedAt: order.updated_at || order.created_at
                            }));
                            setOrders(normalizedOrders);
                        } else {
                            setOrders(loadFromLocalStorage('orders', []));
                        }

                        // ËèúÂñÆÊï∏ÊìöËΩâÊèõ
                        if (menuData) {
                            const normalizedMenu = menuData.map(item => ({
                                id: item.id,
                                name: item.name,
                                englishName: item.english_name || '',
                                price: parseFloat(item.price),
                                category: item.category,
                                emoji: item.emoji || '',
                                image: item.image || '',
                                description: item.description || '',
                                isAvailable: item.available !== false,
                                appliedOptionIds: item.applied_option_ids || []
                            }));
                            setMenu(normalizedMenu);
                        } else {
                            setMenu(loadFromLocalStorage('menu', []));
                        }

                        // ÈÅ∏È†ÖÂ∫´Êï∏ÊìöËΩâÊèõ
                        if (optionsData) {
                            const normalizedOptions = optionsData.map(opt => ({
                                id: opt.id,
                                name: opt.name,
                                type: opt.type,
                                required: opt.required || false,
                                isEnabled: opt.is_enabled !== false,
                                categories: opt.categories || [],
                                choices: opt.choices
                            }));
                            setOptionsLibrary(normalizedOptions);
                        } else {
                            setOptionsLibrary(loadFromLocalStorage('optionsLibrary', []));
                        }

                    } catch (error) {
                        console.error('‚ùå Error loading data:', error);
                        setOrders(loadFromLocalStorage('orders', []));
                        setMenu(loadFromLocalStorage('menu', []));
                        setOptionsLibrary(loadFromLocalStorage('optionsLibrary', []));
                    }
                };

                loadAllData();
            }, [isLoggedIn]);

            // ÂÆöÊúüÂæû Supabase Âà∑Êñ∞Êï∏Êìö
            useEffect(() => {
                // Guard: Êú™ÁôªÂÖ•‰∏çÂà∑Êñ∞
                if (!isLoggedIn) return;

                const refreshData = async () => {
                    if (!window.supabaseReady) return;

                    try {
                        // Âà∑Êñ∞Ë®ÇÂñÆ
                        const ordersData = await loadFromSupabase('orders');
                        if (ordersData) {
                            const normalizedOrders = ordersData.map(order => ({
                                id: order.id,
                                orderNumber: `#${order.id.toString().slice(-6)}`,
                                customerName: order.customer_name,
                                phone: order.phone,
                                serviceMode: order.service_mode || 'dine-in',
                                items: order.items,
                                total: parseFloat(order.total),
                                status: order.status || 'pending',
                                notes: order.notes,
                                scheduledTime: order.scheduled_time,
                                timestamp: order.created_at,
                                createdAt: order.created_at,
                                updatedAt: order.updated_at || order.created_at
                            }));
                            setOrders(normalizedOrders);
                        }
                    } catch (error) {
                        console.error('‚ùå Error refreshing data:', error);
                    }
                };

                // ÂÆöÊúüÂà∑Êñ∞Êï∏ÊìöÔºàÊØè10ÁßíÔºâ
                const interval = setInterval(refreshData, 10000);

                return () => {
                    clearInterval(interval);
                };
            }, [isLoggedIn]);

            const handleLogin = (session) => {
                console.log('‚úÖ handleLogin called with session:', session?.user?.email);
                setCurrentSession(session);
                setIsLoggedIn(true);
            };

            const handleLogout = async () => {
                try {
                    if (window.supabaseClient) {
                        await window.supabaseClient.auth.signOut();
                        console.log('‚úÖ Logged out successfully');
                    }
                } catch (error) {
                    console.error('‚ùå Error logging out:', error);
                }
                setCurrentSession(null);
                setIsLoggedIn(false);
                setCurrentView('dashboard');
            };

            const handleUpdateOrder = async (orderId, updatedOrder) => {
                const updatedOrders = orders.map(order =>
                    order.id === orderId ? updatedOrder : order
                );
                setOrders(updatedOrders);

                // Êõ¥Êñ∞Âà∞ Supabase
                await updateOrderInSupabase(orderId, updatedOrder);

                // ÂÇôÁî®Ôºö‰øùÂ≠òÂà∞ localStorage
                saveToLocalStorage('orders', updatedOrders);
            };

            const handleUpdateMenu = async (updatedMenu) => {
                setMenu(updatedMenu);

                // ‰øùÂ≠òÂà∞ Supabase
                await saveMenuToSupabase(updatedMenu);

                // ÂÇôÁî®Ôºö‰øùÂ≠òÂà∞ localStorage
                saveToLocalStorage('menu', updatedMenu);
            };

            const handleUpdateOptionsLibrary = async (updatedLibrary) => {
                setOptionsLibrary(updatedLibrary);

                // ‰øùÂ≠òÂà∞ Supabase
                await saveOptionsToSupabase(updatedLibrary);

                // ÂÇôÁî®Ôºö‰øùÂ≠òÂà∞ localStorage
                saveToLocalStorage('optionsLibrary', updatedLibrary);
            };

            if (!isLoggedIn) {
                return React.createElement(AdminLogin, { onLogin: handleLogin });
            }

            const menuItems = [
                { id: 'dashboard', icon: 'üìä', label: 'ÂÑÄË°®Êùø' },
                { id: 'orders', icon: 'üì¶', label: 'Ë®ÇÂñÆÁÆ°ÁêÜ' },
                { id: 'menu', icon: 'üç±', label: 'ËèúÂñÆÁÆ°ÁêÜ' },
                { id: 'options', icon: '‚öôÔ∏è', label: 'ÈôÑÂä†ÈÅ∏È†ÖÁÆ°ÁêÜ' },
                { id: 'statistics', icon: 'üìà', label: 'Áµ±Ë®àÂ†±Ë°®' }
            ];

            const viewTitles = {
                dashboard: 'ÂÑÄË°®Êùø',
                orders: 'Ë®ÇÂñÆÁÆ°ÁêÜ',
                menu: 'ËèúÂñÆÁÆ°ÁêÜ',
                options: 'ÈôÑÂä†ÈÅ∏È†ÖÁÆ°ÁêÜ',
                statistics: 'Áµ±Ë®àÂ†±Ë°®'
            };

            const viewDescriptions = {
                dashboard: 'Âç≥ÊôÇË®ÇÂñÆÁõ£ÊéßËàá‰ªäÊó•Áµ±Ë®à',
                orders: 'ÁÆ°ÁêÜÊâÄÊúâË®ÇÂñÆÁãÄÊÖã',
                menu: 'Á∑®ËºØËèúÂñÆÈ†ÖÁõÆËàá‰æõÊáâÁãÄÊÖã',
                options: 'ÁÆ°ÁêÜÂèØ‰æõÈÅ∏ÊìáÁöÑÈôÑÂä†ÈÅ∏È†ÖÔºåÂ¶ÇËæ£Â∫¶„ÄÅÈ£≤Êñô„ÄÅÂ§ßÂ∞èÁ≠â',
                statistics: 'Êü•ÁúãÁáüÊî∂ËàáÈä∑ÂîÆÁµ±Ë®à'
            };

            return (
                <div className="admin-container">
                    <div className="admin-layout">
                        <aside className="sidebar">
                            <div className="sidebar-header">
                                <h1>üç± ÂæåÂè∞ÁÆ°ÁêÜ</h1>
                                <p>Lee's Taiwanese Comfort Food</p>
                            </div>
                            <ul className="sidebar-menu">
                                {menuItems.map(item => (
                                    <li key={item.id}>
                                        <button
                                            className={currentView === item.id ? 'active' : ''}
                                            onClick={() => setCurrentView(item.id)}
                                        >
                                            <span>{item.icon}</span>
                                            <span>{item.label}</span>
                                        </button>
                                    </li>
                                ))}
                            </ul>
                            <div className="sidebar-footer">
                                <button onClick={handleLogout}>
                                    üö™ ÁôªÂá∫
                                </button>
                            </div>
                        </aside>

                        <main className="main-content">
                            <div className="content-header">
                                <h2>{viewTitles[currentView]}</h2>
                                <p>{viewDescriptions[currentView]}</p>
                            </div>
                            <div className="content-body">
                                {currentView === 'dashboard' && (
                                    <Dashboard orders={orders} menu={menu} />
                                )}
                                {currentView === 'orders' && (
                                    <OrderManagement
                                        orders={orders}
                                        onUpdateOrder={handleUpdateOrder}
                                    />
                                )}
                                {currentView === 'menu' && (
                                    <MenuManagement
                                        menu={menu}
                                        onUpdateMenu={handleUpdateMenu}
                                        optionsLibrary={optionsLibrary}
                                    />
                                )}
                                {currentView === 'options' && (
                                    <OptionsManagement
                                        optionsLibrary={optionsLibrary}
                                        onUpdateOptionsLibrary={handleUpdateOptionsLibrary}
                                    />
                                )}
                                {currentView === 'statistics' && (
                                    <Statistics orders={orders} menu={menu} />
                                )}
                            </div>
                        </main>
                    </div>
                </div>
            );
        }

        // Ê∏≤ÊüìÊáâÁî®Á®ãÂºè
        ReactDOM.render(React.createElement(AdminApp), document.getElementById('root'));
    </script>
</body>
</html>
<!-- Trigger Vercel deployment -->
